import{a as Bt,b as ni,c as Ia,d as oi,e as Ca,f as ms,g as ce,h as _a}from"./chunk-R4CYYJBF.js";import{A as Br,B as Y,C as ss,E as Fi,H as Pa,I as Sa,a as fa,b as he,c as At,h as ma,i as He,j as gt,l as ya,m as B,n as Li,o as ri,q as ts,r as ft,s as ye,t as jr,u as wa,v as nt,w as qi,z as O}from"./chunk-L4TYMJQF.js";import{a as Mr,b as Vr,c as va,d as Hr,e as ba,f as Ea}from"./chunk-TIQUTIID.js";import"./chunk-J3Q5VSKP.js";import"./chunk-V22BWOKJ.js";import{b as $r}from"./chunk-USJIJJ3H.js";import{a as Lr,b as ca,c as ti,d as qr,e as ha,f as us,g as Me,h as xe,i as la,j as Zt,k as gs,l as pa,m as da,n as ga}from"./chunk-FFZEOARO.js";import{a as Ui,b as fs,c as Qt,d as Le,e as Se,f as ua,h as St,i as $t,j as ut,k as es,l as Di,o as si,p as ii,q as rt,r as Ze,s as Fr,t as Fe,u as Ve}from"./chunk-26CTAKM4.js";import"./chunk-V4X6BPGN.js";import"./chunk-ERZ25PT2.js";import{a as F,b as Ee,c as oa,e as aa,h as dt,j as Dr,k as l}from"./chunk-HIVZEDT5.js";var Zi=aa(ne=>{"use strict";Object.defineProperty(ne,"__esModule",{value:!0});ne.getLocalStorage=ne.getLocalStorageOrThrow=ne.getCrypto=ne.getCryptoOrThrow=ne.getLocation=ne.getLocationOrThrow=ne.getNavigator=ne.getNavigatorOrThrow=ne.getDocument=ne.getDocumentOrThrow=ne.getFromWindowOrThrow=ne.getFromWindow=void 0;function is(s){let e;return typeof window<"u"&&typeof window[s]<"u"&&(e=window[s]),e}ne.getFromWindow=is;function ys(s){let e=is(s);if(!e)throw new Error(`${s} is not defined in Window`);return e}ne.getFromWindowOrThrow=ys;function yp(){return ys("document")}ne.getDocumentOrThrow=yp;function wp(){return is("document")}ne.getDocument=wp;function vp(){return ys("navigator")}ne.getNavigatorOrThrow=vp;function bp(){return is("navigator")}ne.getNavigator=bp;function Ep(){return ys("location")}ne.getLocationOrThrow=Ep;function Ip(){return is("location")}ne.getLocation=Ip;function Cp(){return ys("crypto")}ne.getCryptoOrThrow=Cp;function _p(){return is("crypto")}ne.getCrypto=_p;function Pp(){return ys("localStorage")}ne.getLocalStorageOrThrow=Pp;function Sp(){return is("localStorage")}ne.getLocalStorage=Sp});var qa=aa(Qi=>{"use strict";Object.defineProperty(Qi,"__esModule",{value:!0});Qi.getWindowMetadata=void 0;var La=Zi();function Ap(){let s,e;try{s=La.getDocumentOrThrow(),e=La.getLocationOrThrow()}catch{return null}function t(){let d=s.getElementsByTagName("link"),u=[];for(let y=0;y<d.length;y++){let f=d[y],m=f.getAttribute("rel");if(m&&m.toLowerCase().indexOf("icon")>-1){let g=f.getAttribute("href");if(g)if(g.toLowerCase().indexOf("https:")===-1&&g.toLowerCase().indexOf("http:")===-1&&g.indexOf("//")!==0){let v=e.protocol+"//"+e.host;if(g.indexOf("/")===0)v+=g;else{let w=e.pathname.split("/");w.pop();let b=w.join("/");v+=b+"/"+g}u.push(v)}else if(g.indexOf("//")===0){let v=e.protocol+g;u.push(v)}else u.push(g)}}return u}function i(...d){let u=s.getElementsByTagName("meta");for(let y=0;y<u.length;y++){let f=u[y],m=["itemprop","property","name"].map(g=>f.getAttribute(g)).filter(g=>g?d.includes(g):!1);if(m.length&&m){let g=f.getAttribute("content");if(g)return g}}return""}function r(){let d=i("name","og:site_name","og:title","twitter:title");return d||(d=s.title),d}function n(){return i("description","og:description","twitter:description","keywords")}let o=r(),a=n(),c=e.origin,h=t();return{description:a,url:c,icons:h,name:o}}Qi.getWindowMetadata=Ap});var Ft=dt(Ui());var Ta=dt(Ui()),Jl=Object.defineProperty,Xl=(s,e,t)=>e in s?Jl(s,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):s[e]=t,Aa=(s,e,t)=>Xl(s,typeof e!="symbol"?e+"":e,t),ji=class extends Zt{constructor(e){super(),this.opts=e,Aa(this,"protocol","wc"),Aa(this,"version",2)}};var Zl=Object.defineProperty,Ql=(s,e,t)=>e in s?Zl(s,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):s[e]=t,ep=(s,e,t)=>Ql(s,typeof e!="symbol"?e+"":e,t),$i=class extends Zt{constructor(e,t){super(),this.core=e,this.logger=t,ep(this,"records",new Map)}},Bi=class{constructor(e,t){this.logger=e,this.core=t}},Mi=class extends Zt{constructor(e,t){super(),this.relayer=e,this.logger=t}},Vi=class extends Zt{constructor(e){super()}},Hi=class{constructor(e,t,i,r){this.core=e,this.logger=t,this.name=i}};var zi=class extends Zt{constructor(e,t){super(),this.relayer=e,this.logger=t}};var Ki=class extends Zt{constructor(e,t){super(),this.core=e,this.logger=t}};var Wi=class{constructor(e,t,i){this.core=e,this.logger=t,this.store=i}},Gi=class{constructor(e,t){this.projectId=e,this.logger=t}},Yi=class{constructor(e,t,i){this.core=e,this.logger=t,this.telemetryEnabled=i}},tp=Object.defineProperty,sp=(s,e,t)=>e in s?tp(s,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):s[e]=t,Na=(s,e,t)=>sp(s,typeof e!="symbol"?e+"":e,t);var Ji=class{constructor(e){this.opts=e,Na(this,"protocol","wc"),Na(this,"version",2)}};var Xi=class{constructor(e){this.client=e}};var j=dt(Lr());var ip=s=>JSON.stringify(s,(e,t)=>typeof t=="bigint"?t.toString()+"n":t),rp=s=>{let e=/([\[:])?(\d{17,}|(?:[9](?:[1-9]07199254740991|0[1-9]7199254740991|00[8-9]199254740991|007[2-9]99254740991|007199[3-9]54740991|0071992[6-9]4740991|00719925[5-9]740991|007199254[8-9]40991|0071992547[5-9]0991|00719925474[1-9]991|00719925474099[2-9])))([,\}\]])/g,t=s.replace(e,'$1"$2n"$3');return JSON.parse(t,(i,r)=>typeof r=="string"&&r.match(/^\d+n$/)?BigInt(r.substring(0,r.length-1)):r)};function zr(s){if(typeof s!="string")throw new Error(`Cannot safe json parse value of type ${typeof s}`);try{return rp(s)}catch{return s}}function Oa(s){return typeof s=="string"?s:ip(s)||""}var Ra=function(s,e,t){if(t||arguments.length===2)for(var i=0,r=e.length,n;i<r;i++)(n||!(i in e))&&(n||(n=Array.prototype.slice.call(e,0,i)),n[i]=e[i]);return s.concat(n||Array.prototype.slice.call(e))},np=function(){function s(e,t,i){this.name=e,this.version=t,this.os=i,this.type="browser"}return s}();var op=function(){function s(e){this.version=e,this.type="node",this.name="node",this.os=process.platform}return s}();var ap=function(){function s(e,t,i,r){this.name=e,this.version=t,this.os=i,this.bot=r,this.type="bot-device"}return s}();var cp=function(){function s(){this.type="bot",this.bot=!0,this.name="bot",this.version=null,this.os=null}return s}();var hp=function(){function s(){this.type="react-native",this.name="react-native",this.version=null,this.os=null}return s}();var lp=/alexa|bot|crawl(er|ing)|facebookexternalhit|feedburner|google web preview|nagios|postrank|pingdom|slurp|spider|yahoo!|yandex/,pp=/(nuhk|curl|Googlebot|Yammybot|Openbot|Slurp|MSNBot|Ask\ Jeeves\/Teoma|ia_archiver)/,xa=3,dp=[["aol",/AOLShield\/([0-9\._]+)/],["edge",/Edge\/([0-9\._]+)/],["edge-ios",/EdgiOS\/([0-9\._]+)/],["yandexbrowser",/YaBrowser\/([0-9\._]+)/],["kakaotalk",/KAKAOTALK\s([0-9\.]+)/],["samsung",/SamsungBrowser\/([0-9\.]+)/],["silk",/\bSilk\/([0-9._-]+)\b/],["miui",/MiuiBrowser\/([0-9\.]+)$/],["beaker",/BeakerBrowser\/([0-9\.]+)/],["edge-chromium",/EdgA?\/([0-9\.]+)/],["chromium-webview",/(?!Chrom.*OPR)wv\).*Chrom(?:e|ium)\/([0-9\.]+)(:?\s|$)/],["chrome",/(?!Chrom.*OPR)Chrom(?:e|ium)\/([0-9\.]+)(:?\s|$)/],["phantomjs",/PhantomJS\/([0-9\.]+)(:?\s|$)/],["crios",/CriOS\/([0-9\.]+)(:?\s|$)/],["firefox",/Firefox\/([0-9\.]+)(?:\s|$)/],["fxios",/FxiOS\/([0-9\.]+)/],["opera-mini",/Opera Mini.*Version\/([0-9\.]+)/],["opera",/Opera\/([0-9\.]+)(?:\s|$)/],["opera",/OPR\/([0-9\.]+)(:?\s|$)/],["pie",/^Microsoft Pocket Internet Explorer\/(\d+\.\d+)$/],["pie",/^Mozilla\/\d\.\d+\s\(compatible;\s(?:MSP?IE|MSInternet Explorer) (\d+\.\d+);.*Windows CE.*\)$/],["netfront",/^Mozilla\/\d\.\d+.*NetFront\/(\d.\d)/],["ie",/Trident\/7\.0.*rv\:([0-9\.]+).*\).*Gecko$/],["ie",/MSIE\s([0-9\.]+);.*Trident\/[4-7].0/],["ie",/MSIE\s(7\.0)/],["bb10",/BB10;\sTouch.*Version\/([0-9\.]+)/],["android",/Android\s([0-9\.]+)/],["ios",/Version\/([0-9\._]+).*Mobile.*Safari.*/],["safari",/Version\/([0-9\._]+).*Safari/],["facebook",/FB[AS]V\/([0-9\.]+)/],["instagram",/Instagram\s([0-9\.]+)/],["ios-webview",/AppleWebKit\/([0-9\.]+).*Mobile/],["ios-webview",/AppleWebKit\/([0-9\.]+).*Gecko\)$/],["curl",/^curl\/([0-9\.]+)$/],["searchbot",lp]],ka=[["iOS",/iP(hone|od|ad)/],["Android OS",/Android/],["BlackBerry OS",/BlackBerry|BB10/],["Windows Mobile",/IEMobile/],["Amazon OS",/Kindle/],["Windows 3.11",/Win16/],["Windows 95",/(Windows 95)|(Win95)|(Windows_95)/],["Windows 98",/(Windows 98)|(Win98)/],["Windows 2000",/(Windows NT 5.0)|(Windows 2000)/],["Windows XP",/(Windows NT 5.1)|(Windows XP)/],["Windows Server 2003",/(Windows NT 5.2)/],["Windows Vista",/(Windows NT 6.0)/],["Windows 7",/(Windows NT 6.1)/],["Windows 8",/(Windows NT 6.2)/],["Windows 8.1",/(Windows NT 6.3)/],["Windows 10",/(Windows NT 10.0)/],["Windows ME",/Windows ME/],["Windows CE",/Windows CE|WinCE|Microsoft Pocket Internet Explorer/],["Open BSD",/OpenBSD/],["Sun OS",/SunOS/],["Chrome OS",/CrOS/],["Linux",/(Linux)|(X11)/],["Mac OS",/(Mac_PowerPC)|(Macintosh)/],["QNX",/QNX/],["BeOS",/BeOS/],["OS/2",/OS\/2/]];function Da(s){return s?Ua(s):typeof document>"u"&&typeof navigator<"u"&&navigator.product==="ReactNative"?new hp:typeof navigator<"u"?Ua(navigator.userAgent):fp()}function up(s){return s!==""&&dp.reduce(function(e,t){var i=t[0],r=t[1];if(e)return e;var n=r.exec(s);return!!n&&[i,n]},!1)}function Ua(s){var e=up(s);if(!e)return null;var t=e[0],i=e[1];if(t==="searchbot")return new cp;var r=i[1]&&i[1].split(".").join("_").split("_").slice(0,3);r?r.length<xa&&(r=Ra(Ra([],r,!0),mp(xa-r.length),!0)):r=[];var n=r.join("."),o=gp(s),a=pp.exec(s);return a&&a[1]?new ap(t,n,o,a[1]):new np(t,n,o)}function gp(s){for(var e=0,t=ka.length;e<t;e++){var i=ka[e],r=i[0],n=i[1],o=n.exec(s);if(o)return r}return null}function fp(){var s=typeof process<"u"&&process.version;return s?new op(process.version.slice(1)):null}function mp(s){for(var e=[],t=0;t<s;t++)e.push("0");return e}var xt=dt(Lr()),kt=dt(Zi()),yc=dt(qa());function Fa(s){let e=ba(`0x${s.substring(4)}`).substring(26);return Ea(`0x${e}`)}function $a(t){return l(this,arguments,function*({hash:s,signature:e}){let i=Mr(s)?s:Hr(s),{secp256k1:r}=yield import("./chunk-RPUTB2P6.js");return`0x${(()=>{if(typeof e=="object"&&"r"in e&&"s"in e){let{r:p,s:d,v:u,yParity:y}=e,f=Number(y??u),m=ja(f);return new r.Signature(Vr(p),Vr(d)).addRecoveryBit(m)}let a=Mr(e)?e:Hr(e),c=va(`0x${a.slice(130)}`),h=ja(c);return r.Signature.fromCompact(a.substring(2,130)).addRecoveryBit(h)})().recoverPublicKey(i.substring(2)).toHex(!1)}`})}function ja(s){if(s===0||s===1)return s;if(s===27)return 0;if(s===28)return 1;throw new Error("Invalid yParityOrV value")}function Kr(t){return l(this,arguments,function*({hash:s,signature:e}){return Fa(yield $a({hash:s,signature:e}))})}function Np(s){if(s.length>=255)throw new TypeError("Alphabet too long");let e=new Uint8Array(256);for(let h=0;h<e.length;h++)e[h]=255;for(let h=0;h<s.length;h++){let p=s.charAt(h),d=p.charCodeAt(0);if(e[d]!==255)throw new TypeError(p+" is ambiguous");e[d]=h}let t=s.length,i=s.charAt(0),r=Math.log(t)/Math.log(256),n=Math.log(256)/Math.log(t);function o(h){if(h instanceof Uint8Array||(ArrayBuffer.isView(h)?h=new Uint8Array(h.buffer,h.byteOffset,h.byteLength):Array.isArray(h)&&(h=Uint8Array.from(h))),!(h instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(h.length===0)return"";let p=0,d=0,u=0,y=h.length;for(;u!==y&&h[u]===0;)u++,p++;let f=(y-u)*n+1>>>0,m=new Uint8Array(f);for(;u!==y;){let w=h[u],b=0;for(let _=f-1;(w!==0||b<d)&&_!==-1;_--,b++)w+=256*m[_]>>>0,m[_]=w%t>>>0,w=w/t>>>0;if(w!==0)throw new Error("Non-zero carry");d=b,u++}let g=f-d;for(;g!==f&&m[g]===0;)g++;let v=i.repeat(p);for(;g<f;++g)v+=s.charAt(m[g]);return v}function a(h){if(typeof h!="string")throw new TypeError("Expected String");if(h.length===0)return new Uint8Array;let p=0,d=0,u=0;for(;h[p]===i;)d++,p++;let y=(h.length-p)*r+1>>>0,f=new Uint8Array(y);for(;p<h.length;){let w=h.charCodeAt(p);if(w>255)return;let b=e[w];if(b===255)return;let _=0;for(let R=y-1;(b!==0||_<u)&&R!==-1;R--,_++)b+=t*f[R]>>>0,f[R]=b%256>>>0,b=b/256>>>0;if(b!==0)throw new Error("Non-zero carry");u=_,p++}let m=y-u;for(;m!==y&&f[m]===0;)m++;let g=new Uint8Array(d+(y-m)),v=d;for(;m!==y;)g[v++]=f[m++];return g}function c(h){let p=a(h);if(p)return p;throw new Error("Non-base"+t+" character")}return{encode:o,decodeUnsafe:a,decode:c}}var Ba=Np;var Tp="123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz",er=Ba(Tp);var Op=":";function Wt(s){let[e,t]=s.split(Op);return{namespace:e,reference:t}}function wc(s,e){return s.includes(":")?[s]:e.chains||[]}var Rp=Object.defineProperty,xp=Object.defineProperties,kp=Object.getOwnPropertyDescriptors,Ma=Object.getOwnPropertySymbols,Up=Object.prototype.hasOwnProperty,Dp=Object.prototype.propertyIsEnumerable,Va=(s,e,t)=>e in s?Rp(s,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):s[e]=t,Ha=(s,e)=>{for(var t in e||(e={}))Up.call(e,t)&&Va(s,t,e[t]);if(Ma)for(var t of Ma(e))Dp.call(e,t)&&Va(s,t,e[t]);return s},Lp=(s,e)=>xp(s,kp(e)),qp="ReactNative",$e={reactNative:"react-native",node:"node",browser:"browser",unknown:"unknown"};var Fp="js";function gi(){return typeof process<"u"&&typeof process.versions<"u"&&typeof process.versions.node<"u"}function Ut(){return!(0,kt.getDocument)()&&!!(0,kt.getNavigator)()&&navigator.product===qp}function vc(){return Ut()&&typeof global<"u"&&typeof(global==null?void 0:global.Platform)<"u"&&(global==null?void 0:global.Platform.OS)==="android"}function bc(){return Ut()&&typeof global<"u"&&typeof(global==null?void 0:global.Platform)<"u"&&(global==null?void 0:global.Platform.OS)==="ios"}function Ns(){return!gi()&&!!(0,kt.getNavigator)()&&!!(0,kt.getDocument)()}function fi(){return Ut()?$e.reactNative:gi()?$e.node:Ns()?$e.browser:$e.unknown}function wn(){var s;try{return Ut()&&typeof global<"u"&&typeof(global==null?void 0:global.Application)<"u"?(s=global.Application)==null?void 0:s.applicationId:void 0}catch{return}}function jp(s,e){let t=new URLSearchParams(s);for(let i of Object.keys(e).sort())if(e.hasOwnProperty(i)){let r=e[i];r!==void 0&&t.set(i,r)}return t.toString()}function Ec(s){var e,t;let i=vn();try{return s!=null&&s.url&&i.url&&s.url!==i.url&&(console.warn(`The configured WalletConnect 'metadata.url':${s.url} differs from the actual page url:${i.url}. This is probably unintended and can lead to issues.`),s.url=i.url),(e=s?.icons)!=null&&e.length&&s.icons.length>0&&(s.icons=s.icons.filter(r=>r!=="")),Lp(Ha(Ha({},i),s),{url:s?.url||i.url,name:s?.name||i.name,description:s?.description||i.description,icons:(t=s?.icons)!=null&&t.length&&s.icons.length>0?s.icons:i.icons})}catch(r){return console.warn("Error populating app metadata",r),s||i}}function vn(){return(0,yc.getWindowMetadata)()||{name:"",description:"",url:"",icons:[""]}}function $p(){if(fi()===$e.reactNative&&typeof global<"u"&&typeof(global==null?void 0:global.Platform)<"u"){let{OS:t,Version:i}=global.Platform;return[t,i].join("-")}let s=Da();if(s===null)return"unknown";let e=s.os?s.os.replace(" ","").toLowerCase():"unknown";return s.type==="browser"?[e,s.name,s.version].join("-"):[e,s.version].join("-")}function Bp(){var s;let e=fi();return e===$e.browser?[e,((s=(0,kt.getLocation)())==null?void 0:s.host)||"unknown"].join(":"):e}function bn(s,e,t){let i=$p(),r=Bp();return[[s,e].join("-"),[Fp,t].join("-"),i,r].join("/")}function Ic({protocol:s,version:e,relayUrl:t,sdkVersion:i,auth:r,projectId:n,useOnCloseEvent:o,bundleId:a,packageName:c}){let h=t.split("?"),p=bn(s,e,i),d={auth:r,ua:p,projectId:n,useOnCloseEvent:o||void 0,packageName:c||void 0,bundleId:a||void 0},u=jp(h[1]||"",d);return h[0]+"?"+u}function ns(s,e){return s.filter(t=>e.includes(t)).length===s.length}function or(s){return Object.fromEntries(s.entries())}function ar(s){return new Map(Object.entries(s))}function Dt(s=xt.FIVE_MINUTES,e){let t=(0,xt.toMiliseconds)(s||xt.FIVE_MINUTES),i,r,n,o;return{resolve:a=>{n&&i&&(clearTimeout(n),i(a),o=Promise.resolve(a))},reject:a=>{n&&r&&(clearTimeout(n),r(a))},done:()=>new Promise((a,c)=>{if(o)return a(o);n=setTimeout(()=>{let h=new Error(e);o=Promise.reject(h),c(h)},t),i=a,r=c})}}function Lt(s,e,t){return new Promise((i,r)=>l(this,null,function*(){let n=setTimeout(()=>r(new Error(t)),e);try{let o=yield s;i(o)}catch(o){r(o)}clearTimeout(n)}))}function Cc(s,e){if(typeof e=="string"&&e.startsWith(`${s}:`))return e;if(s.toLowerCase()==="topic"){if(typeof e!="string")throw new Error('Value must be "string" for expirer target type: topic');return`topic:${e}`}else if(s.toLowerCase()==="id"){if(typeof e!="number")throw new Error('Value must be "number" for expirer target type: id');return`id:${e}`}throw new Error(`Unknown expirer target type: ${s}`)}function _c(s){return Cc("topic",s)}function Pc(s){return Cc("id",s)}function cr(s){let[e,t]=s.split(":"),i={id:void 0,topic:void 0};if(e==="topic"&&typeof t=="string")i.topic=t;else if(e==="id"&&Number.isInteger(Number(t)))i.id=Number(t);else throw new Error(`Invalid target, expected id:number or topic:string, got ${e}:${t}`);return i}function de(s,e){return(0,xt.fromMiliseconds)((e||Date.now())+(0,xt.toMiliseconds)(s))}function yt(s){return Date.now()>=(0,xt.toMiliseconds)(s)}function X(s,e){return`${s}${e?`:${e}`:""}`}function mi(s=[],e=[]){return[...new Set([...s,...e])]}function Sc(i){return l(this,arguments,function*({id:s,topic:e,wcDeepLink:t}){var r;try{if(!t)return;let n=typeof t=="string"?JSON.parse(t):t,o=n?.href;if(typeof o!="string")return;let a=Mp(o,s,e),c=fi();if(c===$e.browser){if(!((r=(0,kt.getDocument)())!=null&&r.hasFocus())){console.warn("Document does not have focus, skipping deeplink.");return}Vp(a)}else c===$e.reactNative&&typeof(global==null?void 0:global.Linking)<"u"&&(yield global.Linking.openURL(a))}catch(n){console.error(n)}})}function Mp(s,e,t){let i=`requestId=${e}&sessionTopic=${t}`;s.endsWith("/")&&(s=s.slice(0,-1));let r=`${s}`;if(s.startsWith("https://t.me")){let n=s.includes("?")?"&startapp=":"?startapp=";r=`${r}${n}${Kp(i,!0)}`}else r=`${r}/wc?${i}`;return r}function Vp(s){let e="_self";zp()?e="_top":(Hp()||s.startsWith("https://")||s.startsWith("http://"))&&(e="_blank"),window.open(s,e,"noreferrer noopener")}function Ac(s,e){return l(this,null,function*(){let t="";try{if(Ns()&&(t=localStorage.getItem(e),t))return t;t=yield s.getItem(e)}catch(i){console.error(i)}return t})}function En(s,e){if(!s.includes(e))return null;let t=s.split(/([&,?,=])/),i=t.indexOf(e);return t[i+2]}function In(){return typeof crypto<"u"&&crypto!=null&&crypto.randomUUID?crypto.randomUUID():"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/gu,s=>{let e=Math.random()*16|0;return(s==="x"?e:e&3|8).toString(16)})}function yi(){return typeof process<"u"&&process.env.IS_VITEST==="true"}function Hp(){return typeof window<"u"&&(!!window.TelegramWebviewProxy||!!window.Telegram||!!window.TelegramWebviewProxyProto)}function zp(){try{return window.self!==window.top}catch{return!1}}function Kp(s,e=!1){let t=Buffer.from(s).toString("base64");return e?t.replace(/[=]/g,""):t}function Nc(s){return Buffer.from(s,"base64").toString("utf-8")}function Tc(s){return new Promise(e=>setTimeout(e,s))}function hi(s){if(!Number.isSafeInteger(s)||s<0)throw new Error("positive integer expected, got "+s)}function Wp(s){return s instanceof Uint8Array||ArrayBuffer.isView(s)&&s.constructor.name==="Uint8Array"}function wi(s,...e){if(!Wp(s))throw new Error("Uint8Array expected");if(e.length>0&&!e.includes(s.length))throw new Error("Uint8Array expected of length "+e+", got length="+s.length)}function Cn(s){if(typeof s!="function"||typeof s.create!="function")throw new Error("Hash should be wrapped by utils.wrapConstructor");hi(s.outputLen),hi(s.blockLen)}function Es(s,e=!0){if(s.destroyed)throw new Error("Hash instance has been destroyed");if(e&&s.finished)throw new Error("Hash#digest() has already been called")}function Oc(s,e){wi(s);let t=e.outputLen;if(s.length<t)throw new Error("digestInto() expects output buffer of length at least "+t)}var tr=BigInt(2**32-1),za=BigInt(32);function Gp(s,e=!1){return e?{h:Number(s&tr),l:Number(s>>za&tr)}:{h:Number(s>>za&tr)|0,l:Number(s&tr)|0}}function Yp(s,e=!1){let t=new Uint32Array(s.length),i=new Uint32Array(s.length);for(let r=0;r<s.length;r++){let{h:n,l:o}=Gp(s[r],e);[t[r],i[r]]=[n,o]}return[t,i]}var Jp=(s,e,t)=>s<<t|e>>>32-t,Xp=(s,e,t)=>e<<t|s>>>32-t,Zp=(s,e,t)=>e<<t-32|s>>>64-t,Qp=(s,e,t)=>s<<t-32|e>>>64-t,ws=typeof globalThis=="object"&&"crypto"in globalThis?globalThis.crypto:void 0;function ed(s){return new Uint32Array(s.buffer,s.byteOffset,Math.floor(s.byteLength/4))}function Wr(s){return new DataView(s.buffer,s.byteOffset,s.byteLength)}function mt(s,e){return s<<32-e|s>>>e}var Ka=new Uint8Array(new Uint32Array([287454020]).buffer)[0]===68;function td(s){return s<<24&4278190080|s<<8&16711680|s>>>8&65280|s>>>24&255}function Wa(s){for(let e=0;e<s.length;e++)s[e]=td(s[e])}function sd(s){if(typeof s!="string")throw new Error("utf8ToBytes expected string, got "+typeof s);return new Uint8Array(new TextEncoder().encode(s))}function Is(s){return typeof s=="string"&&(s=sd(s)),wi(s),s}function id(...s){let e=0;for(let i=0;i<s.length;i++){let r=s[i];wi(r),e+=r.length}let t=new Uint8Array(e);for(let i=0,r=0;i<s.length;i++){let n=s[i];t.set(n,r),r+=n.length}return t}var li=class{clone(){return this._cloneInto()}};function Rc(s){let e=i=>s().update(Is(i)).digest(),t=s();return e.outputLen=t.outputLen,e.blockLen=t.blockLen,e.create=()=>s(),e}function Ts(s=32){if(ws&&typeof ws.getRandomValues=="function")return ws.getRandomValues(new Uint8Array(s));if(ws&&typeof ws.randomBytes=="function")return ws.randomBytes(s);throw new Error("crypto.getRandomValues must be defined")}var xc=[],kc=[],Uc=[],rd=BigInt(0),ai=BigInt(1),nd=BigInt(2),od=BigInt(7),ad=BigInt(256),cd=BigInt(113);for(let s=0,e=ai,t=1,i=0;s<24;s++){[t,i]=[i,(2*t+3*i)%5],xc.push(2*(5*i+t)),kc.push((s+1)*(s+2)/2%64);let r=rd;for(let n=0;n<7;n++)e=(e<<ai^(e>>od)*cd)%ad,e&nd&&(r^=ai<<(ai<<BigInt(n))-ai);Uc.push(r)}var[hd,ld]=Yp(Uc,!0),Ga=(s,e,t)=>t>32?Zp(s,e,t):Jp(s,e,t),Ya=(s,e,t)=>t>32?Qp(s,e,t):Xp(s,e,t);function pd(s,e=24){let t=new Uint32Array(10);for(let i=24-e;i<24;i++){for(let o=0;o<10;o++)t[o]=s[o]^s[o+10]^s[o+20]^s[o+30]^s[o+40];for(let o=0;o<10;o+=2){let a=(o+8)%10,c=(o+2)%10,h=t[c],p=t[c+1],d=Ga(h,p,1)^t[a],u=Ya(h,p,1)^t[a+1];for(let y=0;y<50;y+=10)s[o+y]^=d,s[o+y+1]^=u}let r=s[2],n=s[3];for(let o=0;o<24;o++){let a=kc[o],c=Ga(r,n,a),h=Ya(r,n,a),p=xc[o];r=s[p],n=s[p+1],s[p]=c,s[p+1]=h}for(let o=0;o<50;o+=10){for(let a=0;a<10;a++)t[a]=s[o+a];for(let a=0;a<10;a++)s[o+a]^=~t[(a+2)%10]&t[(a+4)%10]}s[0]^=hd[i],s[1]^=ld[i]}t.fill(0)}var nn=class s extends li{constructor(e,t,i,r=!1,n=24){if(super(),this.blockLen=e,this.suffix=t,this.outputLen=i,this.enableXOF=r,this.rounds=n,this.pos=0,this.posOut=0,this.finished=!1,this.destroyed=!1,hi(i),0>=this.blockLen||this.blockLen>=200)throw new Error("Sha3 supports only keccak-f1600 function");this.state=new Uint8Array(200),this.state32=ed(this.state)}keccak(){Ka||Wa(this.state32),pd(this.state32,this.rounds),Ka||Wa(this.state32),this.posOut=0,this.pos=0}update(e){Es(this);let{blockLen:t,state:i}=this;e=Is(e);let r=e.length;for(let n=0;n<r;){let o=Math.min(t-this.pos,r-n);for(let a=0;a<o;a++)i[this.pos++]^=e[n++];this.pos===t&&this.keccak()}return this}finish(){if(this.finished)return;this.finished=!0;let{state:e,suffix:t,pos:i,blockLen:r}=this;e[i]^=t,t&128&&i===r-1&&this.keccak(),e[r-1]^=128,this.keccak()}writeInto(e){Es(this,!1),wi(e),this.finish();let t=this.state,{blockLen:i}=this;for(let r=0,n=e.length;r<n;){this.posOut>=i&&this.keccak();let o=Math.min(i-this.posOut,n-r);e.set(t.subarray(this.posOut,this.posOut+o),r),this.posOut+=o,r+=o}return e}xofInto(e){if(!this.enableXOF)throw new Error("XOF is not possible for this instance");return this.writeInto(e)}xof(e){return hi(e),this.xofInto(new Uint8Array(e))}digestInto(e){if(Oc(e,this),this.finished)throw new Error("digest() was already called");return this.writeInto(e),this.destroy(),e}digest(){return this.digestInto(new Uint8Array(this.outputLen))}destroy(){this.destroyed=!0,this.state.fill(0)}_cloneInto(e){let{blockLen:t,suffix:i,outputLen:r,rounds:n,enableXOF:o}=this;return e||(e=new s(t,i,r,o,n)),e.state32.set(this.state32),e.pos=this.pos,e.posOut=this.posOut,e.finished=this.finished,e.rounds=n,e.suffix=i,e.outputLen=r,e.enableXOF=o,e.destroyed=this.destroyed,e}},dd=(s,e,t)=>Rc(()=>new nn(e,s,t)),ud=dd(1,136,256/8),gd="https://rpc.walletconnect.org/v1";function Dc(s){let e=`Ethereum Signed Message:
${s.length}`,t=new TextEncoder().encode(e+s);return"0x"+Buffer.from(ud(t)).toString("hex")}function fd(s,e,t,i,r,n){return l(this,null,function*(){switch(t.t){case"eip191":return yield md(s,e,t.s);case"eip1271":return yield yd(s,e,t.s,i,r,n);default:throw new Error(`verifySignature failed: Attempted to verify CacaoSignature with unknown type: ${t.t}`)}})}function md(s,e,t){return l(this,null,function*(){return(yield Kr({hash:Dc(e),signature:t})).toLowerCase()===s.toLowerCase()})}function yd(s,e,t,i,r,n){return l(this,null,function*(){let o=Wt(i);if(!o.namespace||!o.reference)throw new Error(`isValidEip1271Signature failed: chainId must be in CAIP-2 format, received: ${i}`);try{let a="0x1626ba7e",c="0000000000000000000000000000000000000000000000000000000000000040",h="0000000000000000000000000000000000000000000000000000000000000041",p=t.substring(2),d=Dc(e).substring(2),u=a+d+c+h+p,y=yield fetch(`${n||gd}/?chainId=${i}&projectId=${r}`,{method:"POST",body:JSON.stringify({id:wd(),jsonrpc:"2.0",method:"eth_call",params:[{to:s,data:u},"latest"]})}),{result:f}=yield y.json();return f?f.slice(0,a.length).toLowerCase()===a.toLowerCase():!1}catch(a){return console.error("isValidEip1271Signature: ",a),!1}})}function wd(){return Date.now()+Math.floor(Math.random()*1e3)}function Lc(s){let e=atob(s),t=new Uint8Array(e.length);for(let o=0;o<e.length;o++)t[o]=e.charCodeAt(o);let i=t[0];if(i===0)throw new Error("No signatures found");let r=1+i*64;if(t.length<r)throw new Error("Transaction data too short for claimed signature count");if(t.length<100)throw new Error("Transaction too short");let n=Buffer.from(s,"base64").slice(1,65);return er.encode(n)}var vd=Object.defineProperty,bd=Object.defineProperties,Ed=Object.getOwnPropertyDescriptors,Ja=Object.getOwnPropertySymbols,Id=Object.prototype.hasOwnProperty,Cd=Object.prototype.propertyIsEnumerable,Xa=(s,e,t)=>e in s?vd(s,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):s[e]=t,_d=(s,e)=>{for(var t in e||(e={}))Id.call(e,t)&&Xa(s,t,e[t]);if(Ja)for(var t of Ja(e))Cd.call(e,t)&&Xa(s,t,e[t]);return s},Pd=(s,e)=>bd(s,Ed(e)),Sd="did:pkh:",_n=s=>s?.split(":"),Ad=s=>{let e=s&&_n(s);if(e)return s.includes(Sd)?e[3]:e[1]},hr=s=>{let e=s&&_n(s);if(e)return e[2]+":"+e[3]},vi=s=>{let e=s&&_n(s);if(e)return e.pop()};function Pn(s){return l(this,null,function*(){let{cacao:e,projectId:t}=s,{s:i,p:r}=e,n=Sn(r,r.iss),o=vi(r.iss);return yield fd(o,n,i,hr(r.iss),t)})}var Sn=(s,e)=>{let t=`${s.domain} wants you to sign in with your Ethereum account:`,i=vi(e);if(!s.aud&&!s.uri)throw new Error("Either `aud` or `uri` is required to construct the message");let r=s.statement||void 0,n=`URI: ${s.aud||s.uri}`,o=`Version: ${s.version}`,a=`Chain ID: ${Ad(e)}`,c=`Nonce: ${s.nonce}`,h=`Issued At: ${s.iat}`,p=s.exp?`Expiration Time: ${s.exp}`:void 0,d=s.nbf?`Not Before: ${s.nbf}`:void 0,u=s.requestId?`Request ID: ${s.requestId}`:void 0,y=s.resources?`Resources:${s.resources.map(m=>`
- ${m}`).join("")}`:void 0,f=bi(s.resources);if(f){let m=pi(f);r=Ud(r,m)}return[t,i,"",r,"",n,o,a,c,h,p,d,u,y].filter(m=>m!=null).join(`
`)};function Nd(s){return Buffer.from(JSON.stringify(s)).toString("base64")}function Td(s){return JSON.parse(Buffer.from(s,"base64").toString("utf-8"))}function as(s){if(!s)throw new Error("No recap provided, value is undefined");if(!s.att)throw new Error("No `att` property found");let e=Object.keys(s.att);if(!(e!=null&&e.length))throw new Error("No resources found in `att` property");e.forEach(t=>{let i=s.att[t];if(Array.isArray(i))throw new Error(`Resource must be an object: ${t}`);if(typeof i!="object")throw new Error(`Resource must be an object: ${t}`);if(!Object.keys(i).length)throw new Error(`Resource object is empty: ${t}`);Object.keys(i).forEach(r=>{let n=i[r];if(!Array.isArray(n))throw new Error(`Ability limits ${r} must be an array of objects, found: ${n}`);if(!n.length)throw new Error(`Value of ${r} is empty array, must be an array with objects`);n.forEach(o=>{if(typeof o!="object")throw new Error(`Ability limits (${r}) must be an array of objects, found: ${o}`)})})})}function Od(s,e,t,i={}){return t?.sort((r,n)=>r.localeCompare(n)),{att:{[s]:Rd(e,t,i)}}}function Rd(s,e,t={}){e=e?.sort((r,n)=>r.localeCompare(n));let i=e.map(r=>({[`${s}/${r}`]:[t]}));return Object.assign({},...i)}function qc(s){return as(s),`urn:recap:${Nd(s).replace(/=/g,"")}`}function pi(s){let e=Td(s.replace("urn:recap:",""));return as(e),e}function Fc(s,e,t){let i=Od(s,e,t);return qc(i)}function xd(s){return s&&s.includes("urn:recap:")}function jc(s,e){let t=pi(s),i=pi(e),r=kd(t,i);return qc(r)}function kd(s,e){as(s),as(e);let t=Object.keys(s.att).concat(Object.keys(e.att)).sort((r,n)=>r.localeCompare(n)),i={att:{}};return t.forEach(r=>{var n,o;Object.keys(((n=s.att)==null?void 0:n[r])||{}).concat(Object.keys(((o=e.att)==null?void 0:o[r])||{})).sort((a,c)=>a.localeCompare(c)).forEach(a=>{var c,h;i.att[r]=Pd(_d({},i.att[r]),{[a]:((c=s.att[r])==null?void 0:c[a])||((h=e.att[r])==null?void 0:h[a])})})}),i}function Ud(s="",e){as(e);let t="I further authorize the stated URI to perform the following actions on my behalf: ";if(s.includes(t))return s;let i=[],r=0;Object.keys(e.att).forEach(a=>{let c=Object.keys(e.att[a]).map(d=>({ability:d.split("/")[0],action:d.split("/")[1]}));c.sort((d,u)=>d.action.localeCompare(u.action));let h={};c.forEach(d=>{h[d.ability]||(h[d.ability]=[]),h[d.ability].push(d.action)});let p=Object.keys(h).map(d=>(r++,`(${r}) '${d}': '${h[d].join("', '")}' for '${a}'.`));i.push(p.join(", ").replace(".,","."))});let n=i.join(" "),o=`${t}${n}`;return`${s?s+" ":""}${o}`}function An(s){var e;let t=pi(s);as(t);let i=(e=t.att)==null?void 0:e.eip155;return i?Object.keys(i).map(r=>r.split("/")[1]):[]}function Nn(s){let e=pi(s);as(e);let t=[];return Object.values(e.att).forEach(i=>{Object.values(i).forEach(r=>{var n;(n=r?.[0])!=null&&n.chains&&t.push(r[0].chains)})}),[...new Set(t.flat())]}function bi(s){if(!s)return;let e=s?.[s.length-1];return xd(e)?e:void 0}function Gr(s){if(!Number.isSafeInteger(s)||s<0)throw new Error("positive integer expected, got "+s)}function $c(s){return s instanceof Uint8Array||ArrayBuffer.isView(s)&&s.constructor.name==="Uint8Array"}function Ke(s,...e){if(!$c(s))throw new Error("Uint8Array expected");if(e.length>0&&!e.includes(s.length))throw new Error("Uint8Array expected of length "+e+", got length="+s.length)}function Za(s,e=!0){if(s.destroyed)throw new Error("Hash instance has been destroyed");if(e&&s.finished)throw new Error("Hash#digest() has already been called")}function Dd(s,e){Ke(s);let t=e.outputLen;if(s.length<t)throw new Error("digestInto() expects output buffer of length at least "+t)}function Qa(s){if(typeof s!="boolean")throw new Error(`boolean expected, not ${s}`)}var Ht=s=>new Uint32Array(s.buffer,s.byteOffset,Math.floor(s.byteLength/4)),Ld=s=>new DataView(s.buffer,s.byteOffset,s.byteLength),qd=new Uint8Array(new Uint32Array([287454020]).buffer)[0]===68;if(!qd)throw new Error("Non little-endian hardware is not supported");function Fd(s){if(typeof s!="string")throw new Error("string expected");return new Uint8Array(new TextEncoder().encode(s))}function on(s){if(typeof s=="string")s=Fd(s);else if($c(s))s=an(s);else throw new Error("Uint8Array expected, got "+typeof s);return s}function jd(s,e){if(e==null||typeof e!="object")throw new Error("options must be defined");return Object.assign(s,e)}function $d(s,e){if(s.length!==e.length)return!1;let t=0;for(let i=0;i<s.length;i++)t|=s[i]^e[i];return t===0}var Bd=(s,e)=>{function t(i,...r){if(Ke(i),s.nonceLength!==void 0){let h=r[0];if(!h)throw new Error("nonce / iv required");s.varSizeNonce?Ke(h):Ke(h,s.nonceLength)}let n=s.tagLength;n&&r[1]!==void 0&&Ke(r[1]);let o=e(i,...r),a=(h,p)=>{if(p!==void 0){if(h!==2)throw new Error("cipher output not supported");Ke(p)}},c=!1;return{encrypt(h,p){if(c)throw new Error("cannot encrypt() twice with same key + nonce");return c=!0,Ke(h),a(o.encrypt.length,p),o.encrypt(h,p)},decrypt(h,p){if(Ke(h),n&&h.length<n)throw new Error("invalid ciphertext length: smaller than tagLength="+n);return a(o.decrypt.length,p),o.decrypt(h,p)}}}return Object.assign(t,s),t};function ec(s,e,t=!0){if(e===void 0)return new Uint8Array(s);if(e.length!==s)throw new Error("invalid output length, expected "+s+", got: "+e.length);if(t&&!Md(e))throw new Error("invalid output, must be aligned");return e}function tc(s,e,t,i){if(typeof s.setBigUint64=="function")return s.setBigUint64(e,t,i);let r=BigInt(32),n=BigInt(4294967295),o=Number(t>>r&n),a=Number(t&n),c=i?4:0,h=i?0:4;s.setUint32(e+c,o,i),s.setUint32(e+h,a,i)}function Md(s){return s.byteOffset%4===0}function an(s){return Uint8Array.from(s)}function Cs(...s){for(let e=0;e<s.length;e++)s[e].fill(0)}var Bc=s=>Uint8Array.from(s.split("").map(e=>e.charCodeAt(0))),Vd=Bc("expand 16-byte k"),Hd=Bc("expand 32-byte k"),zd=Ht(Vd),Kd=Ht(Hd);function J(s,e){return s<<e|s>>>32-e}function cn(s){return s.byteOffset%4===0}var sr=64,Wd=16,Mc=2**32-1,sc=new Uint32Array;function Gd(s,e,t,i,r,n,o,a){let c=r.length,h=new Uint8Array(sr),p=Ht(h),d=cn(r)&&cn(n),u=d?Ht(r):sc,y=d?Ht(n):sc;for(let f=0;f<c;o++){if(s(e,t,i,p,o,a),o>=Mc)throw new Error("arx: counter overflow");let m=Math.min(sr,c-f);if(d&&m===sr){let g=f/4;if(f%4!==0)throw new Error("arx: invalid block position");for(let v=0,w;v<Wd;v++)w=g+v,y[w]=u[w]^p[v];f+=sr;continue}for(let g=0,v;g<m;g++)v=f+g,n[v]=r[v]^h[g];f+=m}}function Yd(s,e){let{allowShortKeys:t,extendNonceFn:i,counterLength:r,counterRight:n,rounds:o}=jd({allowShortKeys:!1,counterLength:8,counterRight:!1,rounds:20},e);if(typeof s!="function")throw new Error("core must be a function");return Gr(r),Gr(o),Qa(n),Qa(t),(a,c,h,p,d=0)=>{Ke(a),Ke(c),Ke(h);let u=h.length;if(p===void 0&&(p=new Uint8Array(u)),Ke(p),Gr(d),d<0||d>=Mc)throw new Error("arx: counter overflow");if(p.length<u)throw new Error(`arx: output (${p.length}) is shorter than data (${u})`);let y=[],f=a.length,m,g;if(f===32)y.push(m=an(a)),g=Kd;else if(f===16&&t)m=new Uint8Array(32),m.set(a),m.set(a,16),g=zd,y.push(m);else throw new Error(`arx: invalid 32-byte key, got length=${f}`);cn(c)||y.push(c=an(c));let v=Ht(m);if(i){if(c.length!==24)throw new Error("arx: extended nonce must be 24 bytes");i(g,v,Ht(c.subarray(0,16)),v),c=c.subarray(16)}let w=16-r;if(w!==c.length)throw new Error(`arx: nonce must be ${w} or 16 bytes`);if(w!==12){let _=new Uint8Array(12);_.set(c,n?0:12-c.length),c=_,y.push(c)}let b=Ht(c);return Gd(s,g,v,b,h,p,d,o),Cs(...y),p}}var Ae=(s,e)=>s[e++]&255|(s[e++]&255)<<8,hn=class{constructor(e){this.blockLen=16,this.outputLen=16,this.buffer=new Uint8Array(16),this.r=new Uint16Array(10),this.h=new Uint16Array(10),this.pad=new Uint16Array(8),this.pos=0,this.finished=!1,e=on(e),Ke(e,32);let t=Ae(e,0),i=Ae(e,2),r=Ae(e,4),n=Ae(e,6),o=Ae(e,8),a=Ae(e,10),c=Ae(e,12),h=Ae(e,14);this.r[0]=t&8191,this.r[1]=(t>>>13|i<<3)&8191,this.r[2]=(i>>>10|r<<6)&7939,this.r[3]=(r>>>7|n<<9)&8191,this.r[4]=(n>>>4|o<<12)&255,this.r[5]=o>>>1&8190,this.r[6]=(o>>>14|a<<2)&8191,this.r[7]=(a>>>11|c<<5)&8065,this.r[8]=(c>>>8|h<<8)&8191,this.r[9]=h>>>5&127;for(let p=0;p<8;p++)this.pad[p]=Ae(e,16+2*p)}process(e,t,i=!1){let r=i?0:2048,{h:n,r:o}=this,a=o[0],c=o[1],h=o[2],p=o[3],d=o[4],u=o[5],y=o[6],f=o[7],m=o[8],g=o[9],v=Ae(e,t+0),w=Ae(e,t+2),b=Ae(e,t+4),_=Ae(e,t+6),R=Ae(e,t+8),P=Ae(e,t+10),A=Ae(e,t+12),k=Ae(e,t+14),E=n[0]+(v&8191),$=n[1]+((v>>>13|w<<3)&8191),D=n[2]+((w>>>10|b<<6)&8191),q=n[3]+((b>>>7|_<<9)&8191),V=n[4]+((_>>>4|R<<12)&8191),C=n[5]+(R>>>1&8191),T=n[6]+((R>>>14|P<<2)&8191),N=n[7]+((P>>>11|A<<5)&8191),U=n[8]+((A>>>8|k<<8)&8191),L=n[9]+(k>>>5|r),S=0,M=S+E*a+$*(5*g)+D*(5*m)+q*(5*f)+V*(5*y);S=M>>>13,M&=8191,M+=C*(5*u)+T*(5*d)+N*(5*p)+U*(5*h)+L*(5*c),S+=M>>>13,M&=8191;let H=S+E*c+$*a+D*(5*g)+q*(5*m)+V*(5*f);S=H>>>13,H&=8191,H+=C*(5*y)+T*(5*u)+N*(5*d)+U*(5*p)+L*(5*h),S+=H>>>13,H&=8191;let z=S+E*h+$*c+D*a+q*(5*g)+V*(5*m);S=z>>>13,z&=8191,z+=C*(5*f)+T*(5*y)+N*(5*u)+U*(5*d)+L*(5*p),S+=z>>>13,z&=8191;let re=S+E*p+$*h+D*c+q*a+V*(5*g);S=re>>>13,re&=8191,re+=C*(5*m)+T*(5*f)+N*(5*y)+U*(5*u)+L*(5*d),S+=re>>>13,re&=8191;let te=S+E*d+$*p+D*h+q*c+V*a;S=te>>>13,te&=8191,te+=C*(5*g)+T*(5*m)+N*(5*f)+U*(5*y)+L*(5*u),S+=te>>>13,te&=8191;let ue=S+E*u+$*d+D*p+q*h+V*c;S=ue>>>13,ue&=8191,ue+=C*a+T*(5*g)+N*(5*m)+U*(5*f)+L*(5*y),S+=ue>>>13,ue&=8191;let be=S+E*y+$*u+D*d+q*p+V*h;S=be>>>13,be&=8191,be+=C*c+T*a+N*(5*g)+U*(5*m)+L*(5*f),S+=be>>>13,be&=8191;let Re=S+E*f+$*y+D*u+q*d+V*p;S=Re>>>13,Re&=8191,Re+=C*h+T*c+N*a+U*(5*g)+L*(5*m),S+=Re>>>13,Re&=8191;let fe=S+E*m+$*f+D*y+q*u+V*d;S=fe>>>13,fe&=8191,fe+=C*p+T*h+N*c+U*a+L*(5*g),S+=fe>>>13,fe&=8191;let me=S+E*g+$*m+D*f+q*y+V*u;S=me>>>13,me&=8191,me+=C*d+T*p+N*h+U*c+L*a,S+=me>>>13,me&=8191,S=(S<<2)+S|0,S=S+M|0,M=S&8191,S=S>>>13,H+=S,n[0]=M,n[1]=H,n[2]=z,n[3]=re,n[4]=te,n[5]=ue,n[6]=be,n[7]=Re,n[8]=fe,n[9]=me}finalize(){let{h:e,pad:t}=this,i=new Uint16Array(10),r=e[1]>>>13;e[1]&=8191;for(let a=2;a<10;a++)e[a]+=r,r=e[a]>>>13,e[a]&=8191;e[0]+=r*5,r=e[0]>>>13,e[0]&=8191,e[1]+=r,r=e[1]>>>13,e[1]&=8191,e[2]+=r,i[0]=e[0]+5,r=i[0]>>>13,i[0]&=8191;for(let a=1;a<10;a++)i[a]=e[a]+r,r=i[a]>>>13,i[a]&=8191;i[9]-=8192;let n=(r^1)-1;for(let a=0;a<10;a++)i[a]&=n;n=~n;for(let a=0;a<10;a++)e[a]=e[a]&n|i[a];e[0]=(e[0]|e[1]<<13)&65535,e[1]=(e[1]>>>3|e[2]<<10)&65535,e[2]=(e[2]>>>6|e[3]<<7)&65535,e[3]=(e[3]>>>9|e[4]<<4)&65535,e[4]=(e[4]>>>12|e[5]<<1|e[6]<<14)&65535,e[5]=(e[6]>>>2|e[7]<<11)&65535,e[6]=(e[7]>>>5|e[8]<<8)&65535,e[7]=(e[8]>>>8|e[9]<<5)&65535;let o=e[0]+t[0];e[0]=o&65535;for(let a=1;a<8;a++)o=(e[a]+t[a]|0)+(o>>>16)|0,e[a]=o&65535;Cs(i)}update(e){Za(this);let{buffer:t,blockLen:i}=this;e=on(e);let r=e.length;for(let n=0;n<r;){let o=Math.min(i-this.pos,r-n);if(o===i){for(;i<=r-n;n+=i)this.process(e,n);continue}t.set(e.subarray(n,n+o),this.pos),this.pos+=o,n+=o,this.pos===i&&(this.process(t,0,!1),this.pos=0)}return this}destroy(){Cs(this.h,this.r,this.buffer,this.pad)}digestInto(e){Za(this),Dd(e,this),this.finished=!0;let{buffer:t,h:i}=this,{pos:r}=this;if(r){for(t[r++]=1;r<16;r++)t[r]=0;this.process(t,0,!0)}this.finalize();let n=0;for(let o=0;o<8;o++)e[n++]=i[o]>>>0,e[n++]=i[o]>>>8;return e}digest(){let{buffer:e,outputLen:t}=this;this.digestInto(e);let i=e.slice(0,t);return this.destroy(),i}};function Jd(s){let e=(i,r)=>s(r).update(on(i)).digest(),t=s(new Uint8Array(32));return e.outputLen=t.outputLen,e.blockLen=t.blockLen,e.create=i=>s(i),e}var Xd=Jd(s=>new hn(s));function Zd(s,e,t,i,r,n=20){let o=s[0],a=s[1],c=s[2],h=s[3],p=e[0],d=e[1],u=e[2],y=e[3],f=e[4],m=e[5],g=e[6],v=e[7],w=r,b=t[0],_=t[1],R=t[2],P=o,A=a,k=c,E=h,$=p,D=d,q=u,V=y,C=f,T=m,N=g,U=v,L=w,S=b,M=_,H=R;for(let re=0;re<n;re+=2)P=P+$|0,L=J(L^P,16),C=C+L|0,$=J($^C,12),P=P+$|0,L=J(L^P,8),C=C+L|0,$=J($^C,7),A=A+D|0,S=J(S^A,16),T=T+S|0,D=J(D^T,12),A=A+D|0,S=J(S^A,8),T=T+S|0,D=J(D^T,7),k=k+q|0,M=J(M^k,16),N=N+M|0,q=J(q^N,12),k=k+q|0,M=J(M^k,8),N=N+M|0,q=J(q^N,7),E=E+V|0,H=J(H^E,16),U=U+H|0,V=J(V^U,12),E=E+V|0,H=J(H^E,8),U=U+H|0,V=J(V^U,7),P=P+D|0,H=J(H^P,16),N=N+H|0,D=J(D^N,12),P=P+D|0,H=J(H^P,8),N=N+H|0,D=J(D^N,7),A=A+q|0,L=J(L^A,16),U=U+L|0,q=J(q^U,12),A=A+q|0,L=J(L^A,8),U=U+L|0,q=J(q^U,7),k=k+V|0,S=J(S^k,16),C=C+S|0,V=J(V^C,12),k=k+V|0,S=J(S^k,8),C=C+S|0,V=J(V^C,7),E=E+$|0,M=J(M^E,16),T=T+M|0,$=J($^T,12),E=E+$|0,M=J(M^E,8),T=T+M|0,$=J($^T,7);let z=0;i[z++]=o+P|0,i[z++]=a+A|0,i[z++]=c+k|0,i[z++]=h+E|0,i[z++]=p+$|0,i[z++]=d+D|0,i[z++]=u+q|0,i[z++]=y+V|0,i[z++]=f+C|0,i[z++]=m+T|0,i[z++]=g+N|0,i[z++]=v+U|0,i[z++]=w+L|0,i[z++]=b+S|0,i[z++]=_+M|0,i[z++]=R+H|0}var Qd=Yd(Zd,{counterRight:!1,counterLength:4,allowShortKeys:!1}),eu=new Uint8Array(16),ic=(s,e)=>{s.update(e);let t=e.length%16;t&&s.update(eu.subarray(t))},tu=new Uint8Array(32);function rc(s,e,t,i,r){let n=s(e,t,tu),o=Xd.create(n);r&&ic(o,r),ic(o,i);let a=new Uint8Array(16),c=Ld(a);tc(c,0,BigInt(r?r.length:0),!0),tc(c,8,BigInt(i.length),!0),o.update(a);let h=o.digest();return Cs(n,a),h}var su=s=>(e,t,i)=>({encrypt(r,n){let o=r.length;n=ec(o+16,n,!1),n.set(r);let a=n.subarray(0,-16);s(e,t,a,a,1);let c=rc(s,e,t,a,i);return n.set(c,o),Cs(c),n},decrypt(r,n){n=ec(r.length-16,n,!1);let o=r.subarray(0,-16),a=r.subarray(-16),c=rc(s,e,t,o,i);if(!$d(a,c))throw new Error("invalid tag");return n.set(r.subarray(0,-16)),s(e,t,n,n,1),Cs(c),n}}),Vc=Bd({blockSize:64,nonceLength:12,tagLength:16},su(Qd)),rr=class extends li{constructor(e,t){super(),this.finished=!1,this.destroyed=!1,Cn(e);let i=Is(t);if(this.iHash=e.create(),typeof this.iHash.update!="function")throw new Error("Expected instance of class which extends utils.Hash");this.blockLen=this.iHash.blockLen,this.outputLen=this.iHash.outputLen;let r=this.blockLen,n=new Uint8Array(r);n.set(i.length>r?e.create().update(i).digest():i);for(let o=0;o<n.length;o++)n[o]^=54;this.iHash.update(n),this.oHash=e.create();for(let o=0;o<n.length;o++)n[o]^=106;this.oHash.update(n),n.fill(0)}update(e){return Es(this),this.iHash.update(e),this}digestInto(e){Es(this),wi(e,this.outputLen),this.finished=!0,this.iHash.digestInto(e),this.oHash.update(e),this.oHash.digestInto(e),this.destroy()}digest(){let e=new Uint8Array(this.oHash.outputLen);return this.digestInto(e),e}_cloneInto(e){e||(e=Object.create(Object.getPrototypeOf(this),{}));let{oHash:t,iHash:i,finished:r,destroyed:n,blockLen:o,outputLen:a}=this;return e=e,e.finished=r,e.destroyed=n,e.blockLen=o,e.outputLen=a,e.oHash=t._cloneInto(e.oHash),e.iHash=i._cloneInto(e.iHash),e}destroy(){this.destroyed=!0,this.oHash.destroy(),this.iHash.destroy()}},lr=(s,e,t)=>new rr(s,e).update(t).digest();lr.create=(s,e)=>new rr(s,e);function iu(s,e,t){return Cn(s),t===void 0&&(t=new Uint8Array(s.outputLen)),lr(s,Is(t),Is(e))}var Yr=new Uint8Array([0]),nc=new Uint8Array;function ru(s,e,t,i=32){if(Cn(s),hi(i),i>255*s.outputLen)throw new Error("Length should be <= 255*HashLen");let r=Math.ceil(i/s.outputLen);t===void 0&&(t=nc);let n=new Uint8Array(r*s.outputLen),o=lr.create(s,e),a=o._cloneInto(),c=new Uint8Array(o.outputLen);for(let h=0;h<r;h++)Yr[0]=h+1,a.update(h===0?nc:c).update(t).update(Yr).digestInto(c),n.set(c,s.outputLen*h),o._cloneInto(a);return o.destroy(),a.destroy(),c.fill(0),Yr.fill(0),n.slice(0,i)}var nu=(s,e,t,i,r)=>ru(s,iu(s,e,t),i,r);function ou(s,e,t,i){if(typeof s.setBigUint64=="function")return s.setBigUint64(e,t,i);let r=BigInt(32),n=BigInt(4294967295),o=Number(t>>r&n),a=Number(t&n),c=i?4:0,h=i?0:4;s.setUint32(e+c,o,i),s.setUint32(e+h,a,i)}function au(s,e,t){return s&e^~s&t}function cu(s,e,t){return s&e^s&t^e&t}var ln=class extends li{constructor(e,t,i,r){super(),this.blockLen=e,this.outputLen=t,this.padOffset=i,this.isLE=r,this.finished=!1,this.length=0,this.pos=0,this.destroyed=!1,this.buffer=new Uint8Array(e),this.view=Wr(this.buffer)}update(e){Es(this);let{view:t,buffer:i,blockLen:r}=this;e=Is(e);let n=e.length;for(let o=0;o<n;){let a=Math.min(r-this.pos,n-o);if(a===r){let c=Wr(e);for(;r<=n-o;o+=r)this.process(c,o);continue}i.set(e.subarray(o,o+a),this.pos),this.pos+=a,o+=a,this.pos===r&&(this.process(t,0),this.pos=0)}return this.length+=e.length,this.roundClean(),this}digestInto(e){Es(this),Oc(e,this),this.finished=!0;let{buffer:t,view:i,blockLen:r,isLE:n}=this,{pos:o}=this;t[o++]=128,this.buffer.subarray(o).fill(0),this.padOffset>r-o&&(this.process(i,0),o=0);for(let d=o;d<r;d++)t[d]=0;ou(i,r-8,BigInt(this.length*8),n),this.process(i,0);let a=Wr(e),c=this.outputLen;if(c%4)throw new Error("_sha2: outputLen should be aligned to 32bit");let h=c/4,p=this.get();if(h>p.length)throw new Error("_sha2: outputLen bigger than state");for(let d=0;d<h;d++)a.setUint32(4*d,p[d],n)}digest(){let{buffer:e,outputLen:t}=this;this.digestInto(e);let i=e.slice(0,t);return this.destroy(),i}_cloneInto(e){e||(e=new this.constructor),e.set(...this.get());let{blockLen:t,buffer:i,length:r,finished:n,destroyed:o,pos:a}=this;return e.length=r,e.pos=a,e.finished=n,e.destroyed=o,r%t&&e.buffer.set(i),e}},hu=new Uint32Array([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]),Mt=new Uint32Array([1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225]),Vt=new Uint32Array(64),pn=class extends ln{constructor(){super(64,32,8,!1),this.A=Mt[0]|0,this.B=Mt[1]|0,this.C=Mt[2]|0,this.D=Mt[3]|0,this.E=Mt[4]|0,this.F=Mt[5]|0,this.G=Mt[6]|0,this.H=Mt[7]|0}get(){let{A:e,B:t,C:i,D:r,E:n,F:o,G:a,H:c}=this;return[e,t,i,r,n,o,a,c]}set(e,t,i,r,n,o,a,c){this.A=e|0,this.B=t|0,this.C=i|0,this.D=r|0,this.E=n|0,this.F=o|0,this.G=a|0,this.H=c|0}process(e,t){for(let d=0;d<16;d++,t+=4)Vt[d]=e.getUint32(t,!1);for(let d=16;d<64;d++){let u=Vt[d-15],y=Vt[d-2],f=mt(u,7)^mt(u,18)^u>>>3,m=mt(y,17)^mt(y,19)^y>>>10;Vt[d]=m+Vt[d-7]+f+Vt[d-16]|0}let{A:i,B:r,C:n,D:o,E:a,F:c,G:h,H:p}=this;for(let d=0;d<64;d++){let u=mt(a,6)^mt(a,11)^mt(a,25),y=p+u+au(a,c,h)+hu[d]+Vt[d]|0,f=(mt(i,2)^mt(i,13)^mt(i,22))+cu(i,r,n)|0;p=h,h=c,c=a,a=o+y|0,o=n,n=r,r=i,i=y+f|0}i=i+this.A|0,r=r+this.B|0,n=n+this.C|0,o=o+this.D|0,a=a+this.E|0,c=c+this.F|0,h=h+this.G|0,p=p+this.H|0,this.set(i,r,n,o,a,c,h,p)}roundClean(){Vt.fill(0)}destroy(){this.set(0,0,0,0,0,0,0,0),this.buffer.fill(0)}},Ei=Rc(()=>new pn);var pr=BigInt(0),dr=BigInt(1),lu=BigInt(2);function cs(s){return s instanceof Uint8Array||ArrayBuffer.isView(s)&&s.constructor.name==="Uint8Array"}function Ii(s){if(!cs(s))throw new Error("Uint8Array expected")}function _s(s,e){if(typeof e!="boolean")throw new Error(s+" boolean expected, got "+e)}var pu=Array.from({length:256},(s,e)=>e.toString(16).padStart(2,"0"));function Ps(s){Ii(s);let e="";for(let t=0;t<s.length;t++)e+=pu[s[t]];return e}function bs(s){let e=s.toString(16);return e.length&1?"0"+e:e}function Tn(s){if(typeof s!="string")throw new Error("hex string expected, got "+typeof s);return s===""?pr:BigInt("0x"+s)}var Nt={_0:48,_9:57,A:65,F:70,a:97,f:102};function oc(s){if(s>=Nt._0&&s<=Nt._9)return s-Nt._0;if(s>=Nt.A&&s<=Nt.F)return s-(Nt.A-10);if(s>=Nt.a&&s<=Nt.f)return s-(Nt.a-10)}function Ss(s){if(typeof s!="string")throw new Error("hex string expected, got "+typeof s);let e=s.length,t=e/2;if(e%2)throw new Error("hex string expected, got unpadded hex of length "+e);let i=new Uint8Array(t);for(let r=0,n=0;r<t;r++,n+=2){let o=oc(s.charCodeAt(n)),a=oc(s.charCodeAt(n+1));if(o===void 0||a===void 0){let c=s[n]+s[n+1];throw new Error('hex string expected, got non-hex character "'+c+'" at index '+n)}i[r]=o*16+a}return i}function os(s){return Tn(Ps(s))}function di(s){return Ii(s),Tn(Ps(Uint8Array.from(s).reverse()))}function As(s,e){return Ss(s.toString(16).padStart(e*2,"0"))}function ur(s,e){return As(s,e).reverse()}function du(s){return Ss(bs(s))}function ze(s,e,t){let i;if(typeof e=="string")try{i=Ss(e)}catch(n){throw new Error(s+" must be hex string or Uint8Array, cause: "+n)}else if(cs(e))i=Uint8Array.from(e);else throw new Error(s+" must be hex string or Uint8Array");let r=i.length;if(typeof t=="number"&&r!==t)throw new Error(s+" of length "+t+" expected, got "+r);return i}function ui(...s){let e=0;for(let i=0;i<s.length;i++){let r=s[i];Ii(r),e+=r.length}let t=new Uint8Array(e);for(let i=0,r=0;i<s.length;i++){let n=s[i];t.set(n,r),r+=n.length}return t}function uu(s,e){if(s.length!==e.length)return!1;let t=0;for(let i=0;i<s.length;i++)t|=s[i]^e[i];return t===0}function gu(s){if(typeof s!="string")throw new Error("string expected");return new Uint8Array(new TextEncoder().encode(s))}var Jr=s=>typeof s=="bigint"&&pr<=s;function gr(s,e,t){return Jr(s)&&Jr(e)&&Jr(t)&&e<=s&&s<t}function Rt(s,e,t,i){if(!gr(e,t,i))throw new Error("expected valid "+s+": "+t+" <= n < "+i+", got "+e)}function Hc(s){let e;for(e=0;s>pr;s>>=dr,e+=1);return e}function fu(s,e){return s>>BigInt(e)&dr}function mu(s,e,t){return s|(t?dr:pr)<<BigInt(e)}var On=s=>(lu<<BigInt(s-1))-dr,Xr=s=>new Uint8Array(s),ac=s=>Uint8Array.from(s);function zc(s,e,t){if(typeof s!="number"||s<2)throw new Error("hashLen must be a number");if(typeof e!="number"||e<2)throw new Error("qByteLen must be a number");if(typeof t!="function")throw new Error("hmacFn must be a function");let i=Xr(s),r=Xr(s),n=0,o=()=>{i.fill(1),r.fill(0),n=0},a=(...p)=>t(r,i,...p),c=(p=Xr())=>{r=a(ac([0]),p),i=a(),p.length!==0&&(r=a(ac([1]),p),i=a())},h=()=>{if(n++>=1e3)throw new Error("drbg: tried 1000 values");let p=0,d=[];for(;p<e;){i=a();let u=i.slice();d.push(u),p+=i.length}return ui(...d)};return(p,d)=>{o(),c(p);let u;for(;!(u=d(h()));)c();return o(),u}}var yu={bigint:s=>typeof s=="bigint",function:s=>typeof s=="function",boolean:s=>typeof s=="boolean",string:s=>typeof s=="string",stringOrUint8Array:s=>typeof s=="string"||cs(s),isSafeInteger:s=>Number.isSafeInteger(s),array:s=>Array.isArray(s),field:(s,e)=>e.Fp.isValid(s),hash:s=>typeof s=="function"&&Number.isSafeInteger(s.outputLen)};function Os(s,e,t={}){let i=(r,n,o)=>{let a=yu[n];if(typeof a!="function")throw new Error("invalid validator function");let c=s[r];if(!(o&&c===void 0)&&!a(c,s))throw new Error("param "+String(r)+" is invalid. Expected "+n+", got "+c)};for(let[r,n]of Object.entries(e))i(r,n,!1);for(let[r,n]of Object.entries(t))i(r,n,!0);return s}var wu=()=>{throw new Error("not implemented")};function dn(s){let e=new WeakMap;return(t,...i)=>{let r=e.get(t);if(r!==void 0)return r;let n=s(t,...i);return e.set(t,n),n}}var vu=Object.freeze({__proto__:null,isBytes:cs,abytes:Ii,abool:_s,bytesToHex:Ps,numberToHexUnpadded:bs,hexToNumber:Tn,hexToBytes:Ss,bytesToNumberBE:os,bytesToNumberLE:di,numberToBytesBE:As,numberToBytesLE:ur,numberToVarBytesBE:du,ensureBytes:ze,concatBytes:ui,equalBytes:uu,utf8ToBytes:gu,inRange:gr,aInRange:Rt,bitLen:Hc,bitGet:fu,bitSet:mu,bitMask:On,createHmacDrbg:zc,validateObject:Os,notImplemented:wu,memoized:dn}),Ce=BigInt(0),pe=BigInt(1),rs=BigInt(2),bu=BigInt(3),un=BigInt(4),cc=BigInt(5),hc=BigInt(8);function je(s,e){let t=s%e;return t>=Ce?t:e+t}function Kc(s,e,t){if(e<Ce)throw new Error("invalid exponent, negatives unsupported");if(t<=Ce)throw new Error("invalid modulus");if(t===pe)return Ce;let i=pe;for(;e>Ce;)e&pe&&(i=i*s%t),s=s*s%t,e>>=pe;return i}function ot(s,e,t){let i=s;for(;e-- >Ce;)i*=i,i%=t;return i}function gn(s,e){if(s===Ce)throw new Error("invert: expected non-zero number");if(e<=Ce)throw new Error("invert: expected positive modulus, got "+e);let t=je(s,e),i=e,r=Ce,n=pe;for(;t!==Ce;){let o=i/t,a=i%t,c=r-n*o;i=t,t=a,r=n,n=c}if(i!==pe)throw new Error("invert: does not exist");return je(r,e)}function Eu(s){let e=(s-pe)/rs,t,i,r;for(t=s-pe,i=0;t%rs===Ce;t/=rs,i++);for(r=rs;r<s&&Kc(r,e,s)!==s-pe;r++)if(r>1e3)throw new Error("Cannot find square root: likely non-prime P");if(i===1){let o=(s+pe)/un;return function(a,c){let h=a.pow(c,o);if(!a.eql(a.sqr(h),c))throw new Error("Cannot find square root");return h}}let n=(t+pe)/rs;return function(o,a){if(o.pow(a,e)===o.neg(o.ONE))throw new Error("Cannot find square root");let c=i,h=o.pow(o.mul(o.ONE,r),t),p=o.pow(a,n),d=o.pow(a,t);for(;!o.eql(d,o.ONE);){if(o.eql(d,o.ZERO))return o.ZERO;let u=1;for(let f=o.sqr(d);u<c&&!o.eql(f,o.ONE);u++)f=o.sqr(f);let y=o.pow(h,pe<<BigInt(c-u-1));h=o.sqr(y),p=o.mul(p,y),d=o.mul(d,h),c=u}return p}}function Iu(s){if(s%un===bu){let e=(s+pe)/un;return function(t,i){let r=t.pow(i,e);if(!t.eql(t.sqr(r),i))throw new Error("Cannot find square root");return r}}if(s%hc===cc){let e=(s-cc)/hc;return function(t,i){let r=t.mul(i,rs),n=t.pow(r,e),o=t.mul(i,n),a=t.mul(t.mul(o,rs),n),c=t.mul(o,t.sub(a,t.ONE));if(!t.eql(t.sqr(c),i))throw new Error("Cannot find square root");return c}}return Eu(s)}var Cu=["create","isValid","is0","neg","inv","sqrt","sqr","eql","add","sub","mul","pow","div","addN","subN","mulN","sqrN"];function _u(s){let e={ORDER:"bigint",MASK:"bigint",BYTES:"isSafeInteger",BITS:"isSafeInteger"},t=Cu.reduce((i,r)=>(i[r]="function",i),e);return Os(s,t)}function Pu(s,e,t){if(t<Ce)throw new Error("invalid exponent, negatives unsupported");if(t===Ce)return s.ONE;if(t===pe)return e;let i=s.ONE,r=e;for(;t>Ce;)t&pe&&(i=s.mul(i,r)),r=s.sqr(r),t>>=pe;return i}function Su(s,e){let t=new Array(e.length),i=e.reduce((n,o,a)=>s.is0(o)?n:(t[a]=n,s.mul(n,o)),s.ONE),r=s.inv(i);return e.reduceRight((n,o,a)=>s.is0(o)?n:(t[a]=s.mul(n,t[a]),s.mul(n,o)),r),t}function Wc(s,e){let t=e!==void 0?e:s.toString(2).length,i=Math.ceil(t/8);return{nBitLength:t,nByteLength:i}}function Gc(s,e,t=!1,i={}){if(s<=Ce)throw new Error("invalid field: expected ORDER > 0, got "+s);let{nBitLength:r,nByteLength:n}=Wc(s,e);if(n>2048)throw new Error("invalid field: expected ORDER of <= 2048 bytes");let o,a=Object.freeze({ORDER:s,isLE:t,BITS:r,BYTES:n,MASK:On(r),ZERO:Ce,ONE:pe,create:c=>je(c,s),isValid:c=>{if(typeof c!="bigint")throw new Error("invalid field element: expected bigint, got "+typeof c);return Ce<=c&&c<s},is0:c=>c===Ce,isOdd:c=>(c&pe)===pe,neg:c=>je(-c,s),eql:(c,h)=>c===h,sqr:c=>je(c*c,s),add:(c,h)=>je(c+h,s),sub:(c,h)=>je(c-h,s),mul:(c,h)=>je(c*h,s),pow:(c,h)=>Pu(a,c,h),div:(c,h)=>je(c*gn(h,s),s),sqrN:c=>c*c,addN:(c,h)=>c+h,subN:(c,h)=>c-h,mulN:(c,h)=>c*h,inv:c=>gn(c,s),sqrt:i.sqrt||(c=>(o||(o=Iu(s)),o(a,c))),invertBatch:c=>Su(a,c),cmov:(c,h,p)=>p?h:c,toBytes:c=>t?ur(c,n):As(c,n),fromBytes:c=>{if(c.length!==n)throw new Error("Field.fromBytes: expected "+n+" bytes, got "+c.length);return t?di(c):os(c)}});return Object.freeze(a)}function Yc(s){if(typeof s!="bigint")throw new Error("field order must be bigint");let e=s.toString(2).length;return Math.ceil(e/8)}function Jc(s){let e=Yc(s);return e+Math.ceil(e/2)}function Au(s,e,t=!1){let i=s.length,r=Yc(e),n=Jc(e);if(i<16||i<n||i>1024)throw new Error("expected "+n+"-1024 bytes of input, got "+i);let o=t?di(s):os(s),a=je(o,e-pe)+pe;return t?ur(a,r):As(a,r)}var lc=BigInt(0),ir=BigInt(1);function Zr(s,e){let t=e.negate();return s?t:e}function Xc(s,e){if(!Number.isSafeInteger(s)||s<=0||s>e)throw new Error("invalid window size, expected [1.."+e+"], got W="+s)}function Qr(s,e){Xc(s,e);let t=Math.ceil(e/s)+1,i=2**(s-1);return{windows:t,windowSize:i}}function Nu(s,e){if(!Array.isArray(s))throw new Error("array expected");s.forEach((t,i)=>{if(!(t instanceof e))throw new Error("invalid point at index "+i)})}function Tu(s,e){if(!Array.isArray(s))throw new Error("array of scalars expected");s.forEach((t,i)=>{if(!e.isValid(t))throw new Error("invalid scalar at index "+i)})}var en=new WeakMap,Zc=new WeakMap;function tn(s){return Zc.get(s)||1}function Ou(s,e){return{constTimeNegate:Zr,hasPrecomputes(t){return tn(t)!==1},unsafeLadder(t,i,r=s.ZERO){let n=t;for(;i>lc;)i&ir&&(r=r.add(n)),n=n.double(),i>>=ir;return r},precomputeWindow(t,i){let{windows:r,windowSize:n}=Qr(i,e),o=[],a=t,c=a;for(let h=0;h<r;h++){c=a,o.push(c);for(let p=1;p<n;p++)c=c.add(a),o.push(c);a=c.double()}return o},wNAF(t,i,r){let{windows:n,windowSize:o}=Qr(t,e),a=s.ZERO,c=s.BASE,h=BigInt(2**t-1),p=2**t,d=BigInt(t);for(let u=0;u<n;u++){let y=u*o,f=Number(r&h);r>>=d,f>o&&(f-=p,r+=ir);let m=y,g=y+Math.abs(f)-1,v=u%2!==0,w=f<0;f===0?c=c.add(Zr(v,i[m])):a=a.add(Zr(w,i[g]))}return{p:a,f:c}},wNAFUnsafe(t,i,r,n=s.ZERO){let{windows:o,windowSize:a}=Qr(t,e),c=BigInt(2**t-1),h=2**t,p=BigInt(t);for(let d=0;d<o;d++){let u=d*a;if(r===lc)break;let y=Number(r&c);if(r>>=p,y>a&&(y-=h,r+=ir),y===0)continue;let f=i[u+Math.abs(y)-1];y<0&&(f=f.negate()),n=n.add(f)}return n},getPrecomputes(t,i,r){let n=en.get(i);return n||(n=this.precomputeWindow(i,t),t!==1&&en.set(i,r(n))),n},wNAFCached(t,i,r){let n=tn(t);return this.wNAF(n,this.getPrecomputes(n,t,r),i)},wNAFCachedUnsafe(t,i,r,n){let o=tn(t);return o===1?this.unsafeLadder(t,i,n):this.wNAFUnsafe(o,this.getPrecomputes(o,t,r),i,n)},setWindowSize(t,i){Xc(i,e),Zc.set(t,i),en.delete(t)}}}function Ru(s,e,t,i){if(Nu(t,s),Tu(i,e),t.length!==i.length)throw new Error("arrays of points and scalars must have equal length");let r=s.ZERO,n=Hc(BigInt(t.length)),o=n>12?n-3:n>4?n-2:n?2:1,a=(1<<o)-1,c=new Array(a+1).fill(r),h=Math.floor((e.BITS-1)/o)*o,p=r;for(let d=h;d>=0;d-=o){c.fill(r);for(let y=0;y<i.length;y++){let f=i[y],m=Number(f>>BigInt(d)&BigInt(a));c[m]=c[m].add(t[y])}let u=r;for(let y=c.length-1,f=r;y>0;y--)f=f.add(c[y]),u=u.add(f);if(p=p.add(u),d!==0)for(let y=0;y<o;y++)p=p.double()}return p}function Qc(s){return _u(s.Fp),Os(s,{n:"bigint",h:"bigint",Gx:"field",Gy:"field"},{nBitLength:"isSafeInteger",nByteLength:"isSafeInteger"}),Object.freeze(Ee(F(F({},Wc(s.n,s.nBitLength)),s),{p:s.Fp.ORDER}))}BigInt(0),BigInt(1),BigInt(2),BigInt(8);var vs=BigInt(0),sn=BigInt(1);function xu(s){return Os(s,{a:"bigint"},{montgomeryBits:"isSafeInteger",nByteLength:"isSafeInteger",adjustScalarBytes:"function",domain:"function",powPminus2:"function",Gu:"bigint"}),Object.freeze(F({},s))}function ku(s){let e=xu(s),{P:t}=e,i=w=>je(w,t),r=e.montgomeryBits,n=Math.ceil(r/8),o=e.nByteLength,a=e.adjustScalarBytes||(w=>w),c=e.powPminus2||(w=>Kc(w,t-BigInt(2),t));function h(w,b,_){let R=i(w*(b-_));return b=i(b-R),_=i(_+R),[b,_]}let p=(e.a-BigInt(2))/BigInt(4);function d(w,b){Rt("u",w,vs,t),Rt("scalar",b,vs,t);let _=b,R=w,P=sn,A=vs,k=w,E=sn,$=vs,D;for(let V=BigInt(r-1);V>=vs;V--){let C=_>>V&sn;$^=C,D=h($,P,k),P=D[0],k=D[1],D=h($,A,E),A=D[0],E=D[1],$=C;let T=P+A,N=i(T*T),U=P-A,L=i(U*U),S=N-L,M=k+E,H=k-E,z=i(H*T),re=i(M*U),te=z+re,ue=z-re;k=i(te*te),E=i(R*i(ue*ue)),P=i(N*L),A=i(S*(N+i(p*S)))}D=h($,P,k),P=D[0],k=D[1],D=h($,A,E),A=D[0],E=D[1];let q=c(A);return i(P*q)}function u(w){return ur(i(w),n)}function y(w){let b=ze("u coordinate",w,n);return o===32&&(b[31]&=127),di(b)}function f(w){let b=ze("scalar",w),_=b.length;if(_!==n&&_!==o){let R=""+n+" or "+o;throw new Error("invalid scalar, expected "+R+" bytes, got "+_)}return di(a(b))}function m(w,b){let _=y(b),R=f(w),P=d(_,R);if(P===vs)throw new Error("invalid private or public key received");return u(P)}let g=u(e.Gu);function v(w){return m(w,g)}return{scalarMult:m,scalarMultBase:v,getSharedSecret:(w,b)=>m(w,b),getPublicKey:w=>v(w),utils:{randomPrivateKey:()=>e.randomBytes(e.nByteLength)},GuBytes:g}}var fn=BigInt("57896044618658097711785492504343953926634992332820282019728792003956564819949");BigInt(0);var Uu=BigInt(1),pc=BigInt(2),Du=BigInt(3),Lu=BigInt(5);BigInt(8);function qu(s){let e=BigInt(10),t=BigInt(20),i=BigInt(40),r=BigInt(80),n=fn,o=s*s%n*s%n,a=ot(o,pc,n)*o%n,c=ot(a,Uu,n)*s%n,h=ot(c,Lu,n)*c%n,p=ot(h,e,n)*h%n,d=ot(p,t,n)*p%n,u=ot(d,i,n)*d%n,y=ot(u,r,n)*u%n,f=ot(y,r,n)*u%n,m=ot(f,e,n)*h%n;return{pow_p_5_8:ot(m,pc,n)*s%n,b2:o}}function Fu(s){return s[0]&=248,s[31]&=127,s[31]|=64,s}var mn=ku({P:fn,a:BigInt(486662),montgomeryBits:255,nByteLength:32,Gu:BigInt(9),powPminus2:s=>{let e=fn,{pow_p_5_8:t,b2:i}=qu(s);return je(ot(t,Du,e)*i,e)},adjustScalarBytes:Fu,randomBytes:Ts});function dc(s){s.lowS!==void 0&&_s("lowS",s.lowS),s.prehash!==void 0&&_s("prehash",s.prehash)}function ju(s){let e=Qc(s);Os(e,{a:"field",b:"field"},{allowedPrivateKeyLengths:"array",wrapPrivateKey:"boolean",isTorsionFree:"function",clearCofactor:"function",allowInfinityPoint:"boolean",fromBytes:"function",toBytes:"function"});let{endo:t,Fp:i,a:r}=e;if(t){if(!i.eql(r,i.ZERO))throw new Error("invalid endomorphism, can only be defined for Koblitz curves that have a=0");if(typeof t!="object"||typeof t.beta!="bigint"||typeof t.splitScalar!="function")throw new Error("invalid endomorphism, expected beta: bigint and splitScalar: function")}return Object.freeze(F({},e))}var{bytesToNumberBE:$u,hexToBytes:Bu}=vu,yn=class extends Error{constructor(e=""){super(e)}},Tt={Err:yn,_tlv:{encode:(s,e)=>{let{Err:t}=Tt;if(s<0||s>256)throw new t("tlv.encode: wrong tag");if(e.length&1)throw new t("tlv.encode: unpadded data");let i=e.length/2,r=bs(i);if(r.length/2&128)throw new t("tlv.encode: long form length too big");let n=i>127?bs(r.length/2|128):"";return bs(s)+n+r+e},decode(s,e){let{Err:t}=Tt,i=0;if(s<0||s>256)throw new t("tlv.encode: wrong tag");if(e.length<2||e[i++]!==s)throw new t("tlv.decode: wrong tlv");let r=e[i++],n=!!(r&128),o=0;if(!n)o=r;else{let c=r&127;if(!c)throw new t("tlv.decode(long): indefinite length not supported");if(c>4)throw new t("tlv.decode(long): byte length is too big");let h=e.subarray(i,i+c);if(h.length!==c)throw new t("tlv.decode: length bytes not complete");if(h[0]===0)throw new t("tlv.decode(long): zero leftmost byte");for(let p of h)o=o<<8|p;if(i+=c,o<128)throw new t("tlv.decode(long): not minimal encoding")}let a=e.subarray(i,i+o);if(a.length!==o)throw new t("tlv.decode: wrong value length");return{v:a,l:e.subarray(i+o)}}},_int:{encode(s){let{Err:e}=Tt;if(s<Ot)throw new e("integer: negative integers are not allowed");let t=bs(s);if(Number.parseInt(t[0],16)&8&&(t="00"+t),t.length&1)throw new e("unexpected DER parsing assertion: unpadded hex");return t},decode(s){let{Err:e}=Tt;if(s[0]&128)throw new e("invalid signature integer: negative");if(s[0]===0&&!(s[1]&128))throw new e("invalid signature integer: unnecessary leading zero");return $u(s)}},toSig(s){let{Err:e,_int:t,_tlv:i}=Tt,r=typeof s=="string"?Bu(s):s;Ii(r);let{v:n,l:o}=i.decode(48,r);if(o.length)throw new e("invalid signature: left bytes after parsing");let{v:a,l:c}=i.decode(2,n),{v:h,l:p}=i.decode(2,c);if(p.length)throw new e("invalid signature: left bytes after parsing");return{r:t.decode(a),s:t.decode(h)}},hexFromSig(s){let{_tlv:e,_int:t}=Tt,i=e.encode(2,t.encode(s.r)),r=e.encode(2,t.encode(s.s)),n=i+r;return e.encode(48,n)}},Ot=BigInt(0),Ie=BigInt(1);BigInt(2);var uc=BigInt(3);BigInt(4);function Mu(s){let e=ju(s),{Fp:t}=e,i=Gc(e.n,e.nBitLength),r=e.toBytes||((m,g,v)=>{let w=g.toAffine();return ui(Uint8Array.from([4]),t.toBytes(w.x),t.toBytes(w.y))}),n=e.fromBytes||(m=>{let g=m.subarray(1),v=t.fromBytes(g.subarray(0,t.BYTES)),w=t.fromBytes(g.subarray(t.BYTES,2*t.BYTES));return{x:v,y:w}});function o(m){let{a:g,b:v}=e,w=t.sqr(m),b=t.mul(w,m);return t.add(t.add(b,t.mul(m,g)),v)}if(!t.eql(t.sqr(e.Gy),o(e.Gx)))throw new Error("bad generator point: equation left != right");function a(m){return gr(m,Ie,e.n)}function c(m){let{allowedPrivateKeyLengths:g,nByteLength:v,wrapPrivateKey:w,n:b}=e;if(g&&typeof m!="bigint"){if(cs(m)&&(m=Ps(m)),typeof m!="string"||!g.includes(m.length))throw new Error("invalid private key");m=m.padStart(v*2,"0")}let _;try{_=typeof m=="bigint"?m:os(ze("private key",m,v))}catch{throw new Error("invalid private key, expected hex or "+v+" bytes, got "+typeof m)}return w&&(_=je(_,b)),Rt("private key",_,Ie,b),_}function h(m){if(!(m instanceof u))throw new Error("ProjectivePoint expected")}let p=dn((m,g)=>{let{px:v,py:w,pz:b}=m;if(t.eql(b,t.ONE))return{x:v,y:w};let _=m.is0();g==null&&(g=_?t.ONE:t.inv(b));let R=t.mul(v,g),P=t.mul(w,g),A=t.mul(b,g);if(_)return{x:t.ZERO,y:t.ZERO};if(!t.eql(A,t.ONE))throw new Error("invZ was invalid");return{x:R,y:P}}),d=dn(m=>{if(m.is0()){if(e.allowInfinityPoint&&!t.is0(m.py))return;throw new Error("bad point: ZERO")}let{x:g,y:v}=m.toAffine();if(!t.isValid(g)||!t.isValid(v))throw new Error("bad point: x or y not FE");let w=t.sqr(v),b=o(g);if(!t.eql(w,b))throw new Error("bad point: equation left != right");if(!m.isTorsionFree())throw new Error("bad point: not in prime-order subgroup");return!0});class u{constructor(g,v,w){if(this.px=g,this.py=v,this.pz=w,g==null||!t.isValid(g))throw new Error("x required");if(v==null||!t.isValid(v))throw new Error("y required");if(w==null||!t.isValid(w))throw new Error("z required");Object.freeze(this)}static fromAffine(g){let{x:v,y:w}=g||{};if(!g||!t.isValid(v)||!t.isValid(w))throw new Error("invalid affine point");if(g instanceof u)throw new Error("projective point not allowed");let b=_=>t.eql(_,t.ZERO);return b(v)&&b(w)?u.ZERO:new u(v,w,t.ONE)}get x(){return this.toAffine().x}get y(){return this.toAffine().y}static normalizeZ(g){let v=t.invertBatch(g.map(w=>w.pz));return g.map((w,b)=>w.toAffine(v[b])).map(u.fromAffine)}static fromHex(g){let v=u.fromAffine(n(ze("pointHex",g)));return v.assertValidity(),v}static fromPrivateKey(g){return u.BASE.multiply(c(g))}static msm(g,v){return Ru(u,i,g,v)}_setWindowSize(g){f.setWindowSize(this,g)}assertValidity(){d(this)}hasEvenY(){let{y:g}=this.toAffine();if(t.isOdd)return!t.isOdd(g);throw new Error("Field doesn't support isOdd")}equals(g){h(g);let{px:v,py:w,pz:b}=this,{px:_,py:R,pz:P}=g,A=t.eql(t.mul(v,P),t.mul(_,b)),k=t.eql(t.mul(w,P),t.mul(R,b));return A&&k}negate(){return new u(this.px,t.neg(this.py),this.pz)}double(){let{a:g,b:v}=e,w=t.mul(v,uc),{px:b,py:_,pz:R}=this,P=t.ZERO,A=t.ZERO,k=t.ZERO,E=t.mul(b,b),$=t.mul(_,_),D=t.mul(R,R),q=t.mul(b,_);return q=t.add(q,q),k=t.mul(b,R),k=t.add(k,k),P=t.mul(g,k),A=t.mul(w,D),A=t.add(P,A),P=t.sub($,A),A=t.add($,A),A=t.mul(P,A),P=t.mul(q,P),k=t.mul(w,k),D=t.mul(g,D),q=t.sub(E,D),q=t.mul(g,q),q=t.add(q,k),k=t.add(E,E),E=t.add(k,E),E=t.add(E,D),E=t.mul(E,q),A=t.add(A,E),D=t.mul(_,R),D=t.add(D,D),E=t.mul(D,q),P=t.sub(P,E),k=t.mul(D,$),k=t.add(k,k),k=t.add(k,k),new u(P,A,k)}add(g){h(g);let{px:v,py:w,pz:b}=this,{px:_,py:R,pz:P}=g,A=t.ZERO,k=t.ZERO,E=t.ZERO,$=e.a,D=t.mul(e.b,uc),q=t.mul(v,_),V=t.mul(w,R),C=t.mul(b,P),T=t.add(v,w),N=t.add(_,R);T=t.mul(T,N),N=t.add(q,V),T=t.sub(T,N),N=t.add(v,b);let U=t.add(_,P);return N=t.mul(N,U),U=t.add(q,C),N=t.sub(N,U),U=t.add(w,b),A=t.add(R,P),U=t.mul(U,A),A=t.add(V,C),U=t.sub(U,A),E=t.mul($,N),A=t.mul(D,C),E=t.add(A,E),A=t.sub(V,E),E=t.add(V,E),k=t.mul(A,E),V=t.add(q,q),V=t.add(V,q),C=t.mul($,C),N=t.mul(D,N),V=t.add(V,C),C=t.sub(q,C),C=t.mul($,C),N=t.add(N,C),q=t.mul(V,N),k=t.add(k,q),q=t.mul(U,N),A=t.mul(T,A),A=t.sub(A,q),q=t.mul(T,V),E=t.mul(U,E),E=t.add(E,q),new u(A,k,E)}subtract(g){return this.add(g.negate())}is0(){return this.equals(u.ZERO)}wNAF(g){return f.wNAFCached(this,g,u.normalizeZ)}multiplyUnsafe(g){let{endo:v,n:w}=e;Rt("scalar",g,Ot,w);let b=u.ZERO;if(g===Ot)return b;if(this.is0()||g===Ie)return this;if(!v||f.hasPrecomputes(this))return f.wNAFCachedUnsafe(this,g,u.normalizeZ);let{k1neg:_,k1:R,k2neg:P,k2:A}=v.splitScalar(g),k=b,E=b,$=this;for(;R>Ot||A>Ot;)R&Ie&&(k=k.add($)),A&Ie&&(E=E.add($)),$=$.double(),R>>=Ie,A>>=Ie;return _&&(k=k.negate()),P&&(E=E.negate()),E=new u(t.mul(E.px,v.beta),E.py,E.pz),k.add(E)}multiply(g){let{endo:v,n:w}=e;Rt("scalar",g,Ie,w);let b,_;if(v){let{k1neg:R,k1:P,k2neg:A,k2:k}=v.splitScalar(g),{p:E,f:$}=this.wNAF(P),{p:D,f:q}=this.wNAF(k);E=f.constTimeNegate(R,E),D=f.constTimeNegate(A,D),D=new u(t.mul(D.px,v.beta),D.py,D.pz),b=E.add(D),_=$.add(q)}else{let{p:R,f:P}=this.wNAF(g);b=R,_=P}return u.normalizeZ([b,_])[0]}multiplyAndAddUnsafe(g,v,w){let b=u.BASE,_=(P,A)=>A===Ot||A===Ie||!P.equals(b)?P.multiplyUnsafe(A):P.multiply(A),R=_(this,v).add(_(g,w));return R.is0()?void 0:R}toAffine(g){return p(this,g)}isTorsionFree(){let{h:g,isTorsionFree:v}=e;if(g===Ie)return!0;if(v)return v(u,this);throw new Error("isTorsionFree() has not been declared for the elliptic curve")}clearCofactor(){let{h:g,clearCofactor:v}=e;return g===Ie?this:v?v(u,this):this.multiplyUnsafe(e.h)}toRawBytes(g=!0){return _s("isCompressed",g),this.assertValidity(),r(u,this,g)}toHex(g=!0){return _s("isCompressed",g),Ps(this.toRawBytes(g))}}u.BASE=new u(e.Gx,e.Gy,t.ONE),u.ZERO=new u(t.ZERO,t.ONE,t.ZERO);let y=e.nBitLength,f=Ou(u,e.endo?Math.ceil(y/2):y);return{CURVE:e,ProjectivePoint:u,normPrivateKeyToScalar:c,weierstrassEquation:o,isWithinCurveOrder:a}}function Vu(s){let e=Qc(s);return Os(e,{hash:"hash",hmac:"function",randomBytes:"function"},{bits2int:"function",bits2int_modN:"function",lowS:"boolean"}),Object.freeze(F({lowS:!0},e))}function Hu(s){let e=Vu(s),{Fp:t,n:i}=e,r=t.BYTES+1,n=2*t.BYTES+1;function o(C){return je(C,i)}function a(C){return gn(C,i)}let{ProjectivePoint:c,normPrivateKeyToScalar:h,weierstrassEquation:p,isWithinCurveOrder:d}=Mu(Ee(F({},e),{toBytes(C,T,N){let U=T.toAffine(),L=t.toBytes(U.x),S=ui;return _s("isCompressed",N),N?S(Uint8Array.from([T.hasEvenY()?2:3]),L):S(Uint8Array.from([4]),L,t.toBytes(U.y))},fromBytes(C){let T=C.length,N=C[0],U=C.subarray(1);if(T===r&&(N===2||N===3)){let L=os(U);if(!gr(L,Ie,t.ORDER))throw new Error("Point is not on curve");let S=p(L),M;try{M=t.sqrt(S)}catch(z){let re=z instanceof Error?": "+z.message:"";throw new Error("Point is not on curve"+re)}let H=(M&Ie)===Ie;return(N&1)===1!==H&&(M=t.neg(M)),{x:L,y:M}}else if(T===n&&N===4){let L=t.fromBytes(U.subarray(0,t.BYTES)),S=t.fromBytes(U.subarray(t.BYTES,2*t.BYTES));return{x:L,y:S}}else{let L=r,S=n;throw new Error("invalid Point, expected length of "+L+", or uncompressed "+S+", got "+T)}}})),u=C=>Ps(As(C,e.nByteLength));function y(C){let T=i>>Ie;return C>T}function f(C){return y(C)?o(-C):C}let m=(C,T,N)=>os(C.slice(T,N));class g{constructor(T,N,U){this.r=T,this.s=N,this.recovery=U,this.assertValidity()}static fromCompact(T){let N=e.nByteLength;return T=ze("compactSignature",T,N*2),new g(m(T,0,N),m(T,N,2*N))}static fromDER(T){let{r:N,s:U}=Tt.toSig(ze("DER",T));return new g(N,U)}assertValidity(){Rt("r",this.r,Ie,i),Rt("s",this.s,Ie,i)}addRecoveryBit(T){return new g(this.r,this.s,T)}recoverPublicKey(T){let{r:N,s:U,recovery:L}=this,S=P(ze("msgHash",T));if(L==null||![0,1,2,3].includes(L))throw new Error("recovery id invalid");let M=L===2||L===3?N+e.n:N;if(M>=t.ORDER)throw new Error("recovery id 2 or 3 invalid");let H=L&1?"03":"02",z=c.fromHex(H+u(M)),re=a(M),te=o(-S*re),ue=o(U*re),be=c.BASE.multiplyAndAddUnsafe(z,te,ue);if(!be)throw new Error("point at infinify");return be.assertValidity(),be}hasHighS(){return y(this.s)}normalizeS(){return this.hasHighS()?new g(this.r,o(-this.s),this.recovery):this}toDERRawBytes(){return Ss(this.toDERHex())}toDERHex(){return Tt.hexFromSig({r:this.r,s:this.s})}toCompactRawBytes(){return Ss(this.toCompactHex())}toCompactHex(){return u(this.r)+u(this.s)}}let v={isValidPrivateKey(C){try{return h(C),!0}catch{return!1}},normPrivateKeyToScalar:h,randomPrivateKey:()=>{let C=Jc(e.n);return Au(e.randomBytes(C),e.n)},precompute(C=8,T=c.BASE){return T._setWindowSize(C),T.multiply(BigInt(3)),T}};function w(C,T=!0){return c.fromPrivateKey(C).toRawBytes(T)}function b(C){let T=cs(C),N=typeof C=="string",U=(T||N)&&C.length;return T?U===r||U===n:N?U===2*r||U===2*n:C instanceof c}function _(C,T,N=!0){if(b(C))throw new Error("first arg must be private key");if(!b(T))throw new Error("second arg must be public key");return c.fromHex(T).multiply(h(C)).toRawBytes(N)}let R=e.bits2int||function(C){if(C.length>8192)throw new Error("input is too large");let T=os(C),N=C.length*8-e.nBitLength;return N>0?T>>BigInt(N):T},P=e.bits2int_modN||function(C){return o(R(C))},A=On(e.nBitLength);function k(C){return Rt("num < 2^"+e.nBitLength,C,Ot,A),As(C,e.nByteLength)}function E(C,T,N=$){if(["recovered","canonical"].some(fe=>fe in N))throw new Error("sign() legacy options not supported");let{hash:U,randomBytes:L}=e,{lowS:S,prehash:M,extraEntropy:H}=N;S==null&&(S=!0),C=ze("msgHash",C),dc(N),M&&(C=ze("prehashed msgHash",U(C)));let z=P(C),re=h(T),te=[k(re),k(z)];if(H!=null&&H!==!1){let fe=H===!0?L(t.BYTES):H;te.push(ze("extraEntropy",fe))}let ue=ui(...te),be=z;function Re(fe){let me=R(fe);if(!d(me))return;let Xt=a(me),_t=c.BASE.multiply(me).toAffine(),pt=o(_t.x);if(pt===Ot)return;let Pt=o(Xt*o(be+pt*re));if(Pt===Ot)return;let ds=(_t.x===pt?0:2)|Number(_t.y&Ie),ki=Pt;return S&&y(Pt)&&(ki=f(Pt),ds^=1),new g(pt,ki,ds)}return{seed:ue,k2sig:Re}}let $={lowS:e.lowS,prehash:!1},D={lowS:e.lowS,prehash:!1};function q(C,T,N=$){let{seed:U,k2sig:L}=E(C,T,N),S=e;return zc(S.hash.outputLen,S.nByteLength,S.hmac)(U,L)}c.BASE._setWindowSize(8);function V(C,T,N,U=D){let L=C;T=ze("msgHash",T),N=ze("publicKey",N);let{lowS:S,prehash:M,format:H}=U;if(dc(U),"strict"in U)throw new Error("options.strict was renamed to lowS");if(H!==void 0&&H!=="compact"&&H!=="der")throw new Error("format must be compact or der");let z=typeof L=="string"||cs(L),re=!z&&!H&&typeof L=="object"&&L!==null&&typeof L.r=="bigint"&&typeof L.s=="bigint";if(!z&&!re)throw new Error("invalid signature, expected Uint8Array, hex string or Signature instance");let te,ue;try{if(re&&(te=new g(L.r,L.s)),z){try{H!=="compact"&&(te=g.fromDER(L))}catch(Pt){if(!(Pt instanceof Tt.Err))throw Pt}!te&&H!=="der"&&(te=g.fromCompact(L))}ue=c.fromHex(N)}catch{return!1}if(!te||S&&te.hasHighS())return!1;M&&(T=e.hash(T));let{r:be,s:Re}=te,fe=P(T),me=a(Re),Xt=o(fe*me),_t=o(be*me),pt=c.BASE.multiplyAndAddUnsafe(ue,Xt,_t)?.toAffine();return pt?o(pt.x)===be:!1}return{CURVE:e,getPublicKey:w,getSharedSecret:_,sign:q,verify:V,ProjectivePoint:c,Signature:g,utils:v}}function zu(s){return{hash:s,hmac:(e,...t)=>lr(s,e,id(...t)),randomBytes:Ts}}function Ku(s,e){let t=i=>Hu(F(F({},s),zu(i)));return Ee(F({},t(e)),{create:t})}var eh=Gc(BigInt("0xffffffff00000001000000000000000000000000ffffffffffffffffffffffff")),Wu=eh.create(BigInt("-3")),Gu=BigInt("0x5ac635d8aa3a93e7b3ebbd55769886bc651d06b0cc53b0f63bce3c3e27d2604b"),Yu=Ku({a:Wu,b:Gu,Fp:eh,n:BigInt("0xffffffff00000000ffffffffffffffffbce6faada7179e84f3b9cac2fc632551"),Gx:BigInt("0x6b17d1f2e12c4247f8bce6e563a440f277037d812deb33a0f4a13945d898c296"),Gy:BigInt("0x4fe342e2fe1a7f9b8ee7eb4a7c0f9e162bce33576b315ececbb6406837bf51f5"),h:BigInt(1),lowS:!1},Ei),th="base10",ke="base16",We="base64pad",qt="base64url",Ci="utf8",sh=0,at=1,Rs=2,Ju=0,gc=1,ci=12,Rn=32;function ih(){let s=mn.utils.randomPrivateKey(),e=mn.getPublicKey(s);return{privateKey:xe(s,ke),publicKey:xe(e,ke)}}function fr(){let s=Ts(Rn);return xe(s,ke)}function rh(s,e){let t=mn.getSharedSecret(Me(s,ke),Me(e,ke)),i=nu(Ei,t,void 0,void 0,Rn);return xe(i,ke)}function xs(s){let e=Ei(Me(s,ke));return xe(e,ke)}function Qe(s){let e=Ei(Me(s,Ci));return xe(e,ke)}function nh(s){return Me(`${s}`,th)}function zt(s){return Number(xe(s,th))}function oh(s){return s.replace(/\+/g,"-").replace(/\//g,"_").replace(/=/g,"")}function ah(s){let e=s.replace(/-/g,"+").replace(/_/g,"/"),t=(4-e.length%4)%4;return e+"=".repeat(t)}function ch(s){let e=nh(typeof s.type<"u"?s.type:sh);if(zt(e)===at&&typeof s.senderPublicKey>"u")throw new Error("Missing sender public key for type 1 envelope");let t=typeof s.senderPublicKey<"u"?Me(s.senderPublicKey,ke):void 0,i=typeof s.iv<"u"?Me(s.iv,ke):Ts(ci),r=Me(s.symKey,ke),n=Vc(r,i).encrypt(Me(s.message,Ci)),o=dh({type:e,sealed:n,iv:i,senderPublicKey:t});return s.encoding===qt?oh(o):o}function hh(s){let e=Me(s.symKey,ke),{sealed:t,iv:i}=ks({encoded:s.encoded,encoding:s.encoding}),r=Vc(e,i).decrypt(t);if(r===null)throw new Error("Failed to decrypt");return xe(r,Ci)}function lh(s,e){let t=nh(Rs),i=Ts(ci),r=Me(s,Ci),n=dh({type:t,sealed:r,iv:i});return e===qt?oh(n):n}function ph(s,e){let{sealed:t}=ks({encoded:s,encoding:e});return xe(t,Ci)}function dh(s){if(zt(s.type)===Rs)return xe(us([s.type,s.sealed]),We);if(zt(s.type)===at){if(typeof s.senderPublicKey>"u")throw new Error("Missing sender public key for type 1 envelope");return xe(us([s.type,s.senderPublicKey,s.iv,s.sealed]),We)}return xe(us([s.type,s.iv,s.sealed]),We)}function ks(s){let e=(s.encoding||We)===qt?ah(s.encoded):s.encoded,t=Me(e,We),i=t.slice(Ju,gc),r=gc;if(zt(i)===at){let c=r+Rn,h=c+ci,p=t.slice(r,c),d=t.slice(c,h),u=t.slice(h);return{type:i,sealed:u,iv:d,senderPublicKey:p}}if(zt(i)===Rs){let c=t.slice(r),h=Ts(ci);return{type:i,sealed:c,iv:h}}let n=r+ci,o=t.slice(r,n),a=t.slice(n);return{type:i,sealed:a,iv:o}}function uh(s,e){let t=ks({encoded:s,encoding:e?.encoding});return xn({type:zt(t.type),senderPublicKey:typeof t.senderPublicKey<"u"?xe(t.senderPublicKey,ke):void 0,receiverPublicKey:e?.receiverPublicKey})}function xn(s){let e=s?.type||sh;if(e===at){if(typeof s?.senderPublicKey>"u")throw new Error("missing sender public key");if(typeof s?.receiverPublicKey>"u")throw new Error("missing receiver public key")}return{type:e,senderPublicKey:s?.senderPublicKey,receiverPublicKey:s?.receiverPublicKey}}function kn(s){return s.type===at&&typeof s.senderPublicKey=="string"&&typeof s.receiverPublicKey=="string"}function Un(s){return s.type===Rs}function Xu(s){let e=Buffer.from(s.x,"base64"),t=Buffer.from(s.y,"base64");return us([new Uint8Array([4]),e,t])}function gh(s,e){let[t,i,r]=s.split("."),n=Buffer.from(ah(r),"base64");if(n.length!==64)throw new Error("Invalid signature length");let o=n.slice(0,32),a=n.slice(32,64),c=`${t}.${i}`,h=Ei(c),p=Xu(e);if(!Yu.verify(us([o,a]),h,p))throw new Error("Invalid signature");return ti(s).payload}var Zu="irn";function _i(s){return s?.relay||{protocol:Zu}}function Us(s){let e=la[s];if(typeof e>"u")throw new Error(`Relay Protocol not supported: ${s}`);return e}function Qu(s,e="-"){let t={},i="relay"+e;return Object.keys(s).forEach(r=>{if(r.startsWith(i)){let n=r.replace(i,""),o=s[r];t[n]=o}}),t}function Dn(s){if(!s.includes("wc:")){let h=Nc(s);h!=null&&h.includes("wc:")&&(s=h)}s=s.includes("wc://")?s.replace("wc://",""):s,s=s.includes("wc:")?s.replace("wc:",""):s;let e=s.indexOf(":"),t=s.indexOf("?")!==-1?s.indexOf("?"):void 0,i=s.substring(0,e),r=s.substring(e+1,t).split("@"),n=typeof t<"u"?s.substring(t):"",o=new URLSearchParams(n),a={};o.forEach((h,p)=>{a[p]=h});let c=typeof a.methods=="string"?a.methods.split(","):void 0;return{protocol:i,topic:eg(r[0]),version:parseInt(r[1],10),symKey:a.symKey,relay:Qu(a),methods:c,expiryTimestamp:a.expiryTimestamp?parseInt(a.expiryTimestamp,10):void 0}}function eg(s){return s.startsWith("//")?s.substring(2):s}function tg(s,e="-"){let t="relay",i={};return Object.keys(s).forEach(r=>{let n=r,o=t+e+n;s[n]&&(i[o]=s[n])}),i}function Ln(s){let e=new URLSearchParams,t=tg(s.relay);Object.keys(t).sort().forEach(r=>{e.set(r,t[r])}),e.set("symKey",s.symKey),s.expiryTimestamp&&e.set("expiryTimestamp",s.expiryTimestamp.toString()),s.methods&&e.set("methods",s.methods.join(","));let i=e.toString();return`${s.protocol}:${s.topic}@${s.version}?${i}`}function Pi(s,e,t){return`${s}?wc_ev=${t}&topic=${e}`}function Ds(s){let e=[];return s.forEach(t=>{let[i,r]=t.split(":");e.push(`${i}:${r}`)}),e}function sg(s){let e=[];return Object.values(s).forEach(t=>{e.push(...Ds(t.accounts))}),e}function ig(s,e){let t=[];return Object.values(s).forEach(i=>{Ds(i.accounts).includes(e)&&t.push(...i.methods)}),t}function rg(s,e){let t=[];return Object.values(s).forEach(i=>{Ds(i.accounts).includes(e)&&t.push(...i.events)}),t}function mr(s){return s.includes(":")}function Ls(s){return mr(s)?s.split(":")[0]:s}function ng(s){let e={};return s?.forEach(t=>{var i;let[r,n]=t.split(":");e[r]||(e[r]={accounts:[],chains:[],events:[],methods:[]}),e[r].accounts.push(t),(i=e[r].chains)==null||i.push(`${r}:${n}`)}),e}function qn(s,e){e=e.map(i=>i.replace("did:pkh:",""));let t=ng(e);for(let[i,r]of Object.entries(t))r.methods?r.methods=mi(r.methods,s):r.methods=s,r.events=["chainChanged","accountsChanged"];return t}var og={INVALID_METHOD:{message:"Invalid method.",code:1001},INVALID_EVENT:{message:"Invalid event.",code:1002},INVALID_UPDATE_REQUEST:{message:"Invalid update request.",code:1003},INVALID_EXTEND_REQUEST:{message:"Invalid extend request.",code:1004},INVALID_SESSION_SETTLE_REQUEST:{message:"Invalid session settle request.",code:1005},UNAUTHORIZED_METHOD:{message:"Unauthorized method.",code:3001},UNAUTHORIZED_EVENT:{message:"Unauthorized event.",code:3002},UNAUTHORIZED_UPDATE_REQUEST:{message:"Unauthorized update request.",code:3003},UNAUTHORIZED_EXTEND_REQUEST:{message:"Unauthorized extend request.",code:3004},USER_REJECTED:{message:"User rejected.",code:5e3},USER_REJECTED_CHAINS:{message:"User rejected chains.",code:5001},USER_REJECTED_METHODS:{message:"User rejected methods.",code:5002},USER_REJECTED_EVENTS:{message:"User rejected events.",code:5003},UNSUPPORTED_CHAINS:{message:"Unsupported chains.",code:5100},UNSUPPORTED_METHODS:{message:"Unsupported methods.",code:5101},UNSUPPORTED_EVENTS:{message:"Unsupported events.",code:5102},UNSUPPORTED_ACCOUNTS:{message:"Unsupported accounts.",code:5103},UNSUPPORTED_NAMESPACE_KEY:{message:"Unsupported namespace key.",code:5104},USER_DISCONNECTED:{message:"User disconnected.",code:6e3},SESSION_SETTLEMENT_FAILED:{message:"Session settlement failed.",code:7e3},WC_METHOD_UNSUPPORTED:{message:"Unsupported wc_ method.",code:10001}},ag={NOT_INITIALIZED:{message:"Not initialized.",code:1},NO_MATCHING_KEY:{message:"No matching key.",code:2},RESTORE_WILL_OVERRIDE:{message:"Restore will override.",code:3},RESUBSCRIBED:{message:"Resubscribed.",code:4},MISSING_OR_INVALID:{message:"Missing or invalid.",code:5},EXPIRED:{message:"Expired.",code:6},UNKNOWN_TYPE:{message:"Unknown type.",code:7},MISMATCHED_TOPIC:{message:"Mismatched topic.",code:8},NON_CONFORMING_NAMESPACES:{message:"Non conforming namespaces.",code:9}};function x(s,e){let{message:t,code:i}=ag[s];return{message:e?`${t} ${e}`:t,code:i}}function ee(s,e){let{message:t,code:i}=og[s];return{message:e?`${t} ${e}`:t,code:i}}function wt(s,e){return Array.isArray(s)?typeof e<"u"&&s.length?s.every(e):!0:!1}function hs(s){return Object.getPrototypeOf(s)===Object.prototype&&Object.keys(s).length}function we(s){return typeof s>"u"}function le(s,e){return e&&we(s)?!0:typeof s=="string"&&!!s.trim().length}function Fn(s,e){return e&&we(s)?!0:typeof s=="number"&&!isNaN(s)}function fh(s,e){let{requiredNamespaces:t}=e,i=Object.keys(s.namespaces),r=Object.keys(t),n=!0;return ns(r,i)?(i.forEach(o=>{let{accounts:a,methods:c,events:h}=s.namespaces[o],p=Ds(a),d=t[o];(!ns(wc(o,d),p)||!ns(d.methods,c)||!ns(d.events,h))&&(n=!1)}),n):!1}function nr(s){return le(s,!1)&&s.includes(":")?s.split(":").length===2:!1}function cg(s){if(le(s,!1)&&s.includes(":")){let e=s.split(":");if(e.length===3){let t=e[0]+":"+e[1];return!!e[2]&&nr(t)}}return!1}function mh(s){function e(t){try{return typeof new URL(t)<"u"}catch{return!1}}try{if(le(s,!1)){if(e(s))return!0;let t=Nc(s);return e(t)}}catch{}return!1}function yh(s){var e;return(e=s?.proposer)==null?void 0:e.publicKey}function wh(s){return s?.topic}function vh(s,e){let t=null;return le(s?.publicKey,!1)||(t=x("MISSING_OR_INVALID",`${e} controller public key should be a string`)),t}function fc(s){let e=!0;return wt(s)?s.length&&(e=s.every(t=>le(t,!1))):e=!1,e}function hg(s,e,t){let i=null;return wt(e)&&e.length?e.forEach(r=>{i||nr(r)||(i=ee("UNSUPPORTED_CHAINS",`${t}, chain ${r} should be a string and conform to "namespace:chainId" format`))}):nr(s)||(i=ee("UNSUPPORTED_CHAINS",`${t}, chains must be defined as "namespace:chainId" e.g. "eip155:1": {...} in the namespace key OR as an array of CAIP-2 chainIds e.g. eip155: { chains: ["eip155:1", "eip155:5"] }`)),i}function lg(s,e,t){let i=null;return Object.entries(s).forEach(([r,n])=>{if(i)return;let o=hg(r,wc(r,n),`${e} ${t}`);o&&(i=o)}),i}function pg(s,e){let t=null;return wt(s)?s.forEach(i=>{t||cg(i)||(t=ee("UNSUPPORTED_ACCOUNTS",`${e}, account ${i} should be a string and conform to "namespace:chainId:address" format`))}):t=ee("UNSUPPORTED_ACCOUNTS",`${e}, accounts should be an array of strings conforming to "namespace:chainId:address" format`),t}function dg(s,e){let t=null;return Object.values(s).forEach(i=>{if(t)return;let r=pg(i?.accounts,`${e} namespace`);r&&(t=r)}),t}function ug(s,e){let t=null;return fc(s?.methods)?fc(s?.events)||(t=ee("UNSUPPORTED_EVENTS",`${e}, events should be an array of strings or empty array for no events`)):t=ee("UNSUPPORTED_METHODS",`${e}, methods should be an array of strings or empty array for no methods`),t}function bh(s,e){let t=null;return Object.values(s).forEach(i=>{if(t)return;let r=ug(i,`${e}, namespace`);r&&(t=r)}),t}function Eh(s,e,t){let i=null;if(s&&hs(s)){let r=bh(s,e);r&&(i=r);let n=lg(s,e,t);n&&(i=n)}else i=x("MISSING_OR_INVALID",`${e}, ${t} should be an object with data`);return i}function yr(s,e){let t=null;if(s&&hs(s)){let i=bh(s,e);i&&(t=i);let r=dg(s,e);r&&(t=r)}else t=x("MISSING_OR_INVALID",`${e}, namespaces should be an object with data`);return t}function jn(s){return le(s.protocol,!0)}function Ih(s,e){let t=!1;return e&&!s?t=!0:s&&wt(s)&&s.length&&s.forEach(i=>{t=jn(i)}),t}function Ch(s){return typeof s=="number"}function Ue(s){return typeof s<"u"&&typeof s!==null}function _h(s){return!(!s||typeof s!="object"||!s.code||!Fn(s.code,!1)||!s.message||!le(s.message,!1))}function Ph(s){return!(we(s)||!le(s.method,!1))}function Sh(s){return!(we(s)||we(s.result)&&we(s.error)||!Fn(s.id,!1)||!le(s.jsonrpc,!1))}function Ah(s){return!(we(s)||!le(s.name,!1))}function $n(s,e){return!(!nr(e)||!sg(s).includes(e))}function Nh(s,e,t){return le(t,!1)?ig(s,e).includes(t):!1}function Th(s,e,t){return le(t,!1)?rg(s,e).includes(t):!1}function Bn(s,e,t){let i=null,r=gg(s),n=fg(e),o=Object.keys(r),a=Object.keys(n),c=mc(Object.keys(s)),h=mc(Object.keys(e)),p=c.filter(d=>!h.includes(d));return p.length&&(i=x("NON_CONFORMING_NAMESPACES",`${t} namespaces keys don't satisfy requiredNamespaces.
      Required: ${p.toString()}
      Received: ${Object.keys(e).toString()}`)),ns(o,a)||(i=x("NON_CONFORMING_NAMESPACES",`${t} namespaces chains don't satisfy required namespaces.
      Required: ${o.toString()}
      Approved: ${a.toString()}`)),Object.keys(e).forEach(d=>{if(!d.includes(":")||i)return;let u=Ds(e[d].accounts);u.includes(d)||(i=x("NON_CONFORMING_NAMESPACES",`${t} namespaces accounts don't satisfy namespace accounts for ${d}
        Required: ${d}
        Approved: ${u.toString()}`))}),o.forEach(d=>{i||(ns(r[d].methods,n[d].methods)?ns(r[d].events,n[d].events)||(i=x("NON_CONFORMING_NAMESPACES",`${t} namespaces events don't satisfy namespace events for ${d}`)):i=x("NON_CONFORMING_NAMESPACES",`${t} namespaces methods don't satisfy namespace methods for ${d}`))}),i}function gg(s){let e={};return Object.keys(s).forEach(t=>{var i;t.includes(":")?e[t]=s[t]:(i=s[t].chains)==null||i.forEach(r=>{e[r]={methods:s[t].methods,events:s[t].events}})}),e}function mc(s){return[...new Set(s.map(e=>e.includes(":")?e.split(":")[0]:e))]}function fg(s){let e={};return Object.keys(s).forEach(t=>{t.includes(":")?e[t]=s[t]:Ds(s[t].accounts)?.forEach(r=>{e[r]={accounts:s[t].accounts.filter(n=>n.includes(`${r}:`)),methods:s[t].methods,events:s[t].events}})}),e}function Oh(s,e){return Fn(s,!1)&&s<=e.max&&s>=e.min}function Mn(){let s=fi();return new Promise(e=>{switch(s){case $e.browser:e(mg());break;case $e.reactNative:e(yg());break;case $e.node:e(wg());break;default:e(!0)}})}function mg(){return Ns()&&navigator?.onLine}function yg(){return l(this,null,function*(){return Ut()&&typeof global<"u"&&global!=null&&global.NetInfo?(yield global==null?void 0:global.NetInfo.fetch())?.isConnected:!0})}function wg(){return!0}function Rh(s){switch(fi()){case $e.browser:vg(s);break;case $e.reactNative:bg(s);break;case $e.node:break}}function vg(s){!Ut()&&Ns()&&(window.addEventListener("online",()=>s(!0)),window.addEventListener("offline",()=>s(!1)))}function bg(s){Ut()&&typeof global<"u"&&global!=null&&global.NetInfo&&global?.NetInfo.addEventListener(e=>s(e?.isConnected))}var rn={},Kt=class{static get(e){return rn[e]}static set(e,t){rn[e]=t}static delete(e){delete rn[e]}};var sl=dt(Zi());var il="wc",rl=2,br="core",Et=`${il}@2:${br}:`,Eg={name:br,logger:"error"},Ig={database:":memory:"},Cg="crypto",xh="client_ed25519_seed",_g=j.ONE_DAY,Pg="keychain",Sg="0.3",Ag="messages",Ng="0.3",kh=j.SIX_HOURS,Tg="publisher",_o="irn",Og="error",nl="wss://relay.walletconnect.org",Rg="relayer",ve={message:"relayer_message",message_ack:"relayer_message_ack",connect:"relayer_connect",disconnect:"relayer_disconnect",error:"relayer_error",connection_stalled:"relayer_connection_stalled",transport_closed:"relayer_transport_closed",publish:"relayer_publish"},xg="_subscription",et={payload:"payload",connect:"connect",disconnect:"disconnect",error:"error"},kg=.1;var Wn="2.19.2";var ae={link_mode:"link_mode",relay:"relay"},vr={inbound:"inbound",outbound:"outbound"},Ug="0.3",Dg="WALLETCONNECT_CLIENT_ID",Uh="WALLETCONNECT_LINK_MODE_APPS",Ye={created:"subscription_created",deleted:"subscription_deleted",expired:"subscription_expired",disabled:"subscription_disabled",sync:"subscription_sync",resubscribed:"subscription_resubscribed"};var Lg="subscription",qg="0.3",cb=j.FIVE_SECONDS*1e3,Fg="pairing",jg="0.3";var Si={wc_pairingDelete:{req:{ttl:j.ONE_DAY,prompt:!1,tag:1e3},res:{ttl:j.ONE_DAY,prompt:!1,tag:1001}},wc_pairingPing:{req:{ttl:j.THIRTY_SECONDS,prompt:!1,tag:1002},res:{ttl:j.THIRTY_SECONDS,prompt:!1,tag:1003}},unregistered_method:{req:{ttl:j.ONE_DAY,prompt:!1,tag:0},res:{ttl:j.ONE_DAY,prompt:!1,tag:0}}},Gt={create:"pairing_create",expire:"pairing_expire",delete:"pairing_delete",ping:"pairing_ping"},ct={created:"history_created",updated:"history_updated",deleted:"history_deleted",sync:"history_sync"},$g="history",Bg="0.3",Mg="expirer",Je={created:"expirer_created",deleted:"expirer_deleted",expired:"expirer_expired",sync:"expirer_sync"},Vg="0.3";var Hg="verify-api",zg="https://verify.walletconnect.com",ol="https://verify.walletconnect.org",Fs=ol,Kg=`${Fs}/v3`,Wg=[zg,ol],Gg="echo",Yg="https://echo.walletconnect.com";var lt={pairing_started:"pairing_started",pairing_uri_validation_success:"pairing_uri_validation_success",pairing_uri_not_expired:"pairing_uri_not_expired",store_new_pairing:"store_new_pairing",subscribing_pairing_topic:"subscribing_pairing_topic",subscribe_pairing_topic_success:"subscribe_pairing_topic_success",existing_pairing:"existing_pairing",pairing_not_expired:"pairing_not_expired",emit_inactive_pairing:"emit_inactive_pairing",emit_session_proposal:"emit_session_proposal",subscribing_to_pairing_topic:"subscribing_to_pairing_topic"},bt={no_wss_connection:"no_wss_connection",no_internet_connection:"no_internet_connection",malformed_pairing_uri:"malformed_pairing_uri",active_pairing_already_exists:"active_pairing_already_exists",subscribe_pairing_topic_failure:"subscribe_pairing_topic_failure",pairing_expired:"pairing_expired",proposal_expired:"proposal_expired",proposal_listener_not_found:"proposal_listener_not_found"},tt={session_approve_started:"session_approve_started",proposal_not_expired:"proposal_not_expired",session_namespaces_validation_success:"session_namespaces_validation_success",create_session_topic:"create_session_topic",subscribing_session_topic:"subscribing_session_topic",subscribe_session_topic_success:"subscribe_session_topic_success",publishing_session_approve:"publishing_session_approve",session_approve_publish_success:"session_approve_publish_success",store_session:"store_session",publishing_session_settle:"publishing_session_settle",session_settle_publish_success:"session_settle_publish_success"},Yt={no_internet_connection:"no_internet_connection",no_wss_connection:"no_wss_connection",proposal_expired:"proposal_expired",subscribe_session_topic_failure:"subscribe_session_topic_failure",session_approve_publish_failure:"session_approve_publish_failure",session_settle_publish_failure:"session_settle_publish_failure",session_approve_namespace_validation_failure:"session_approve_namespace_validation_failure",proposal_not_found:"proposal_not_found"},Jt={authenticated_session_approve_started:"authenticated_session_approve_started",authenticated_session_not_expired:"authenticated_session_not_expired",chains_caip2_compliant:"chains_caip2_compliant",chains_evm_compliant:"chains_evm_compliant",create_authenticated_session_topic:"create_authenticated_session_topic",cacaos_verified:"cacaos_verified",store_authenticated_session:"store_authenticated_session",subscribing_authenticated_session_topic:"subscribing_authenticated_session_topic",subscribe_authenticated_session_topic_success:"subscribe_authenticated_session_topic_success",publishing_authenticated_session_approve:"publishing_authenticated_session_approve",authenticated_session_approve_publish_success:"authenticated_session_approve_publish_success"},js={no_internet_connection:"no_internet_connection",no_wss_connection:"no_wss_connection",missing_session_authenticate_request:"missing_session_authenticate_request",session_authenticate_request_expired:"session_authenticate_request_expired",chains_caip2_compliant_failure:"chains_caip2_compliant_failure",chains_evm_compliant_failure:"chains_evm_compliant_failure",invalid_cacao:"invalid_cacao",subscribe_authenticated_session_topic_failure:"subscribe_authenticated_session_topic_failure",authenticated_session_approve_publish_failure:"authenticated_session_approve_publish_failure",authenticated_session_pending_request_not_found:"authenticated_session_pending_request_not_found"},Jg=.1,Xg="event-client",Zg=86400,Qg="https://pulse.walletconnect.org/batch";function ef(s,e){if(s.length>=255)throw new TypeError("Alphabet too long");for(var t=new Uint8Array(256),i=0;i<t.length;i++)t[i]=255;for(var r=0;r<s.length;r++){var n=s.charAt(r),o=n.charCodeAt(0);if(t[o]!==255)throw new TypeError(n+" is ambiguous");t[o]=r}var a=s.length,c=s.charAt(0),h=Math.log(a)/Math.log(256),p=Math.log(256)/Math.log(a);function d(f){if(f instanceof Uint8Array||(ArrayBuffer.isView(f)?f=new Uint8Array(f.buffer,f.byteOffset,f.byteLength):Array.isArray(f)&&(f=Uint8Array.from(f))),!(f instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(f.length===0)return"";for(var m=0,g=0,v=0,w=f.length;v!==w&&f[v]===0;)v++,m++;for(var b=(w-v)*p+1>>>0,_=new Uint8Array(b);v!==w;){for(var R=f[v],P=0,A=b-1;(R!==0||P<g)&&A!==-1;A--,P++)R+=256*_[A]>>>0,_[A]=R%a>>>0,R=R/a>>>0;if(R!==0)throw new Error("Non-zero carry");g=P,v++}for(var k=b-g;k!==b&&_[k]===0;)k++;for(var E=c.repeat(m);k<b;++k)E+=s.charAt(_[k]);return E}function u(f){if(typeof f!="string")throw new TypeError("Expected String");if(f.length===0)return new Uint8Array;var m=0;if(f[m]!==" "){for(var g=0,v=0;f[m]===c;)g++,m++;for(var w=(f.length-m)*h+1>>>0,b=new Uint8Array(w);f[m];){var _=t[f.charCodeAt(m)];if(_===255)return;for(var R=0,P=w-1;(_!==0||R<v)&&P!==-1;P--,R++)_+=a*b[P]>>>0,b[P]=_%256>>>0,_=_/256>>>0;if(_!==0)throw new Error("Non-zero carry");v=R,m++}if(f[m]!==" "){for(var A=w-v;A!==w&&b[A]===0;)A++;for(var k=new Uint8Array(g+(w-A)),E=g;A!==w;)k[E++]=b[A++];return k}}}function y(f){var m=u(f);if(m)return m;throw new Error(`Non-${e} character`)}return{encode:d,decodeUnsafe:u,decode:y}}var tf=ef,sf=tf,al=s=>{if(s instanceof Uint8Array&&s.constructor.name==="Uint8Array")return s;if(s instanceof ArrayBuffer)return new Uint8Array(s);if(ArrayBuffer.isView(s))return new Uint8Array(s.buffer,s.byteOffset,s.byteLength);throw new Error("Unknown type, must be binary type")},rf=s=>new TextEncoder().encode(s),nf=s=>new TextDecoder().decode(s),Gn=class{constructor(e,t,i){this.name=e,this.prefix=t,this.baseEncode=i}encode(e){if(e instanceof Uint8Array)return`${this.prefix}${this.baseEncode(e)}`;throw Error("Unknown type, must be binary type")}},Yn=class{constructor(e,t,i){if(this.name=e,this.prefix=t,t.codePointAt(0)===void 0)throw new Error("Invalid prefix character");this.prefixCodePoint=t.codePointAt(0),this.baseDecode=i}decode(e){if(typeof e=="string"){if(e.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(e)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(e.slice(this.prefix.length))}else throw Error("Can only multibase decode strings")}or(e){return cl(this,e)}},Jn=class{constructor(e){this.decoders=e}or(e){return cl(this,e)}decode(e){let t=e[0],i=this.decoders[t];if(i)return i.decode(e);throw RangeError(`Unable to decode multibase string ${JSON.stringify(e)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}},cl=(s,e)=>new Jn(F(F({},s.decoders||{[s.prefix]:s}),e.decoders||{[e.prefix]:e})),Xn=class{constructor(e,t,i,r){this.name=e,this.prefix=t,this.baseEncode=i,this.baseDecode=r,this.encoder=new Gn(e,t,i),this.decoder=new Yn(e,t,r)}encode(e){return this.encoder.encode(e)}decode(e){return this.decoder.decode(e)}},Er=({name:s,prefix:e,encode:t,decode:i})=>new Xn(s,e,t,i),Ri=({prefix:s,name:e,alphabet:t})=>{let{encode:i,decode:r}=sf(t,e);return Er({prefix:s,name:e,encode:i,decode:n=>al(r(n))})},of=(s,e,t,i)=>{let r={};for(let p=0;p<e.length;++p)r[e[p]]=p;let n=s.length;for(;s[n-1]==="=";)--n;let o=new Uint8Array(n*t/8|0),a=0,c=0,h=0;for(let p=0;p<n;++p){let d=r[s[p]];if(d===void 0)throw new SyntaxError(`Non-${i} character`);c=c<<t|d,a+=t,a>=8&&(a-=8,o[h++]=255&c>>a)}if(a>=t||255&c<<8-a)throw new SyntaxError("Unexpected end of data");return o},af=(s,e,t)=>{let i=e[e.length-1]==="=",r=(1<<t)-1,n="",o=0,a=0;for(let c=0;c<s.length;++c)for(a=a<<8|s[c],o+=8;o>t;)o-=t,n+=e[r&a>>o];if(o&&(n+=e[r&a<<t-o]),i)for(;n.length*t&7;)n+="=";return n},Oe=({name:s,prefix:e,bitsPerChar:t,alphabet:i})=>Er({prefix:e,name:s,encode(r){return af(r,i,t)},decode(r){return of(r,i,t,s)}}),cf=Er({prefix:"\0",name:"identity",encode:s=>nf(s),decode:s=>rf(s)}),hf=Object.freeze({__proto__:null,identity:cf}),lf=Oe({prefix:"0",name:"base2",alphabet:"01",bitsPerChar:1}),pf=Object.freeze({__proto__:null,base2:lf}),df=Oe({prefix:"7",name:"base8",alphabet:"01234567",bitsPerChar:3}),uf=Object.freeze({__proto__:null,base8:df}),gf=Ri({prefix:"9",name:"base10",alphabet:"0123456789"}),ff=Object.freeze({__proto__:null,base10:gf}),mf=Oe({prefix:"f",name:"base16",alphabet:"0123456789abcdef",bitsPerChar:4}),yf=Oe({prefix:"F",name:"base16upper",alphabet:"0123456789ABCDEF",bitsPerChar:4}),wf=Object.freeze({__proto__:null,base16:mf,base16upper:yf}),vf=Oe({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5}),bf=Oe({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5}),Ef=Oe({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5}),If=Oe({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5}),Cf=Oe({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5}),_f=Oe({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5}),Pf=Oe({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5}),Sf=Oe({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5}),Af=Oe({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5}),Nf=Object.freeze({__proto__:null,base32:vf,base32upper:bf,base32pad:Ef,base32padupper:If,base32hex:Cf,base32hexupper:_f,base32hexpad:Pf,base32hexpadupper:Sf,base32z:Af}),Tf=Ri({prefix:"k",name:"base36",alphabet:"0123456789abcdefghijklmnopqrstuvwxyz"}),Of=Ri({prefix:"K",name:"base36upper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"}),Rf=Object.freeze({__proto__:null,base36:Tf,base36upper:Of}),xf=Ri({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"}),kf=Ri({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"}),Uf=Object.freeze({__proto__:null,base58btc:xf,base58flickr:kf}),Df=Oe({prefix:"m",name:"base64",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bitsPerChar:6}),Lf=Oe({prefix:"M",name:"base64pad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",bitsPerChar:6}),qf=Oe({prefix:"u",name:"base64url",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bitsPerChar:6}),Ff=Oe({prefix:"U",name:"base64urlpad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=",bitsPerChar:6}),jf=Object.freeze({__proto__:null,base64:Df,base64pad:Lf,base64url:qf,base64urlpad:Ff}),hl=Array.from("\u{1F680}\u{1FA90}\u2604\u{1F6F0}\u{1F30C}\u{1F311}\u{1F312}\u{1F313}\u{1F314}\u{1F315}\u{1F316}\u{1F317}\u{1F318}\u{1F30D}\u{1F30F}\u{1F30E}\u{1F409}\u2600\u{1F4BB}\u{1F5A5}\u{1F4BE}\u{1F4BF}\u{1F602}\u2764\u{1F60D}\u{1F923}\u{1F60A}\u{1F64F}\u{1F495}\u{1F62D}\u{1F618}\u{1F44D}\u{1F605}\u{1F44F}\u{1F601}\u{1F525}\u{1F970}\u{1F494}\u{1F496}\u{1F499}\u{1F622}\u{1F914}\u{1F606}\u{1F644}\u{1F4AA}\u{1F609}\u263A\u{1F44C}\u{1F917}\u{1F49C}\u{1F614}\u{1F60E}\u{1F607}\u{1F339}\u{1F926}\u{1F389}\u{1F49E}\u270C\u2728\u{1F937}\u{1F631}\u{1F60C}\u{1F338}\u{1F64C}\u{1F60B}\u{1F497}\u{1F49A}\u{1F60F}\u{1F49B}\u{1F642}\u{1F493}\u{1F929}\u{1F604}\u{1F600}\u{1F5A4}\u{1F603}\u{1F4AF}\u{1F648}\u{1F447}\u{1F3B6}\u{1F612}\u{1F92D}\u2763\u{1F61C}\u{1F48B}\u{1F440}\u{1F62A}\u{1F611}\u{1F4A5}\u{1F64B}\u{1F61E}\u{1F629}\u{1F621}\u{1F92A}\u{1F44A}\u{1F973}\u{1F625}\u{1F924}\u{1F449}\u{1F483}\u{1F633}\u270B\u{1F61A}\u{1F61D}\u{1F634}\u{1F31F}\u{1F62C}\u{1F643}\u{1F340}\u{1F337}\u{1F63B}\u{1F613}\u2B50\u2705\u{1F97A}\u{1F308}\u{1F608}\u{1F918}\u{1F4A6}\u2714\u{1F623}\u{1F3C3}\u{1F490}\u2639\u{1F38A}\u{1F498}\u{1F620}\u261D\u{1F615}\u{1F33A}\u{1F382}\u{1F33B}\u{1F610}\u{1F595}\u{1F49D}\u{1F64A}\u{1F639}\u{1F5E3}\u{1F4AB}\u{1F480}\u{1F451}\u{1F3B5}\u{1F91E}\u{1F61B}\u{1F534}\u{1F624}\u{1F33C}\u{1F62B}\u26BD\u{1F919}\u2615\u{1F3C6}\u{1F92B}\u{1F448}\u{1F62E}\u{1F646}\u{1F37B}\u{1F343}\u{1F436}\u{1F481}\u{1F632}\u{1F33F}\u{1F9E1}\u{1F381}\u26A1\u{1F31E}\u{1F388}\u274C\u270A\u{1F44B}\u{1F630}\u{1F928}\u{1F636}\u{1F91D}\u{1F6B6}\u{1F4B0}\u{1F353}\u{1F4A2}\u{1F91F}\u{1F641}\u{1F6A8}\u{1F4A8}\u{1F92C}\u2708\u{1F380}\u{1F37A}\u{1F913}\u{1F619}\u{1F49F}\u{1F331}\u{1F616}\u{1F476}\u{1F974}\u25B6\u27A1\u2753\u{1F48E}\u{1F4B8}\u2B07\u{1F628}\u{1F31A}\u{1F98B}\u{1F637}\u{1F57A}\u26A0\u{1F645}\u{1F61F}\u{1F635}\u{1F44E}\u{1F932}\u{1F920}\u{1F927}\u{1F4CC}\u{1F535}\u{1F485}\u{1F9D0}\u{1F43E}\u{1F352}\u{1F617}\u{1F911}\u{1F30A}\u{1F92F}\u{1F437}\u260E\u{1F4A7}\u{1F62F}\u{1F486}\u{1F446}\u{1F3A4}\u{1F647}\u{1F351}\u2744\u{1F334}\u{1F4A3}\u{1F438}\u{1F48C}\u{1F4CD}\u{1F940}\u{1F922}\u{1F445}\u{1F4A1}\u{1F4A9}\u{1F450}\u{1F4F8}\u{1F47B}\u{1F910}\u{1F92E}\u{1F3BC}\u{1F975}\u{1F6A9}\u{1F34E}\u{1F34A}\u{1F47C}\u{1F48D}\u{1F4E3}\u{1F942}"),$f=hl.reduce((s,e,t)=>(s[t]=e,s),[]),Bf=hl.reduce((s,e,t)=>(s[e.codePointAt(0)]=t,s),[]);function Mf(s){return s.reduce((e,t)=>(e+=$f[t],e),"")}function Vf(s){let e=[];for(let t of s){let i=Bf[t.codePointAt(0)];if(i===void 0)throw new Error(`Non-base256emoji character: ${t}`);e.push(i)}return new Uint8Array(e)}var Hf=Er({prefix:"\u{1F680}",name:"base256emoji",encode:Mf,decode:Vf}),zf=Object.freeze({__proto__:null,base256emoji:Hf}),Kf=ll,Dh=128,Wf=127,Gf=~Wf,Yf=Math.pow(2,31);function ll(s,e,t){e=e||[],t=t||0;for(var i=t;s>=Yf;)e[t++]=s&255|Dh,s/=128;for(;s&Gf;)e[t++]=s&255|Dh,s>>>=7;return e[t]=s|0,ll.bytes=t-i+1,e}var Jf=Zn,Xf=128,Lh=127;function Zn(s,i){var t=0,i=i||0,r=0,n=i,o,a=s.length;do{if(n>=a)throw Zn.bytes=0,new RangeError("Could not decode varint");o=s[n++],t+=r<28?(o&Lh)<<r:(o&Lh)*Math.pow(2,r),r+=7}while(o>=Xf);return Zn.bytes=n-i,t}var Zf=Math.pow(2,7),Qf=Math.pow(2,14),em=Math.pow(2,21),tm=Math.pow(2,28),sm=Math.pow(2,35),im=Math.pow(2,42),rm=Math.pow(2,49),nm=Math.pow(2,56),om=Math.pow(2,63),am=function(s){return s<Zf?1:s<Qf?2:s<em?3:s<tm?4:s<sm?5:s<im?6:s<rm?7:s<nm?8:s<om?9:10},cm={encode:Kf,decode:Jf,encodingLength:am},pl=cm,qh=(s,e,t=0)=>(pl.encode(s,e,t),e),Fh=s=>pl.encodingLength(s),Qn=(s,e)=>{let t=e.byteLength,i=Fh(s),r=i+Fh(t),n=new Uint8Array(r+t);return qh(s,n,0),qh(t,n,i),n.set(e,r),new eo(s,t,e,n)},eo=class{constructor(e,t,i,r){this.code=e,this.size=t,this.digest=i,this.bytes=r}},dl=({name:s,code:e,encode:t})=>new to(s,e,t),to=class{constructor(e,t,i){this.name=e,this.code=t,this.encode=i}digest(e){if(e instanceof Uint8Array){let t=this.encode(e);return t instanceof Uint8Array?Qn(this.code,t):t.then(i=>Qn(this.code,i))}else throw Error("Unknown type, must be binary type")}},ul=s=>e=>l(void 0,null,function*(){return new Uint8Array(yield crypto.subtle.digest(s,e))}),hm=dl({name:"sha2-256",code:18,encode:ul("SHA-256")}),lm=dl({name:"sha2-512",code:19,encode:ul("SHA-512")}),pm=Object.freeze({__proto__:null,sha256:hm,sha512:lm}),gl=0,dm="identity",fl=al,um=s=>Qn(gl,fl(s)),gm={code:gl,name:dm,encode:fl,digest:um},fm=Object.freeze({__proto__:null,identity:gm});new TextEncoder,new TextDecoder;var jh=F(F(F(F(F(F(F(F(F(F({},hf),pf),uf),ff),wf),Nf),Rf),Uf),jf),zf);F(F({},pm),fm);function mm(s=0){return globalThis.Buffer!=null&&globalThis.Buffer.allocUnsafe!=null?globalThis.Buffer.allocUnsafe(s):new Uint8Array(s)}function ml(s,e,t,i){return{name:s,prefix:e,encoder:{name:s,prefix:e,encode:t},decoder:{decode:i}}}var $h=ml("utf8","u",s=>"u"+new TextDecoder("utf8").decode(s),s=>new TextEncoder().encode(s.substring(1))),Vn=ml("ascii","a",s=>{let e="a";for(let t=0;t<s.length;t++)e+=String.fromCharCode(s[t]);return e},s=>{s=s.substring(1);let e=mm(s.length);for(let t=0;t<s.length;t++)e[t]=s.charCodeAt(t);return e}),ym=F({utf8:$h,"utf-8":$h,hex:jh.base16,latin1:Vn,ascii:Vn,binary:Vn},jh);function wm(s,e="utf8"){let t=ym[e];if(!t)throw new Error(`Unsupported encoding "${e}"`);return(e==="utf8"||e==="utf-8")&&globalThis.Buffer!=null&&globalThis.Buffer.from!=null?globalThis.Buffer.from(s,"utf8"):t.decoder.decode(`${t.prefix}${s}`)}var vm=Object.defineProperty,bm=(s,e,t)=>e in s?vm(s,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):s[e]=t,vt=(s,e,t)=>bm(s,typeof e!="symbol"?e+"":e,t),so=class{constructor(e,t){this.core=e,this.logger=t,vt(this,"keychain",new Map),vt(this,"name",Pg),vt(this,"version",Sg),vt(this,"initialized",!1),vt(this,"storagePrefix",Et),vt(this,"init",()=>l(this,null,function*(){if(!this.initialized){let i=yield this.getKeyChain();typeof i<"u"&&(this.keychain=i),this.initialized=!0}})),vt(this,"has",i=>(this.isInitialized(),this.keychain.has(i))),vt(this,"set",(i,r)=>l(this,null,function*(){this.isInitialized(),this.keychain.set(i,r),yield this.persist()})),vt(this,"get",i=>{this.isInitialized();let r=this.keychain.get(i);if(typeof r>"u"){let{message:n}=x("NO_MATCHING_KEY",`${this.name}: ${i}`);throw new Error(n)}return r}),vt(this,"del",i=>l(this,null,function*(){this.isInitialized(),this.keychain.delete(i),yield this.persist()})),this.core=e,this.logger=Se(t,this.name)}get context(){return Le(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}setKeyChain(e){return l(this,null,function*(){yield this.core.storage.setItem(this.storageKey,or(e))})}getKeyChain(){return l(this,null,function*(){let e=yield this.core.storage.getItem(this.storageKey);return typeof e<"u"?ar(e):void 0})}persist(){return l(this,null,function*(){yield this.setKeyChain(this.keychain)})}isInitialized(){if(!this.initialized){let{message:e}=x("NOT_INITIALIZED",this.name);throw new Error(e)}}},Em=Object.defineProperty,Im=(s,e,t)=>e in s?Em(s,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):s[e]=t,Ne=(s,e,t)=>Im(s,typeof e!="symbol"?e+"":e,t),io=class{constructor(e,t,i){this.core=e,this.logger=t,Ne(this,"name",Cg),Ne(this,"keychain"),Ne(this,"randomSessionIdentifier",fr()),Ne(this,"initialized",!1),Ne(this,"init",()=>l(this,null,function*(){this.initialized||(yield this.keychain.init(),this.initialized=!0)})),Ne(this,"hasKeys",r=>(this.isInitialized(),this.keychain.has(r))),Ne(this,"getClientId",()=>l(this,null,function*(){this.isInitialized();let r=yield this.getClientSeed(),n=qr(r);return ca(n.publicKey)})),Ne(this,"generateKeyPair",()=>{this.isInitialized();let r=ih();return this.setPrivateKey(r.publicKey,r.privateKey)}),Ne(this,"signJWT",r=>l(this,null,function*(){this.isInitialized();let n=yield this.getClientSeed(),o=qr(n),a=this.randomSessionIdentifier;return yield ha(a,r,_g,o)})),Ne(this,"generateSharedKey",(r,n,o)=>{this.isInitialized();let a=this.getPrivateKey(r),c=rh(a,n);return this.setSymKey(c,o)}),Ne(this,"setSymKey",(r,n)=>l(this,null,function*(){this.isInitialized();let o=n||xs(r);return yield this.keychain.set(o,r),o})),Ne(this,"deleteKeyPair",r=>l(this,null,function*(){this.isInitialized(),yield this.keychain.del(r)})),Ne(this,"deleteSymKey",r=>l(this,null,function*(){this.isInitialized(),yield this.keychain.del(r)})),Ne(this,"encode",(r,n,o)=>l(this,null,function*(){this.isInitialized();let a=xn(o),c=Oa(n);if(Un(a))return lh(c,o?.encoding);if(kn(a)){let u=a.senderPublicKey,y=a.receiverPublicKey;r=yield this.generateSharedKey(u,y)}let h=this.getSymKey(r),{type:p,senderPublicKey:d}=a;return ch({type:p,symKey:h,message:c,senderPublicKey:d,encoding:o?.encoding})})),Ne(this,"decode",(r,n,o)=>l(this,null,function*(){this.isInitialized();let a=uh(n,o);if(Un(a)){let c=ph(n,o?.encoding);return zr(c)}if(kn(a)){let c=a.receiverPublicKey,h=a.senderPublicKey;r=yield this.generateSharedKey(c,h)}try{let c=this.getSymKey(r),h=hh({symKey:c,encoded:n,encoding:o?.encoding});return zr(h)}catch(c){this.logger.error(`Failed to decode message from topic: '${r}', clientId: '${yield this.getClientId()}'`),this.logger.error(c)}})),Ne(this,"getPayloadType",(r,n=We)=>{let o=ks({encoded:r,encoding:n});return zt(o.type)}),Ne(this,"getPayloadSenderPublicKey",(r,n=We)=>{let o=ks({encoded:r,encoding:n});return o.senderPublicKey?xe(o.senderPublicKey,ke):void 0}),this.core=e,this.logger=Se(t,this.name),this.keychain=i||new so(this.core,this.logger)}get context(){return Le(this.logger)}setPrivateKey(e,t){return l(this,null,function*(){return yield this.keychain.set(e,t),e})}getPrivateKey(e){return this.keychain.get(e)}getClientSeed(){return l(this,null,function*(){let e="";try{e=this.keychain.get(xh)}catch{e=fr(),yield this.keychain.set(xh,e)}return wm(e,"base16")})}getSymKey(e){return this.keychain.get(e)}isInitialized(){if(!this.initialized){let{message:e}=x("NOT_INITIALIZED",this.name);throw new Error(e)}}},Cm=Object.defineProperty,_m=Object.defineProperties,Pm=Object.getOwnPropertyDescriptors,Bh=Object.getOwnPropertySymbols,Sm=Object.prototype.hasOwnProperty,Am=Object.prototype.propertyIsEnumerable,ro=(s,e,t)=>e in s?Cm(s,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):s[e]=t,Nm=(s,e)=>{for(var t in e||(e={}))Sm.call(e,t)&&ro(s,t,e[t]);if(Bh)for(var t of Bh(e))Am.call(e,t)&&ro(s,t,e[t]);return s},Tm=(s,e)=>_m(s,Pm(e)),Ge=(s,e,t)=>ro(s,typeof e!="symbol"?e+"":e,t),no=class extends Bi{constructor(e,t){super(e,t),this.logger=e,this.core=t,Ge(this,"messages",new Map),Ge(this,"messagesWithoutClientAck",new Map),Ge(this,"name",Ag),Ge(this,"version",Ng),Ge(this,"initialized",!1),Ge(this,"storagePrefix",Et),Ge(this,"init",()=>l(this,null,function*(){if(!this.initialized){this.logger.trace("Initialized");try{let i=yield this.getRelayerMessages();typeof i<"u"&&(this.messages=i);let r=yield this.getRelayerMessagesWithoutClientAck();typeof r<"u"&&(this.messagesWithoutClientAck=r),this.logger.debug(`Successfully Restored records for ${this.name}`),this.logger.trace({type:"method",method:"restore",size:this.messages.size})}catch(i){this.logger.debug(`Failed to Restore records for ${this.name}`),this.logger.error(i)}finally{this.initialized=!0}}})),Ge(this,"set",(i,r,n)=>l(this,null,function*(){this.isInitialized();let o=Qe(r),a=this.messages.get(i);if(typeof a>"u"&&(a={}),typeof a[o]<"u")return o;if(a[o]=r,this.messages.set(i,a),n===vr.inbound){let c=this.messagesWithoutClientAck.get(i)||{};this.messagesWithoutClientAck.set(i,Tm(Nm({},c),{[o]:r}))}return yield this.persist(),o})),Ge(this,"get",i=>{this.isInitialized();let r=this.messages.get(i);return typeof r>"u"&&(r={}),r}),Ge(this,"getWithoutAck",i=>{this.isInitialized();let r={};for(let n of i){let o=this.messagesWithoutClientAck.get(n)||{};r[n]=Object.values(o)}return r}),Ge(this,"has",(i,r)=>{this.isInitialized();let n=this.get(i),o=Qe(r);return typeof n[o]<"u"}),Ge(this,"ack",(i,r)=>l(this,null,function*(){this.isInitialized();let n=this.messagesWithoutClientAck.get(i);if(typeof n>"u")return;let o=Qe(r);delete n[o],Object.keys(n).length===0?this.messagesWithoutClientAck.delete(i):this.messagesWithoutClientAck.set(i,n),yield this.persist()})),Ge(this,"del",i=>l(this,null,function*(){this.isInitialized(),this.messages.delete(i),this.messagesWithoutClientAck.delete(i),yield this.persist()})),this.logger=Se(e,this.name),this.core=t}get context(){return Le(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}get storageKeyWithoutClientAck(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name+"_withoutClientAck"}setRelayerMessages(e){return l(this,null,function*(){yield this.core.storage.setItem(this.storageKey,or(e))})}setRelayerMessagesWithoutClientAck(e){return l(this,null,function*(){yield this.core.storage.setItem(this.storageKeyWithoutClientAck,or(e))})}getRelayerMessages(){return l(this,null,function*(){let e=yield this.core.storage.getItem(this.storageKey);return typeof e<"u"?ar(e):void 0})}getRelayerMessagesWithoutClientAck(){return l(this,null,function*(){let e=yield this.core.storage.getItem(this.storageKeyWithoutClientAck);return typeof e<"u"?ar(e):void 0})}persist(){return l(this,null,function*(){yield this.setRelayerMessages(this.messages),yield this.setRelayerMessagesWithoutClientAck(this.messagesWithoutClientAck)})}isInitialized(){if(!this.initialized){let{message:e}=x("NOT_INITIALIZED",this.name);throw new Error(e)}}},Om=Object.defineProperty,Rm=Object.defineProperties,xm=Object.getOwnPropertyDescriptors,Mh=Object.getOwnPropertySymbols,km=Object.prototype.hasOwnProperty,Um=Object.prototype.propertyIsEnumerable,oo=(s,e,t)=>e in s?Om(s,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):s[e]=t,wr=(s,e)=>{for(var t in e||(e={}))km.call(e,t)&&oo(s,t,e[t]);if(Mh)for(var t of Mh(e))Um.call(e,t)&&oo(s,t,e[t]);return s},Hn=(s,e)=>Rm(s,xm(e)),ht=(s,e,t)=>oo(s,typeof e!="symbol"?e+"":e,t),ao=class extends Mi{constructor(e,t){super(e,t),this.relayer=e,this.logger=t,ht(this,"events",new Ft.EventEmitter),ht(this,"name",Tg),ht(this,"queue",new Map),ht(this,"publishTimeout",(0,j.toMiliseconds)(j.ONE_MINUTE)),ht(this,"initialPublishTimeout",(0,j.toMiliseconds)(j.ONE_SECOND*15)),ht(this,"needsTransportRestart",!1),ht(this,"publish",(i,r,n)=>l(this,null,function*(){var o;this.logger.debug("Publishing Payload"),this.logger.trace({type:"method",method:"publish",params:{topic:i,message:r,opts:n}});let a=n?.ttl||kh,c=_i(n),h=n?.prompt||!1,p=n?.tag||0,d=n?.id||$t().toString(),u={topic:i,message:r,opts:{ttl:a,relay:c,prompt:h,tag:p,id:d,attestation:n?.attestation,tvf:n?.tvf}},y=`Failed to publish payload, please try again. id:${d} tag:${p}`;try{let f=new Promise(m=>l(this,null,function*(){let g=({id:w})=>{u.opts.id===w&&(this.removeRequestFromQueue(w),this.relayer.events.removeListener(ve.publish,g),m(u))};this.relayer.events.on(ve.publish,g);let v=Lt(new Promise((w,b)=>{this.rpcPublish({topic:i,message:r,ttl:a,prompt:h,tag:p,id:d,attestation:n?.attestation,tvf:n?.tvf}).then(w).catch(_=>{this.logger.warn(_,_?.message),b(_)})}),this.initialPublishTimeout,`Failed initial publish, retrying.... id:${d} tag:${p}`);try{yield v,this.events.removeListener(ve.publish,g)}catch(w){this.queue.set(d,Hn(wr({},u),{attempt:1})),this.logger.warn(w,w?.message)}}));this.logger.trace({type:"method",method:"publish",params:{id:d,topic:i,message:r,opts:n}}),yield Lt(f,this.publishTimeout,y)}catch(f){if(this.logger.debug("Failed to Publish Payload"),this.logger.error(f),(o=n?.internal)!=null&&o.throwOnFailedPublish)throw f}finally{this.queue.delete(d)}})),ht(this,"on",(i,r)=>{this.events.on(i,r)}),ht(this,"once",(i,r)=>{this.events.once(i,r)}),ht(this,"off",(i,r)=>{this.events.off(i,r)}),ht(this,"removeListener",(i,r)=>{this.events.removeListener(i,r)}),this.relayer=e,this.logger=Se(t,this.name),this.registerEventListeners()}get context(){return Le(this.logger)}rpcPublish(e){return l(this,null,function*(){var t,i,r,n;let{topic:o,message:a,ttl:c=kh,prompt:h,tag:p,id:d,attestation:u,tvf:y}=e,f={method:Us(_i().protocol).publish,params:wr({topic:o,message:a,ttl:c,prompt:h,tag:p,attestation:u},y),id:d};we((t=f.params)==null?void 0:t.prompt)&&((i=f.params)==null||delete i.prompt),we((r=f.params)==null?void 0:r.tag)&&((n=f.params)==null||delete n.tag),this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"message",direction:"outgoing",request:f});let m=yield this.relayer.request(f);return this.relayer.events.emit(ve.publish,e),this.logger.debug("Successfully Published Payload"),m})}removeRequestFromQueue(e){this.queue.delete(e)}checkQueue(){this.queue.forEach((e,t)=>l(this,null,function*(){let i=e.attempt+1;this.queue.set(t,Hn(wr({},e),{attempt:i}));let{topic:r,message:n,opts:o,attestation:a}=e;this.logger.warn({},`Publisher: queue->publishing: ${e.opts.id}, tag: ${e.opts.tag}, attempt: ${i}`),yield this.rpcPublish(Hn(wr({},e),{topic:r,message:n,ttl:o.ttl,prompt:o.prompt,tag:o.tag,id:o.id,attestation:a,tvf:o.tvf})),this.logger.warn({},`Publisher: queue->published: ${e.opts.id}`)}))}registerEventListeners(){this.relayer.core.heartbeat.on(gs.pulse,()=>{if(this.needsTransportRestart){this.needsTransportRestart=!1,this.relayer.events.emit(ve.connection_stalled);return}this.checkQueue()}),this.relayer.on(ve.message_ack,e=>{this.removeRequestFromQueue(e.id.toString())})}},Dm=Object.defineProperty,Lm=(s,e,t)=>e in s?Dm(s,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):s[e]=t,qs=(s,e,t)=>Lm(s,typeof e!="symbol"?e+"":e,t),co=class{constructor(){qs(this,"map",new Map),qs(this,"set",(e,t)=>{let i=this.get(e);this.exists(e,t)||this.map.set(e,[...i,t])}),qs(this,"get",e=>this.map.get(e)||[]),qs(this,"exists",(e,t)=>this.get(e).includes(t)),qs(this,"delete",(e,t)=>{if(typeof t>"u"){this.map.delete(e);return}if(!this.map.has(e))return;let i=this.get(e);if(!this.exists(e,t))return;let r=i.filter(n=>n!==t);if(!r.length){this.map.delete(e);return}this.map.set(e,r)}),qs(this,"clear",()=>{this.map.clear()})}get topics(){return Array.from(this.map.keys())}},qm=Object.defineProperty,Fm=Object.defineProperties,jm=Object.getOwnPropertyDescriptors,Vh=Object.getOwnPropertySymbols,$m=Object.prototype.hasOwnProperty,Bm=Object.prototype.propertyIsEnumerable,ho=(s,e,t)=>e in s?qm(s,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):s[e]=t,Ai=(s,e)=>{for(var t in e||(e={}))$m.call(e,t)&&ho(s,t,e[t]);if(Vh)for(var t of Vh(e))Bm.call(e,t)&&ho(s,t,e[t]);return s},zn=(s,e)=>Fm(s,jm(e)),se=(s,e,t)=>ho(s,typeof e!="symbol"?e+"":e,t),lo=class extends zi{constructor(e,t){super(e,t),this.relayer=e,this.logger=t,se(this,"subscriptions",new Map),se(this,"topicMap",new co),se(this,"events",new Ft.EventEmitter),se(this,"name",Lg),se(this,"version",qg),se(this,"pending",new Map),se(this,"cached",[]),se(this,"initialized",!1),se(this,"storagePrefix",Et),se(this,"subscribeTimeout",(0,j.toMiliseconds)(j.ONE_MINUTE)),se(this,"initialSubscribeTimeout",(0,j.toMiliseconds)(j.ONE_SECOND*15)),se(this,"clientId"),se(this,"batchSubscribeTopicsLimit",500),se(this,"init",()=>l(this,null,function*(){this.initialized||(this.logger.trace("Initialized"),this.registerEventListeners(),yield this.restore()),this.initialized=!0})),se(this,"subscribe",(i,r)=>l(this,null,function*(){this.isInitialized(),this.logger.debug("Subscribing Topic"),this.logger.trace({type:"method",method:"subscribe",params:{topic:i,opts:r}});try{let n=_i(r),o={topic:i,relay:n,transportType:r?.transportType};this.pending.set(i,o);let a=yield this.rpcSubscribe(i,n,r);return typeof a=="string"&&(this.onSubscribe(a,o),this.logger.debug("Successfully Subscribed Topic"),this.logger.trace({type:"method",method:"subscribe",params:{topic:i,opts:r}})),a}catch(n){throw this.logger.debug("Failed to Subscribe Topic"),this.logger.error(n),n}})),se(this,"unsubscribe",(i,r)=>l(this,null,function*(){this.isInitialized(),typeof r?.id<"u"?yield this.unsubscribeById(i,r.id,r):yield this.unsubscribeByTopic(i,r)})),se(this,"isSubscribed",i=>new Promise(r=>{r(this.topicMap.topics.includes(i))})),se(this,"isKnownTopic",i=>new Promise(r=>{r(this.topicMap.topics.includes(i)||this.pending.has(i)||this.cached.some(n=>n.topic===i))})),se(this,"on",(i,r)=>{this.events.on(i,r)}),se(this,"once",(i,r)=>{this.events.once(i,r)}),se(this,"off",(i,r)=>{this.events.off(i,r)}),se(this,"removeListener",(i,r)=>{this.events.removeListener(i,r)}),se(this,"start",()=>l(this,null,function*(){yield this.onConnect()})),se(this,"stop",()=>l(this,null,function*(){yield this.onDisconnect()})),se(this,"restart",()=>l(this,null,function*(){yield this.restore(),yield this.onRestart()})),se(this,"checkPending",()=>l(this,null,function*(){if(this.pending.size===0&&(!this.initialized||!this.relayer.connected))return;let i=[];this.pending.forEach(r=>{i.push(r)}),yield this.batchSubscribe(i)})),se(this,"registerEventListeners",()=>{this.relayer.core.heartbeat.on(gs.pulse,()=>l(this,null,function*(){yield this.checkPending()})),this.events.on(Ye.created,i=>l(this,null,function*(){let r=Ye.created;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,data:i}),yield this.persist()})),this.events.on(Ye.deleted,i=>l(this,null,function*(){let r=Ye.deleted;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,data:i}),yield this.persist()}))}),this.relayer=e,this.logger=Se(t,this.name),this.clientId=""}get context(){return Le(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.relayer.core.customStoragePrefix+"//"+this.name}get length(){return this.subscriptions.size}get ids(){return Array.from(this.subscriptions.keys())}get values(){return Array.from(this.subscriptions.values())}get topics(){return this.topicMap.topics}get hasAnyTopics(){return this.topicMap.topics.length>0||this.pending.size>0||this.cached.length>0||this.subscriptions.size>0}hasSubscription(e,t){let i=!1;try{i=this.getSubscription(e).topic===t}catch{}return i}reset(){this.cached=[],this.initialized=!0}onDisable(){this.cached=this.values,this.subscriptions.clear(),this.topicMap.clear()}unsubscribeByTopic(e,t){return l(this,null,function*(){let i=this.topicMap.get(e);yield Promise.all(i.map(r=>l(this,null,function*(){return yield this.unsubscribeById(e,r,t)})))})}unsubscribeById(e,t,i){return l(this,null,function*(){this.logger.debug("Unsubscribing Topic"),this.logger.trace({type:"method",method:"unsubscribe",params:{topic:e,id:t,opts:i}});try{let r=_i(i);yield this.restartToComplete({topic:e,id:t,relay:r}),yield this.rpcUnsubscribe(e,t,r);let n=ee("USER_DISCONNECTED",`${this.name}, ${e}`);yield this.onUnsubscribe(e,t,n),this.logger.debug("Successfully Unsubscribed Topic"),this.logger.trace({type:"method",method:"unsubscribe",params:{topic:e,id:t,opts:i}})}catch(r){throw this.logger.debug("Failed to Unsubscribe Topic"),this.logger.error(r),r}})}rpcSubscribe(e,t,i){return l(this,null,function*(){var r;(!i||i?.transportType===ae.relay)&&(yield this.restartToComplete({topic:e,id:e,relay:t}));let n={method:Us(t.protocol).subscribe,params:{topic:e}};this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"payload",direction:"outgoing",request:n});let o=(r=i?.internal)==null?void 0:r.throwOnFailedPublish;try{let a=yield this.getSubscriptionId(e);if(i?.transportType===ae.link_mode)return setTimeout(()=>{(this.relayer.connected||this.relayer.connecting)&&this.relayer.request(n).catch(p=>this.logger.warn(p))},(0,j.toMiliseconds)(j.ONE_SECOND)),a;let c=new Promise(p=>l(this,null,function*(){let d=u=>{u.topic===e&&(this.events.removeListener(Ye.created,d),p(u.id))};this.events.on(Ye.created,d);try{let u=yield Lt(new Promise((y,f)=>{this.relayer.request(n).catch(m=>{this.logger.warn(m,m?.message),f(m)}).then(y)}),this.initialSubscribeTimeout,`Subscribing to ${e} failed, please try again`);this.events.removeListener(Ye.created,d),p(u)}catch{}})),h=yield Lt(c,this.subscribeTimeout,`Subscribing to ${e} failed, please try again`);if(!h&&o)throw new Error(`Subscribing to ${e} failed, please try again`);return h?a:null}catch(a){if(this.logger.debug("Outgoing Relay Subscribe Payload stalled"),this.relayer.events.emit(ve.connection_stalled),o)throw a}return null})}rpcBatchSubscribe(e){return l(this,null,function*(){if(!e.length)return;let t=e[0].relay,i={method:Us(t.protocol).batchSubscribe,params:{topics:e.map(r=>r.topic)}};this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"payload",direction:"outgoing",request:i});try{yield yield Lt(new Promise(r=>{this.relayer.request(i).catch(n=>this.logger.warn(n)).then(r)}),this.subscribeTimeout,"rpcBatchSubscribe failed, please try again")}catch{this.relayer.events.emit(ve.connection_stalled)}})}rpcBatchFetchMessages(e){return l(this,null,function*(){if(!e.length)return;let t=e[0].relay,i={method:Us(t.protocol).batchFetchMessages,params:{topics:e.map(n=>n.topic)}};this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"payload",direction:"outgoing",request:i});let r;try{r=yield yield Lt(new Promise((n,o)=>{this.relayer.request(i).catch(a=>{this.logger.warn(a),o(a)}).then(n)}),this.subscribeTimeout,"rpcBatchFetchMessages failed, please try again")}catch{this.relayer.events.emit(ve.connection_stalled)}return r})}rpcUnsubscribe(e,t,i){let r={method:Us(i.protocol).unsubscribe,params:{topic:e,id:t}};return this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"payload",direction:"outgoing",request:r}),this.relayer.request(r)}onSubscribe(e,t){this.setSubscription(e,zn(Ai({},t),{id:e})),this.pending.delete(t.topic)}onBatchSubscribe(e){e.length&&e.forEach(t=>{this.setSubscription(t.id,Ai({},t)),this.pending.delete(t.topic)})}onUnsubscribe(e,t,i){return l(this,null,function*(){this.events.removeAllListeners(t),this.hasSubscription(t,e)&&this.deleteSubscription(t,i),yield this.relayer.messages.del(e)})}setRelayerSubscriptions(e){return l(this,null,function*(){yield this.relayer.core.storage.setItem(this.storageKey,e)})}getRelayerSubscriptions(){return l(this,null,function*(){return yield this.relayer.core.storage.getItem(this.storageKey)})}setSubscription(e,t){this.logger.debug("Setting subscription"),this.logger.trace({type:"method",method:"setSubscription",id:e,subscription:t}),this.addSubscription(e,t)}addSubscription(e,t){this.subscriptions.set(e,Ai({},t)),this.topicMap.set(t.topic,e),this.events.emit(Ye.created,t)}getSubscription(e){this.logger.debug("Getting subscription"),this.logger.trace({type:"method",method:"getSubscription",id:e});let t=this.subscriptions.get(e);if(!t){let{message:i}=x("NO_MATCHING_KEY",`${this.name}: ${e}`);throw new Error(i)}return t}deleteSubscription(e,t){this.logger.debug("Deleting subscription"),this.logger.trace({type:"method",method:"deleteSubscription",id:e,reason:t});let i=this.getSubscription(e);this.subscriptions.delete(e),this.topicMap.delete(i.topic,e),this.events.emit(Ye.deleted,zn(Ai({},i),{reason:t}))}persist(){return l(this,null,function*(){yield this.setRelayerSubscriptions(this.values),this.events.emit(Ye.sync)})}onRestart(){return l(this,null,function*(){if(this.cached.length){let e=[...this.cached],t=Math.ceil(this.cached.length/this.batchSubscribeTopicsLimit);for(let i=0;i<t;i++){let r=e.splice(0,this.batchSubscribeTopicsLimit);yield this.batchSubscribe(r)}}this.events.emit(Ye.resubscribed)})}restore(){return l(this,null,function*(){try{let e=yield this.getRelayerSubscriptions();if(typeof e>"u"||!e.length)return;if(this.subscriptions.size){let{message:t}=x("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(t),this.logger.error(`${this.name}: ${JSON.stringify(this.values)}`),new Error(t)}this.cached=e,this.logger.debug(`Successfully Restored subscriptions for ${this.name}`),this.logger.trace({type:"method",method:"restore",subscriptions:this.values})}catch(e){this.logger.debug(`Failed to Restore subscriptions for ${this.name}`),this.logger.error(e)}})}batchSubscribe(e){return l(this,null,function*(){e.length&&(yield this.rpcBatchSubscribe(e),this.onBatchSubscribe(yield Promise.all(e.map(t=>l(this,null,function*(){return zn(Ai({},t),{id:yield this.getSubscriptionId(t.topic)})})))))})}batchFetchMessages(e){return l(this,null,function*(){if(!e.length)return;this.logger.trace(`Fetching batch messages for ${e.length} subscriptions`);let t=yield this.rpcBatchFetchMessages(e);t&&t.messages&&(yield Tc((0,j.toMiliseconds)(j.ONE_SECOND)),yield this.relayer.handleBatchMessageEvents(t.messages))})}onConnect(){return l(this,null,function*(){yield this.restart(),this.reset()})}onDisconnect(){this.onDisable()}isInitialized(){if(!this.initialized){let{message:e}=x("NOT_INITIALIZED",this.name);throw new Error(e)}}restartToComplete(e){return l(this,null,function*(){!this.relayer.connected&&!this.relayer.connecting&&(this.cached.push(e),yield this.relayer.transportOpen())})}getClientId(){return l(this,null,function*(){return this.clientId||(this.clientId=yield this.relayer.core.crypto.getClientId()),this.clientId})}getSubscriptionId(e){return l(this,null,function*(){return Qe(e+(yield this.getClientId()))})}},Mm=Object.defineProperty,Hh=Object.getOwnPropertySymbols,Vm=Object.prototype.hasOwnProperty,Hm=Object.prototype.propertyIsEnumerable,po=(s,e,t)=>e in s?Mm(s,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):s[e]=t,zh=(s,e)=>{for(var t in e||(e={}))Vm.call(e,t)&&po(s,t,e[t]);if(Hh)for(var t of Hh(e))Hm.call(e,t)&&po(s,t,e[t]);return s},Z=(s,e,t)=>po(s,typeof e!="symbol"?e+"":e,t),uo=class extends Vi{constructor(e){super(e),Z(this,"protocol","wc"),Z(this,"version",2),Z(this,"core"),Z(this,"logger"),Z(this,"events",new Ft.EventEmitter),Z(this,"provider"),Z(this,"messages"),Z(this,"subscriber"),Z(this,"publisher"),Z(this,"name",Rg),Z(this,"transportExplicitlyClosed",!1),Z(this,"initialized",!1),Z(this,"connectionAttemptInProgress",!1),Z(this,"relayUrl"),Z(this,"projectId"),Z(this,"packageName"),Z(this,"bundleId"),Z(this,"hasExperiencedNetworkDisruption",!1),Z(this,"pingTimeout"),Z(this,"heartBeatTimeout",(0,j.toMiliseconds)(j.THIRTY_SECONDS+j.FIVE_SECONDS)),Z(this,"reconnectTimeout"),Z(this,"connectPromise"),Z(this,"reconnectInProgress",!1),Z(this,"requestsInFlight",[]),Z(this,"connectTimeout",(0,j.toMiliseconds)(j.ONE_SECOND*15)),Z(this,"request",t=>l(this,null,function*(){var i,r;this.logger.debug("Publishing Request Payload");let n=t.id||$t().toString();yield this.toEstablishConnection();try{this.logger.trace({id:n,method:t.method,topic:(i=t.params)==null?void 0:i.topic},"relayer.request - publishing...");let o=`${n}:${((r=t.params)==null?void 0:r.tag)||""}`;this.requestsInFlight.push(o);let a=yield this.provider.request(t);return this.requestsInFlight=this.requestsInFlight.filter(c=>c!==o),a}catch(o){throw this.logger.debug(`Failed to Publish Request: ${n}`),o}})),Z(this,"resetPingTimeout",()=>{gi()&&(clearTimeout(this.pingTimeout),this.pingTimeout=setTimeout(()=>{var t,i,r,n;try{this.logger.debug({},"pingTimeout: Connection stalled, terminating..."),(n=(r=(i=(t=this.provider)==null?void 0:t.connection)==null?void 0:i.socket)==null?void 0:r.terminate)==null||n.call(r)}catch(o){this.logger.warn(o,o?.message)}},this.heartBeatTimeout))}),Z(this,"onPayloadHandler",t=>{this.onProviderPayload(t),this.resetPingTimeout()}),Z(this,"onConnectHandler",()=>{this.logger.warn({},"Relayer connected \u{1F6DC}"),this.startPingTimeout(),this.events.emit(ve.connect)}),Z(this,"onDisconnectHandler",()=>{this.logger.warn({},"Relayer disconnected \u{1F6D1}"),this.requestsInFlight=[],this.onProviderDisconnect()}),Z(this,"onProviderErrorHandler",t=>{this.logger.fatal(`Fatal socket error: ${t.message}`),this.events.emit(ve.error,t),this.logger.fatal("Fatal socket error received, closing transport"),this.transportClose()}),Z(this,"registerProviderListeners",()=>{this.provider.on(et.payload,this.onPayloadHandler),this.provider.on(et.connect,this.onConnectHandler),this.provider.on(et.disconnect,this.onDisconnectHandler),this.provider.on(et.error,this.onProviderErrorHandler)}),this.core=e.core,this.logger=typeof e.logger<"u"&&typeof e.logger!="string"?Se(e.logger,this.name):(0,fs.default)(Qt({level:e.logger||Og})),this.messages=new no(this.logger,e.core),this.subscriber=new lo(this,this.logger),this.publisher=new ao(this,this.logger),this.relayUrl=e?.relayUrl||nl,this.projectId=e.projectId,vc()?this.packageName=wn():bc()&&(this.bundleId=wn()),this.provider={}}init(){return l(this,null,function*(){if(this.logger.trace("Initialized"),this.registerEventListeners(),yield Promise.all([this.messages.init(),this.subscriber.init()]),this.initialized=!0,this.subscriber.hasAnyTopics)try{yield this.transportOpen()}catch(e){this.logger.warn(e,e?.message)}})}get context(){return Le(this.logger)}get connected(){var e,t,i;return((i=(t=(e=this.provider)==null?void 0:e.connection)==null?void 0:t.socket)==null?void 0:i.readyState)===1||!1}get connecting(){var e,t,i;return((i=(t=(e=this.provider)==null?void 0:e.connection)==null?void 0:t.socket)==null?void 0:i.readyState)===0||this.connectPromise!==void 0||!1}publish(e,t,i){return l(this,null,function*(){this.isInitialized(),yield this.publisher.publish(e,t,i),yield this.recordMessageEvent({topic:e,message:t,publishedAt:Date.now(),transportType:ae.relay},vr.outbound)})}subscribe(e,t){return l(this,null,function*(){var i,r,n;this.isInitialized(),(!(t!=null&&t.transportType)||t?.transportType==="relay")&&(yield this.toEstablishConnection());let o=typeof((i=t?.internal)==null?void 0:i.throwOnFailedPublish)>"u"?!0:(r=t?.internal)==null?void 0:r.throwOnFailedPublish,a=((n=this.subscriber.topicMap.get(e))==null?void 0:n[0])||"",c,h=p=>{p.topic===e&&(this.subscriber.off(Ye.created,h),c())};return yield Promise.all([new Promise(p=>{c=p,this.subscriber.on(Ye.created,h)}),new Promise((p,d)=>l(this,null,function*(){a=(yield this.subscriber.subscribe(e,zh({internal:{throwOnFailedPublish:o}},t)).catch(u=>{o&&d(u)}))||a,p()}))]),a})}unsubscribe(e,t){return l(this,null,function*(){this.isInitialized(),yield this.subscriber.unsubscribe(e,t)})}on(e,t){this.events.on(e,t)}once(e,t){this.events.once(e,t)}off(e,t){this.events.off(e,t)}removeListener(e,t){this.events.removeListener(e,t)}transportDisconnect(){return l(this,null,function*(){this.provider.disconnect&&(this.hasExperiencedNetworkDisruption||this.connected)?yield Lt(this.provider.disconnect(),2e3,"provider.disconnect()").catch(()=>this.onProviderDisconnect()):this.onProviderDisconnect()})}transportClose(){return l(this,null,function*(){this.transportExplicitlyClosed=!0,yield this.transportDisconnect()})}transportOpen(e){return l(this,null,function*(){if(!this.subscriber.hasAnyTopics){this.logger.warn("Starting WS connection skipped because the client has no topics to work with.");return}if(this.connectPromise?(this.logger.debug({},"Waiting for existing connection attempt to resolve..."),yield this.connectPromise,this.logger.debug({},"Existing connection attempt resolved")):(this.connectPromise=new Promise((t,i)=>l(this,null,function*(){yield this.connect(e).then(t).catch(i).finally(()=>{this.connectPromise=void 0})})),yield this.connectPromise),!this.connected)throw new Error(`Couldn't establish socket connection to the relay server: ${this.relayUrl}`)})}restartTransport(e){return l(this,null,function*(){this.logger.debug({},"Restarting transport..."),!this.connectionAttemptInProgress&&(this.relayUrl=e||this.relayUrl,yield this.confirmOnlineStateOrThrow(),yield this.transportClose(),yield this.transportOpen())})}confirmOnlineStateOrThrow(){return l(this,null,function*(){if(!(yield Mn()))throw new Error("No internet connection detected. Please restart your network and try again.")})}handleBatchMessageEvents(e){return l(this,null,function*(){if(e?.length===0){this.logger.trace("Batch message events is empty. Ignoring...");return}let t=e.sort((i,r)=>i.publishedAt-r.publishedAt);this.logger.debug(`Batch of ${t.length} message events sorted`);for(let i of t)try{yield this.onMessageEvent(i)}catch(r){this.logger.warn(r,"Error while processing batch message event: "+r?.message)}this.logger.trace(`Batch of ${t.length} message events processed`)})}onLinkMessageEvent(e,t){return l(this,null,function*(){let{topic:i}=e;if(!t.sessionExists){let r=de(j.FIVE_MINUTES),n={topic:i,expiry:r,relay:{protocol:"irn"},active:!1};yield this.core.pairing.pairings.set(i,n)}this.events.emit(ve.message,e),yield this.recordMessageEvent(e,vr.inbound)})}connect(e){return l(this,null,function*(){yield this.confirmOnlineStateOrThrow(),e&&e!==this.relayUrl&&(this.relayUrl=e,yield this.transportDisconnect()),this.connectionAttemptInProgress=!0,this.transportExplicitlyClosed=!1;let t=1;for(;t<6;){try{if(this.transportExplicitlyClosed)break;this.logger.debug({},`Connecting to ${this.relayUrl}, attempt: ${t}...`),yield this.createProvider(),yield new Promise((i,r)=>l(this,null,function*(){let n=()=>{r(new Error("Connection interrupted while trying to subscribe"))};this.provider.once(et.disconnect,n),yield Lt(new Promise((o,a)=>{this.provider.connect().then(o).catch(a)}),this.connectTimeout,`Socket stalled when trying to connect to ${this.relayUrl}`).catch(o=>{r(o)}).finally(()=>{this.provider.off(et.disconnect,n),clearTimeout(this.reconnectTimeout)}),yield new Promise((o,a)=>l(this,null,function*(){let c=()=>{a(new Error("Connection interrupted while trying to subscribe"))};this.provider.once(et.disconnect,c),yield this.subscriber.start().then(o).catch(a).finally(()=>{this.provider.off(et.disconnect,c)})})),this.hasExperiencedNetworkDisruption=!1,i()}))}catch(i){yield this.subscriber.stop();let r=i;this.logger.warn({},r.message),this.hasExperiencedNetworkDisruption=!0}finally{this.connectionAttemptInProgress=!1}if(this.connected){this.logger.debug({},`Connected to ${this.relayUrl} successfully on attempt: ${t}`);break}yield new Promise(i=>setTimeout(i,(0,j.toMiliseconds)(t*1))),t++}})}startPingTimeout(){var e,t,i,r,n;if(gi())try{(t=(e=this.provider)==null?void 0:e.connection)!=null&&t.socket&&((n=(r=(i=this.provider)==null?void 0:i.connection)==null?void 0:r.socket)==null||n.on("ping",()=>{this.resetPingTimeout()})),this.resetPingTimeout()}catch(o){this.logger.warn(o,o?.message)}}createProvider(){return l(this,null,function*(){this.provider.connection&&this.unregisterProviderListeners();let e=yield this.core.crypto.signJWT(this.relayUrl);this.provider=new Fe(new ga(Ic({sdkVersion:Wn,protocol:this.protocol,version:this.version,relayUrl:this.relayUrl,projectId:this.projectId,auth:e,useOnCloseEvent:!0,bundleId:this.bundleId,packageName:this.packageName}))),this.registerProviderListeners()})}recordMessageEvent(e,t){return l(this,null,function*(){let{topic:i,message:r}=e;yield this.messages.set(i,r,t)})}shouldIgnoreMessageEvent(e){return l(this,null,function*(){let{topic:t,message:i}=e;if(!i||i.length===0)return this.logger.warn(`Ignoring invalid/empty message: ${i}`),!0;if(!(yield this.subscriber.isKnownTopic(t)))return this.logger.warn(`Ignoring message for unknown topic ${t}`),!0;let r=this.messages.has(t,i);return r&&this.logger.warn(`Ignoring duplicate message: ${i}`),r})}onProviderPayload(e){return l(this,null,function*(){if(this.logger.debug("Incoming Relay Payload"),this.logger.trace({type:"payload",direction:"incoming",payload:e}),si(e)){if(!e.method.endsWith(xg))return;let t=e.params,{topic:i,message:r,publishedAt:n,attestation:o}=t.data,a={topic:i,message:r,publishedAt:n,transportType:ae.relay,attestation:o};this.logger.debug("Emitting Relayer Payload"),this.logger.trace(zh({type:"event",event:t.id},a)),this.events.emit(t.id,a),yield this.acknowledgePayload(e),yield this.onMessageEvent(a)}else ii(e)&&this.events.emit(ve.message_ack,e)})}onMessageEvent(e){return l(this,null,function*(){(yield this.shouldIgnoreMessageEvent(e))||(yield this.recordMessageEvent(e,vr.inbound),this.events.emit(ve.message,e))})}acknowledgePayload(e){return l(this,null,function*(){let t=es(e.id,!0);yield this.provider.connection.send(t)})}unregisterProviderListeners(){this.provider.off(et.payload,this.onPayloadHandler),this.provider.off(et.connect,this.onConnectHandler),this.provider.off(et.disconnect,this.onDisconnectHandler),this.provider.off(et.error,this.onProviderErrorHandler),clearTimeout(this.pingTimeout)}registerEventListeners(){return l(this,null,function*(){let e=yield Mn();Rh(t=>l(this,null,function*(){e!==t&&(e=t,t?yield this.transportOpen().catch(i=>this.logger.error(i,i?.message)):(this.hasExperiencedNetworkDisruption=!0,yield this.transportDisconnect(),this.transportExplicitlyClosed=!1))}))})}onProviderDisconnect(){return l(this,null,function*(){clearTimeout(this.pingTimeout),this.events.emit(ve.disconnect),this.connectionAttemptInProgress=!1,!this.reconnectInProgress&&(this.reconnectInProgress=!0,yield this.subscriber.stop(),this.subscriber.hasAnyTopics&&(this.transportExplicitlyClosed||(this.reconnectTimeout=setTimeout(()=>l(this,null,function*(){yield this.transportOpen().catch(e=>this.logger.error(e,e?.message)),this.reconnectTimeout=void 0,this.reconnectInProgress=!1}),(0,j.toMiliseconds)(kg)))))})}isInitialized(){if(!this.initialized){let{message:e}=x("NOT_INITIALIZED",this.name);throw new Error(e)}}toEstablishConnection(){return l(this,null,function*(){yield this.confirmOnlineStateOrThrow(),!this.connected&&(yield this.connect())})}};function zm(){}function Kh(s){if(!s||typeof s!="object")return!1;let e=Object.getPrototypeOf(s);return e===null||e===Object.prototype||Object.getPrototypeOf(e)===null?Object.prototype.toString.call(s)==="[object Object]":!1}function Wh(s){return Object.getOwnPropertySymbols(s).filter(e=>Object.prototype.propertyIsEnumerable.call(s,e))}function Gh(s){return s==null?s===void 0?"[object Undefined]":"[object Null]":Object.prototype.toString.call(s)}var Km="[object RegExp]",Wm="[object String]",Gm="[object Number]",Ym="[object Boolean]",Yh="[object Arguments]",Jm="[object Symbol]",Xm="[object Date]",Zm="[object Map]",Qm="[object Set]",ey="[object Array]",ty="[object Function]",sy="[object ArrayBuffer]",Kn="[object Object]",iy="[object Error]",ry="[object DataView]",ny="[object Uint8Array]",oy="[object Uint8ClampedArray]",ay="[object Uint16Array]",cy="[object Uint32Array]",hy="[object BigUint64Array]",ly="[object Int8Array]",py="[object Int16Array]",dy="[object Int32Array]",uy="[object BigInt64Array]",gy="[object Float32Array]",fy="[object Float64Array]";function my(s,e){return s===e||Number.isNaN(s)&&Number.isNaN(e)}function yy(s,e,t){return Ti(s,e,void 0,void 0,void 0,void 0,t)}function Ti(s,e,t,i,r,n,o){let a=o(s,e,t,i,r,n);if(a!==void 0)return a;if(typeof s==typeof e)switch(typeof s){case"bigint":case"string":case"boolean":case"symbol":case"undefined":return s===e;case"number":return s===e||Object.is(s,e);case"function":return s===e;case"object":return Oi(s,e,n,o)}return Oi(s,e,n,o)}function Oi(s,e,t,i){if(Object.is(s,e))return!0;let r=Gh(s),n=Gh(e);if(r===Yh&&(r=Kn),n===Yh&&(n=Kn),r!==n)return!1;switch(r){case Wm:return s.toString()===e.toString();case Gm:{let c=s.valueOf(),h=e.valueOf();return my(c,h)}case Ym:case Xm:case Jm:return Object.is(s.valueOf(),e.valueOf());case Km:return s.source===e.source&&s.flags===e.flags;case ty:return s===e}t=t??new Map;let o=t.get(s),a=t.get(e);if(o!=null&&a!=null)return o===e;t.set(s,e),t.set(e,s);try{switch(r){case Zm:{if(s.size!==e.size)return!1;for(let[c,h]of s.entries())if(!e.has(c)||!Ti(h,e.get(c),c,s,e,t,i))return!1;return!0}case Qm:{if(s.size!==e.size)return!1;let c=Array.from(s.values()),h=Array.from(e.values());for(let p=0;p<c.length;p++){let d=c[p],u=h.findIndex(y=>Ti(d,y,void 0,s,e,t,i));if(u===-1)return!1;h.splice(u,1)}return!0}case ey:case ny:case oy:case ay:case cy:case hy:case ly:case py:case dy:case uy:case gy:case fy:{if(typeof Buffer<"u"&&Buffer.isBuffer(s)!==Buffer.isBuffer(e)||s.length!==e.length)return!1;for(let c=0;c<s.length;c++)if(!Ti(s[c],e[c],c,s,e,t,i))return!1;return!0}case sy:return s.byteLength!==e.byteLength?!1:Oi(new Uint8Array(s),new Uint8Array(e),t,i);case ry:return s.byteLength!==e.byteLength||s.byteOffset!==e.byteOffset?!1:Oi(new Uint8Array(s),new Uint8Array(e),t,i);case iy:return s.name===e.name&&s.message===e.message;case Kn:{if(!(Oi(s.constructor,e.constructor,t,i)||Kh(s)&&Kh(e)))return!1;let c=[...Object.keys(s),...Wh(s)],h=[...Object.keys(e),...Wh(e)];if(c.length!==h.length)return!1;for(let p=0;p<c.length;p++){let d=c[p],u=s[d];if(!Object.hasOwn(e,d))return!1;let y=e[d];if(!Ti(u,y,d,s,e,t,i))return!1}return!0}default:return!1}}finally{t.delete(s),t.delete(e)}}function wy(s,e){return yy(s,e,zm)}var vy=Object.defineProperty,Jh=Object.getOwnPropertySymbols,by=Object.prototype.hasOwnProperty,Ey=Object.prototype.propertyIsEnumerable,go=(s,e,t)=>e in s?vy(s,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):s[e]=t,Xh=(s,e)=>{for(var t in e||(e={}))by.call(e,t)&&go(s,t,e[t]);if(Jh)for(var t of Jh(e))Ey.call(e,t)&&go(s,t,e[t]);return s},Be=(s,e,t)=>go(s,typeof e!="symbol"?e+"":e,t),It=class extends Hi{constructor(e,t,i,r=Et,n=void 0){super(e,t,i,r),this.core=e,this.logger=t,this.name=i,Be(this,"map",new Map),Be(this,"version",Ug),Be(this,"cached",[]),Be(this,"initialized",!1),Be(this,"getKey"),Be(this,"storagePrefix",Et),Be(this,"recentlyDeleted",[]),Be(this,"recentlyDeletedLimit",200),Be(this,"init",()=>l(this,null,function*(){this.initialized||(this.logger.trace("Initialized"),yield this.restore(),this.cached.forEach(o=>{this.getKey&&o!==null&&!we(o)?this.map.set(this.getKey(o),o):yh(o)?this.map.set(o.id,o):wh(o)&&this.map.set(o.topic,o)}),this.cached=[],this.initialized=!0)})),Be(this,"set",(o,a)=>l(this,null,function*(){this.isInitialized(),this.map.has(o)?yield this.update(o,a):(this.logger.debug("Setting value"),this.logger.trace({type:"method",method:"set",key:o,value:a}),this.map.set(o,a),yield this.persist())})),Be(this,"get",o=>(this.isInitialized(),this.logger.debug("Getting value"),this.logger.trace({type:"method",method:"get",key:o}),this.getData(o))),Be(this,"getAll",o=>(this.isInitialized(),o?this.values.filter(a=>Object.keys(o).every(c=>wy(a[c],o[c]))):this.values)),Be(this,"update",(o,a)=>l(this,null,function*(){this.isInitialized(),this.logger.debug("Updating value"),this.logger.trace({type:"method",method:"update",key:o,update:a});let c=Xh(Xh({},this.getData(o)),a);this.map.set(o,c),yield this.persist()})),Be(this,"delete",(o,a)=>l(this,null,function*(){this.isInitialized(),this.map.has(o)&&(this.logger.debug("Deleting value"),this.logger.trace({type:"method",method:"delete",key:o,reason:a}),this.map.delete(o),this.addToRecentlyDeleted(o),yield this.persist())})),this.logger=Se(t,this.name),this.storagePrefix=r,this.getKey=n}get context(){return Le(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}get length(){return this.map.size}get keys(){return Array.from(this.map.keys())}get values(){return Array.from(this.map.values())}addToRecentlyDeleted(e){this.recentlyDeleted.push(e),this.recentlyDeleted.length>=this.recentlyDeletedLimit&&this.recentlyDeleted.splice(0,this.recentlyDeletedLimit/2)}setDataStore(e){return l(this,null,function*(){yield this.core.storage.setItem(this.storageKey,e)})}getDataStore(){return l(this,null,function*(){return yield this.core.storage.getItem(this.storageKey)})}getData(e){let t=this.map.get(e);if(!t){if(this.recentlyDeleted.includes(e)){let{message:r}=x("MISSING_OR_INVALID",`Record was recently deleted - ${this.name}: ${e}`);throw this.logger.error(r),new Error(r)}let{message:i}=x("NO_MATCHING_KEY",`${this.name}: ${e}`);throw this.logger.error(i),new Error(i)}return t}persist(){return l(this,null,function*(){yield this.setDataStore(this.values)})}restore(){return l(this,null,function*(){try{let e=yield this.getDataStore();if(typeof e>"u"||!e.length)return;if(this.map.size){let{message:t}=x("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(t),new Error(t)}this.cached=e,this.logger.debug(`Successfully Restored value for ${this.name}`),this.logger.trace({type:"method",method:"restore",value:this.values})}catch(e){this.logger.debug(`Failed to Restore value for ${this.name}`),this.logger.error(e)}})}isInitialized(){if(!this.initialized){let{message:e}=x("NOT_INITIALIZED",this.name);throw new Error(e)}}},Iy=Object.defineProperty,Cy=(s,e,t)=>e in s?Iy(s,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):s[e]=t,W=(s,e,t)=>Cy(s,typeof e!="symbol"?e+"":e,t),fo=class{constructor(e,t){this.core=e,this.logger=t,W(this,"name",Fg),W(this,"version",jg),W(this,"events",new Ft.default),W(this,"pairings"),W(this,"initialized",!1),W(this,"storagePrefix",Et),W(this,"ignoredPayloadTypes",[at]),W(this,"registeredMethods",[]),W(this,"init",()=>l(this,null,function*(){this.initialized||(yield this.pairings.init(),yield this.cleanup(),this.registerRelayerEvents(),this.registerExpirerEvents(),this.initialized=!0,this.logger.trace("Initialized"))})),W(this,"register",({methods:i})=>{this.isInitialized(),this.registeredMethods=[...new Set([...this.registeredMethods,...i])]}),W(this,"create",i=>l(this,null,function*(){this.isInitialized();let r=fr(),n=yield this.core.crypto.setSymKey(r),o=de(j.FIVE_MINUTES),a={protocol:_o},c={topic:n,expiry:o,relay:a,active:!1,methods:i?.methods},h=Ln({protocol:this.core.protocol,version:this.core.version,topic:n,symKey:r,relay:a,expiryTimestamp:o,methods:i?.methods});return this.events.emit(Gt.create,c),this.core.expirer.set(n,o),yield this.pairings.set(n,c),yield this.core.relayer.subscribe(n,{transportType:i?.transportType}),{topic:n,uri:h}})),W(this,"pair",i=>l(this,null,function*(){this.isInitialized();let r=this.core.eventClient.createEvent({properties:{topic:i?.uri,trace:[lt.pairing_started]}});this.isValidPair(i,r);let{topic:n,symKey:o,relay:a,expiryTimestamp:c,methods:h}=Dn(i.uri);r.props.properties.topic=n,r.addTrace(lt.pairing_uri_validation_success),r.addTrace(lt.pairing_uri_not_expired);let p;if(this.pairings.keys.includes(n)){if(p=this.pairings.get(n),r.addTrace(lt.existing_pairing),p.active)throw r.setError(bt.active_pairing_already_exists),new Error(`Pairing already exists: ${n}. Please try again with a new connection URI.`);r.addTrace(lt.pairing_not_expired)}let d=c||de(j.FIVE_MINUTES),u={topic:n,relay:a,expiry:d,active:!1,methods:h};this.core.expirer.set(n,d),yield this.pairings.set(n,u),r.addTrace(lt.store_new_pairing),i.activatePairing&&(yield this.activate({topic:n})),this.events.emit(Gt.create,u),r.addTrace(lt.emit_inactive_pairing),this.core.crypto.keychain.has(n)||(yield this.core.crypto.setSymKey(o,n)),r.addTrace(lt.subscribing_pairing_topic);try{yield this.core.relayer.confirmOnlineStateOrThrow()}catch{r.setError(bt.no_internet_connection)}try{yield this.core.relayer.subscribe(n,{relay:a})}catch(y){throw r.setError(bt.subscribe_pairing_topic_failure),y}return r.addTrace(lt.subscribe_pairing_topic_success),u})),W(this,"activate",r=>l(this,[r],function*({topic:i}){this.isInitialized();let n=de(j.FIVE_MINUTES);this.core.expirer.set(i,n),yield this.pairings.update(i,{active:!0,expiry:n})})),W(this,"ping",i=>l(this,null,function*(){this.isInitialized(),yield this.isValidPing(i),this.logger.warn("ping() is deprecated and will be removed in the next major release.");let{topic:r}=i;if(this.pairings.keys.includes(r)){let n=yield this.sendRequest(r,"wc_pairingPing",{}),{done:o,resolve:a,reject:c}=Dt();this.events.once(X("pairing_ping",n),({error:h})=>{h?c(h):a()}),yield o()}})),W(this,"updateExpiry",n=>l(this,[n],function*({topic:i,expiry:r}){this.isInitialized(),yield this.pairings.update(i,{expiry:r})})),W(this,"updateMetadata",n=>l(this,[n],function*({topic:i,metadata:r}){this.isInitialized(),yield this.pairings.update(i,{peerMetadata:r})})),W(this,"getPairings",()=>(this.isInitialized(),this.pairings.values)),W(this,"disconnect",i=>l(this,null,function*(){this.isInitialized(),yield this.isValidDisconnect(i);let{topic:r}=i;this.pairings.keys.includes(r)&&(yield this.sendRequest(r,"wc_pairingDelete",ee("USER_DISCONNECTED")),yield this.deletePairing(r))})),W(this,"formatUriFromPairing",i=>{this.isInitialized();let{topic:r,relay:n,expiry:o,methods:a}=i,c=this.core.crypto.keychain.get(r);return Ln({protocol:this.core.protocol,version:this.core.version,topic:r,symKey:c,relay:n,expiryTimestamp:o,methods:a})}),W(this,"sendRequest",(i,r,n)=>l(this,null,function*(){let o=ut(r,n),a=yield this.core.crypto.encode(i,o),c=Si[r].req;return this.core.history.set(i,o),this.core.relayer.publish(i,a,c),o.id})),W(this,"sendResult",(i,r,n)=>l(this,null,function*(){let o=es(i,n),a=yield this.core.crypto.encode(r,o),c=(yield this.core.history.get(r,i)).request.method,h=Si[c].res;yield this.core.relayer.publish(r,a,h),yield this.core.history.resolve(o)})),W(this,"sendError",(i,r,n)=>l(this,null,function*(){let o=Di(i,n),a=yield this.core.crypto.encode(r,o),c=(yield this.core.history.get(r,i)).request.method,h=Si[c]?Si[c].res:Si.unregistered_method.res;yield this.core.relayer.publish(r,a,h),yield this.core.history.resolve(o)})),W(this,"deletePairing",(i,r)=>l(this,null,function*(){yield this.core.relayer.unsubscribe(i),yield Promise.all([this.pairings.delete(i,ee("USER_DISCONNECTED")),this.core.crypto.deleteSymKey(i),r?Promise.resolve():this.core.expirer.del(i)])})),W(this,"cleanup",()=>l(this,null,function*(){let i=this.pairings.getAll().filter(r=>yt(r.expiry));yield Promise.all(i.map(r=>this.deletePairing(r.topic)))})),W(this,"onRelayEventRequest",i=>l(this,null,function*(){let{topic:r,payload:n}=i;switch(n.method){case"wc_pairingPing":return yield this.onPairingPingRequest(r,n);case"wc_pairingDelete":return yield this.onPairingDeleteRequest(r,n);default:return yield this.onUnknownRpcMethodRequest(r,n)}})),W(this,"onRelayEventResponse",i=>l(this,null,function*(){let{topic:r,payload:n}=i,o=(yield this.core.history.get(r,n.id)).request.method;switch(o){case"wc_pairingPing":return this.onPairingPingResponse(r,n);default:return this.onUnknownRpcMethodResponse(o)}})),W(this,"onPairingPingRequest",(i,r)=>l(this,null,function*(){let{id:n}=r;try{this.isValidPing({topic:i}),yield this.sendResult(n,i,!0),this.events.emit(Gt.ping,{id:n,topic:i})}catch(o){yield this.sendError(n,i,o),this.logger.error(o)}})),W(this,"onPairingPingResponse",(i,r)=>{let{id:n}=r;setTimeout(()=>{rt(r)?this.events.emit(X("pairing_ping",n),{}):Ze(r)&&this.events.emit(X("pairing_ping",n),{error:r.error})},500)}),W(this,"onPairingDeleteRequest",(i,r)=>l(this,null,function*(){let{id:n}=r;try{this.isValidDisconnect({topic:i}),yield this.deletePairing(i),this.events.emit(Gt.delete,{id:n,topic:i})}catch(o){yield this.sendError(n,i,o),this.logger.error(o)}})),W(this,"onUnknownRpcMethodRequest",(i,r)=>l(this,null,function*(){let{id:n,method:o}=r;try{if(this.registeredMethods.includes(o))return;let a=ee("WC_METHOD_UNSUPPORTED",o);yield this.sendError(n,i,a),this.logger.error(a)}catch(a){yield this.sendError(n,i,a),this.logger.error(a)}})),W(this,"onUnknownRpcMethodResponse",i=>{this.registeredMethods.includes(i)||this.logger.error(ee("WC_METHOD_UNSUPPORTED",i))}),W(this,"isValidPair",(i,r)=>{var n;if(!Ue(i)){let{message:a}=x("MISSING_OR_INVALID",`pair() params: ${i}`);throw r.setError(bt.malformed_pairing_uri),new Error(a)}if(!mh(i.uri)){let{message:a}=x("MISSING_OR_INVALID",`pair() uri: ${i.uri}`);throw r.setError(bt.malformed_pairing_uri),new Error(a)}let o=Dn(i?.uri);if(!((n=o?.relay)!=null&&n.protocol)){let{message:a}=x("MISSING_OR_INVALID","pair() uri#relay-protocol");throw r.setError(bt.malformed_pairing_uri),new Error(a)}if(!(o!=null&&o.symKey)){let{message:a}=x("MISSING_OR_INVALID","pair() uri#symKey");throw r.setError(bt.malformed_pairing_uri),new Error(a)}if(o!=null&&o.expiryTimestamp&&(0,j.toMiliseconds)(o?.expiryTimestamp)<Date.now()){r.setError(bt.pairing_expired);let{message:a}=x("EXPIRED","pair() URI has expired. Please try again with a new connection URI.");throw new Error(a)}}),W(this,"isValidPing",i=>l(this,null,function*(){if(!Ue(i)){let{message:n}=x("MISSING_OR_INVALID",`ping() params: ${i}`);throw new Error(n)}let{topic:r}=i;yield this.isValidPairingTopic(r)})),W(this,"isValidDisconnect",i=>l(this,null,function*(){if(!Ue(i)){let{message:n}=x("MISSING_OR_INVALID",`disconnect() params: ${i}`);throw new Error(n)}let{topic:r}=i;yield this.isValidPairingTopic(r)})),W(this,"isValidPairingTopic",i=>l(this,null,function*(){if(!le(i,!1)){let{message:r}=x("MISSING_OR_INVALID",`pairing topic should be a string: ${i}`);throw new Error(r)}if(!this.pairings.keys.includes(i)){let{message:r}=x("NO_MATCHING_KEY",`pairing topic doesn't exist: ${i}`);throw new Error(r)}if(yt(this.pairings.get(i).expiry)){yield this.deletePairing(i);let{message:r}=x("EXPIRED",`pairing topic: ${i}`);throw new Error(r)}})),this.core=e,this.logger=Se(t,this.name),this.pairings=new It(this.core,this.logger,this.name,this.storagePrefix)}get context(){return Le(this.logger)}isInitialized(){if(!this.initialized){let{message:e}=x("NOT_INITIALIZED",this.name);throw new Error(e)}}registerRelayerEvents(){this.core.relayer.on(ve.message,e=>l(this,null,function*(){let{topic:t,message:i,transportType:r}=e;if(this.pairings.keys.includes(t)&&r!==ae.link_mode&&!this.ignoredPayloadTypes.includes(this.core.crypto.getPayloadType(i)))try{let n=yield this.core.crypto.decode(t,i);si(n)?(this.core.history.set(t,n),yield this.onRelayEventRequest({topic:t,payload:n})):ii(n)&&(yield this.core.history.resolve(n),yield this.onRelayEventResponse({topic:t,payload:n}),this.core.history.delete(t,n.id)),yield this.core.relayer.messages.ack(t,i)}catch(n){this.logger.error(n)}}))}registerExpirerEvents(){this.core.expirer.on(Je.expired,e=>l(this,null,function*(){let{topic:t}=cr(e.target);t&&this.pairings.keys.includes(t)&&(yield this.deletePairing(t,!0),this.events.emit(Gt.expire,{topic:t}))}))}},_y=Object.defineProperty,Py=(s,e,t)=>e in s?_y(s,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):s[e]=t,Te=(s,e,t)=>Py(s,typeof e!="symbol"?e+"":e,t),mo=class extends $i{constructor(e,t){super(e,t),this.core=e,this.logger=t,Te(this,"records",new Map),Te(this,"events",new Ft.EventEmitter),Te(this,"name",$g),Te(this,"version",Bg),Te(this,"cached",[]),Te(this,"initialized",!1),Te(this,"storagePrefix",Et),Te(this,"init",()=>l(this,null,function*(){this.initialized||(this.logger.trace("Initialized"),yield this.restore(),this.cached.forEach(i=>this.records.set(i.id,i)),this.cached=[],this.registerEventListeners(),this.initialized=!0)})),Te(this,"set",(i,r,n)=>{if(this.isInitialized(),this.logger.debug("Setting JSON-RPC request history record"),this.logger.trace({type:"method",method:"set",topic:i,request:r,chainId:n}),this.records.has(r.id))return;let o={id:r.id,topic:i,request:{method:r.method,params:r.params||null},chainId:n,expiry:de(j.THIRTY_DAYS)};this.records.set(o.id,o),this.persist(),this.events.emit(ct.created,o)}),Te(this,"resolve",i=>l(this,null,function*(){if(this.isInitialized(),this.logger.debug("Updating JSON-RPC response history record"),this.logger.trace({type:"method",method:"update",response:i}),!this.records.has(i.id))return;let r=yield this.getRecord(i.id);typeof r.response>"u"&&(r.response=Ze(i)?{error:i.error}:{result:i.result},this.records.set(r.id,r),this.persist(),this.events.emit(ct.updated,r))})),Te(this,"get",(i,r)=>l(this,null,function*(){return this.isInitialized(),this.logger.debug("Getting record"),this.logger.trace({type:"method",method:"get",topic:i,id:r}),yield this.getRecord(r)})),Te(this,"delete",(i,r)=>{this.isInitialized(),this.logger.debug("Deleting record"),this.logger.trace({type:"method",method:"delete",id:r}),this.values.forEach(n=>{if(n.topic===i){if(typeof r<"u"&&n.id!==r)return;this.records.delete(n.id),this.events.emit(ct.deleted,n)}}),this.persist()}),Te(this,"exists",(i,r)=>l(this,null,function*(){return this.isInitialized(),this.records.has(r)?(yield this.getRecord(r)).topic===i:!1})),Te(this,"on",(i,r)=>{this.events.on(i,r)}),Te(this,"once",(i,r)=>{this.events.once(i,r)}),Te(this,"off",(i,r)=>{this.events.off(i,r)}),Te(this,"removeListener",(i,r)=>{this.events.removeListener(i,r)}),this.logger=Se(t,this.name)}get context(){return Le(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}get size(){return this.records.size}get keys(){return Array.from(this.records.keys())}get values(){return Array.from(this.records.values())}get pending(){let e=[];return this.values.forEach(t=>{if(typeof t.response<"u")return;let i={topic:t.topic,request:ut(t.request.method,t.request.params,t.id),chainId:t.chainId};return e.push(i)}),e}setJsonRpcRecords(e){return l(this,null,function*(){yield this.core.storage.setItem(this.storageKey,e)})}getJsonRpcRecords(){return l(this,null,function*(){return yield this.core.storage.getItem(this.storageKey)})}getRecord(e){this.isInitialized();let t=this.records.get(e);if(!t){let{message:i}=x("NO_MATCHING_KEY",`${this.name}: ${e}`);throw new Error(i)}return t}persist(){return l(this,null,function*(){yield this.setJsonRpcRecords(this.values),this.events.emit(ct.sync)})}restore(){return l(this,null,function*(){try{let e=yield this.getJsonRpcRecords();if(typeof e>"u"||!e.length)return;if(this.records.size){let{message:t}=x("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(t),new Error(t)}this.cached=e,this.logger.debug(`Successfully Restored records for ${this.name}`),this.logger.trace({type:"method",method:"restore",records:this.values})}catch(e){this.logger.debug(`Failed to Restore records for ${this.name}`),this.logger.error(e)}})}registerEventListeners(){this.events.on(ct.created,e=>{let t=ct.created;this.logger.info(`Emitting ${t}`),this.logger.debug({type:"event",event:t,record:e})}),this.events.on(ct.updated,e=>{let t=ct.updated;this.logger.info(`Emitting ${t}`),this.logger.debug({type:"event",event:t,record:e})}),this.events.on(ct.deleted,e=>{let t=ct.deleted;this.logger.info(`Emitting ${t}`),this.logger.debug({type:"event",event:t,record:e})}),this.core.heartbeat.on(gs.pulse,()=>{this.cleanup()})}cleanup(){try{this.isInitialized();let e=!1;this.records.forEach(t=>{(0,j.toMiliseconds)(t.expiry||0)-Date.now()<=0&&(this.logger.info(`Deleting expired history log: ${t.id}`),this.records.delete(t.id),this.events.emit(ct.deleted,t,!1),e=!0)}),e&&this.persist()}catch(e){this.logger.warn(e)}}isInitialized(){if(!this.initialized){let{message:e}=x("NOT_INITIALIZED",this.name);throw new Error(e)}}},Sy=Object.defineProperty,Ay=(s,e,t)=>e in s?Sy(s,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):s[e]=t,De=(s,e,t)=>Ay(s,typeof e!="symbol"?e+"":e,t),yo=class extends Ki{constructor(e,t){super(e,t),this.core=e,this.logger=t,De(this,"expirations",new Map),De(this,"events",new Ft.EventEmitter),De(this,"name",Mg),De(this,"version",Vg),De(this,"cached",[]),De(this,"initialized",!1),De(this,"storagePrefix",Et),De(this,"init",()=>l(this,null,function*(){this.initialized||(this.logger.trace("Initialized"),yield this.restore(),this.cached.forEach(i=>this.expirations.set(i.target,i)),this.cached=[],this.registerEventListeners(),this.initialized=!0)})),De(this,"has",i=>{try{let r=this.formatTarget(i);return typeof this.getExpiration(r)<"u"}catch{return!1}}),De(this,"set",(i,r)=>{this.isInitialized();let n=this.formatTarget(i),o={target:n,expiry:r};this.expirations.set(n,o),this.checkExpiry(n,o),this.events.emit(Je.created,{target:n,expiration:o})}),De(this,"get",i=>{this.isInitialized();let r=this.formatTarget(i);return this.getExpiration(r)}),De(this,"del",i=>{if(this.isInitialized(),this.has(i)){let r=this.formatTarget(i),n=this.getExpiration(r);this.expirations.delete(r),this.events.emit(Je.deleted,{target:r,expiration:n})}}),De(this,"on",(i,r)=>{this.events.on(i,r)}),De(this,"once",(i,r)=>{this.events.once(i,r)}),De(this,"off",(i,r)=>{this.events.off(i,r)}),De(this,"removeListener",(i,r)=>{this.events.removeListener(i,r)}),this.logger=Se(t,this.name)}get context(){return Le(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}get length(){return this.expirations.size}get keys(){return Array.from(this.expirations.keys())}get values(){return Array.from(this.expirations.values())}formatTarget(e){if(typeof e=="string")return _c(e);if(typeof e=="number")return Pc(e);let{message:t}=x("UNKNOWN_TYPE",`Target type: ${typeof e}`);throw new Error(t)}setExpirations(e){return l(this,null,function*(){yield this.core.storage.setItem(this.storageKey,e)})}getExpirations(){return l(this,null,function*(){return yield this.core.storage.getItem(this.storageKey)})}persist(){return l(this,null,function*(){yield this.setExpirations(this.values),this.events.emit(Je.sync)})}restore(){return l(this,null,function*(){try{let e=yield this.getExpirations();if(typeof e>"u"||!e.length)return;if(this.expirations.size){let{message:t}=x("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(t),new Error(t)}this.cached=e,this.logger.debug(`Successfully Restored expirations for ${this.name}`),this.logger.trace({type:"method",method:"restore",expirations:this.values})}catch(e){this.logger.debug(`Failed to Restore expirations for ${this.name}`),this.logger.error(e)}})}getExpiration(e){let t=this.expirations.get(e);if(!t){let{message:i}=x("NO_MATCHING_KEY",`${this.name}: ${e}`);throw this.logger.warn(i),new Error(i)}return t}checkExpiry(e,t){let{expiry:i}=t;(0,j.toMiliseconds)(i)-Date.now()<=0&&this.expire(e,t)}expire(e,t){this.expirations.delete(e),this.events.emit(Je.expired,{target:e,expiration:t})}checkExpirations(){this.core.relayer.connected&&this.expirations.forEach((e,t)=>this.checkExpiry(t,e))}registerEventListeners(){this.core.heartbeat.on(gs.pulse,()=>this.checkExpirations()),this.events.on(Je.created,e=>{let t=Je.created;this.logger.info(`Emitting ${t}`),this.logger.debug({type:"event",event:t,data:e}),this.persist()}),this.events.on(Je.expired,e=>{let t=Je.expired;this.logger.info(`Emitting ${t}`),this.logger.debug({type:"event",event:t,data:e}),this.persist()}),this.events.on(Je.deleted,e=>{let t=Je.deleted;this.logger.info(`Emitting ${t}`),this.logger.debug({type:"event",event:t,data:e}),this.persist()})}isInitialized(){if(!this.initialized){let{message:e}=x("NOT_INITIALIZED",this.name);throw new Error(e)}}},Ny=Object.defineProperty,Ty=(s,e,t)=>e in s?Ny(s,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):s[e]=t,ge=(s,e,t)=>Ty(s,typeof e!="symbol"?e+"":e,t),wo=class extends Wi{constructor(e,t,i){super(e,t,i),this.core=e,this.logger=t,this.store=i,ge(this,"name",Hg),ge(this,"abortController"),ge(this,"isDevEnv"),ge(this,"verifyUrlV3",Kg),ge(this,"storagePrefix",Et),ge(this,"version",rl),ge(this,"publicKey"),ge(this,"fetchPromise"),ge(this,"init",()=>l(this,null,function*(){var r;this.isDevEnv||(this.publicKey=yield this.store.getItem(this.storeKey),this.publicKey&&(0,j.toMiliseconds)((r=this.publicKey)==null?void 0:r.expiresAt)<Date.now()&&(this.logger.debug("verify v2 public key expired"),yield this.removePublicKey()))})),ge(this,"register",r=>l(this,null,function*(){if(!Ns()||this.isDevEnv)return;let n=window.location.origin,{id:o,decryptedId:a}=r,c=`${this.verifyUrlV3}/attestation?projectId=${this.core.projectId}&origin=${n}&id=${o}&decryptedId=${a}`;try{let h=(0,sl.getDocument)(),p=this.startAbortTimer(j.ONE_SECOND*5),d=yield new Promise((u,y)=>{let f=()=>{window.removeEventListener("message",g),h.body.removeChild(m),y("attestation aborted")};this.abortController.signal.addEventListener("abort",f);let m=h.createElement("iframe");m.src=c,m.style.display="none",m.addEventListener("error",f,{signal:this.abortController.signal});let g=v=>{if(v.data&&typeof v.data=="string")try{let w=JSON.parse(v.data);if(w.type==="verify_attestation"){if(ti(w.attestation).payload.id!==o)return;clearInterval(p),h.body.removeChild(m),this.abortController.signal.removeEventListener("abort",f),window.removeEventListener("message",g),u(w.attestation===null?"":w.attestation)}}catch(w){this.logger.warn(w)}};h.body.appendChild(m),window.addEventListener("message",g,{signal:this.abortController.signal})});return this.logger.debug("jwt attestation",d),d}catch(h){this.logger.warn(h)}return""})),ge(this,"resolve",r=>l(this,null,function*(){if(this.isDevEnv)return"";let{attestationId:n,hash:o,encryptedId:a}=r;if(n===""){this.logger.debug("resolve: attestationId is empty, skipping");return}if(n){if(ti(n).payload.id!==a)return;let h=yield this.isValidJwtAttestation(n);if(h){if(!h.isVerified){this.logger.warn("resolve: jwt attestation: origin url not verified");return}return h}}if(!o)return;let c=this.getVerifyUrl(r?.verifyUrl);return this.fetchAttestation(o,c)})),ge(this,"fetchAttestation",(r,n)=>l(this,null,function*(){this.logger.debug(`resolving attestation: ${r} from url: ${n}`);let o=this.startAbortTimer(j.ONE_SECOND*5),a=yield fetch(`${n}/attestation/${r}?v2Supported=true`,{signal:this.abortController.signal});return clearTimeout(o),a.status===200?yield a.json():void 0})),ge(this,"getVerifyUrl",r=>{let n=r||Fs;return Wg.includes(n)||(this.logger.info(`verify url: ${n}, not included in trusted list, assigning default: ${Fs}`),n=Fs),n}),ge(this,"fetchPublicKey",()=>l(this,null,function*(){try{this.logger.debug(`fetching public key from: ${this.verifyUrlV3}`);let r=this.startAbortTimer(j.FIVE_SECONDS),n=yield fetch(`${this.verifyUrlV3}/public-key`,{signal:this.abortController.signal});return clearTimeout(r),yield n.json()}catch(r){this.logger.warn(r)}})),ge(this,"persistPublicKey",r=>l(this,null,function*(){this.logger.debug("persisting public key to local storage",r),yield this.store.setItem(this.storeKey,r),this.publicKey=r})),ge(this,"removePublicKey",()=>l(this,null,function*(){this.logger.debug("removing verify v2 public key from storage"),yield this.store.removeItem(this.storeKey),this.publicKey=void 0})),ge(this,"isValidJwtAttestation",r=>l(this,null,function*(){let n=yield this.getPublicKey();try{if(n)return this.validateAttestation(r,n)}catch(a){this.logger.error(a),this.logger.warn("error validating attestation")}let o=yield this.fetchAndPersistPublicKey();try{if(o)return this.validateAttestation(r,o)}catch(a){this.logger.error(a),this.logger.warn("error validating attestation")}})),ge(this,"getPublicKey",()=>l(this,null,function*(){return this.publicKey?this.publicKey:yield this.fetchAndPersistPublicKey()})),ge(this,"fetchAndPersistPublicKey",()=>l(this,null,function*(){if(this.fetchPromise)return yield this.fetchPromise,this.publicKey;this.fetchPromise=new Promise(n=>l(this,null,function*(){let o=yield this.fetchPublicKey();o&&(yield this.persistPublicKey(o),n(o))}));let r=yield this.fetchPromise;return this.fetchPromise=void 0,r})),ge(this,"validateAttestation",(r,n)=>{let o=gh(r,n.publicKey),a={hasExpired:(0,j.toMiliseconds)(o.exp)<Date.now(),payload:o};if(a.hasExpired)throw this.logger.warn("resolve: jwt attestation expired"),new Error("JWT attestation expired");return{origin:a.payload.origin,isScam:a.payload.isScam,isVerified:a.payload.isVerified}}),this.logger=Se(t,this.name),this.abortController=new AbortController,this.isDevEnv=yi(),this.init()}get storeKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//verify:public:key"}get context(){return Le(this.logger)}startAbortTimer(e){return this.abortController=new AbortController,setTimeout(()=>this.abortController.abort(),(0,j.toMiliseconds)(e))}},Oy=Object.defineProperty,Ry=(s,e,t)=>e in s?Oy(s,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):s[e]=t,Zh=(s,e,t)=>Ry(s,typeof e!="symbol"?e+"":e,t),vo=class extends Gi{constructor(e,t){super(e,t),this.projectId=e,this.logger=t,Zh(this,"context",Gg),Zh(this,"registerDeviceToken",i=>l(this,null,function*(){let{clientId:r,token:n,notificationType:o,enableEncrypted:a=!1}=i,c=`${Yg}/${this.projectId}/clients`;yield fetch(c,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({client_id:r,type:o,token:n,always_raw:a})})})),this.logger=Se(t,this.context)}},xy=Object.defineProperty,Qh=Object.getOwnPropertySymbols,ky=Object.prototype.hasOwnProperty,Uy=Object.prototype.propertyIsEnumerable,bo=(s,e,t)=>e in s?xy(s,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):s[e]=t,Ni=(s,e)=>{for(var t in e||(e={}))ky.call(e,t)&&bo(s,t,e[t]);if(Qh)for(var t of Qh(e))Uy.call(e,t)&&bo(s,t,e[t]);return s},_e=(s,e,t)=>bo(s,typeof e!="symbol"?e+"":e,t),Eo=class extends Yi{constructor(e,t,i=!0){super(e,t,i),this.core=e,this.logger=t,_e(this,"context",Xg),_e(this,"storagePrefix",Et),_e(this,"storageVersion",Jg),_e(this,"events",new Map),_e(this,"shouldPersist",!1),_e(this,"init",()=>l(this,null,function*(){if(!yi())try{let r={eventId:In(),timestamp:Date.now(),domain:this.getAppDomain(),props:{event:"INIT",type:"",properties:{client_id:yield this.core.crypto.getClientId(),user_agent:bn(this.core.relayer.protocol,this.core.relayer.version,Wn)}}};yield this.sendEvent([r])}catch(r){this.logger.warn(r)}})),_e(this,"createEvent",r=>{let{event:n="ERROR",type:o="",properties:{topic:a,trace:c}}=r,h=In(),p=this.core.projectId||"",d=Date.now(),u=Ni({eventId:h,timestamp:d,props:{event:n,type:o,properties:{topic:a,trace:c}},bundleId:p,domain:this.getAppDomain()},this.setMethods(h));return this.telemetryEnabled&&(this.events.set(h,u),this.shouldPersist=!0),u}),_e(this,"getEvent",r=>{let{eventId:n,topic:o}=r;if(n)return this.events.get(n);let a=Array.from(this.events.values()).find(c=>c.props.properties.topic===o);if(a)return Ni(Ni({},a),this.setMethods(a.eventId))}),_e(this,"deleteEvent",r=>{let{eventId:n}=r;this.events.delete(n),this.shouldPersist=!0}),_e(this,"setEventListeners",()=>{this.core.heartbeat.on(gs.pulse,()=>l(this,null,function*(){this.shouldPersist&&(yield this.persist()),this.events.forEach(r=>{(0,j.fromMiliseconds)(Date.now())-(0,j.fromMiliseconds)(r.timestamp)>Zg&&(this.events.delete(r.eventId),this.shouldPersist=!0)})}))}),_e(this,"setMethods",r=>({addTrace:n=>this.addTrace(r,n),setError:n=>this.setError(r,n)})),_e(this,"addTrace",(r,n)=>{let o=this.events.get(r);o&&(o.props.properties.trace.push(n),this.events.set(r,o),this.shouldPersist=!0)}),_e(this,"setError",(r,n)=>{let o=this.events.get(r);o&&(o.props.type=n,o.timestamp=Date.now(),this.events.set(r,o),this.shouldPersist=!0)}),_e(this,"persist",()=>l(this,null,function*(){yield this.core.storage.setItem(this.storageKey,Array.from(this.events.values())),this.shouldPersist=!1})),_e(this,"restore",()=>l(this,null,function*(){try{let r=(yield this.core.storage.getItem(this.storageKey))||[];if(!r.length)return;r.forEach(n=>{this.events.set(n.eventId,Ni(Ni({},n),this.setMethods(n.eventId)))})}catch(r){this.logger.warn(r)}})),_e(this,"submit",()=>l(this,null,function*(){if(!this.telemetryEnabled||this.events.size===0)return;let r=[];for(let[n,o]of this.events)o.props.type&&r.push(o);if(r.length!==0)try{if((yield this.sendEvent(r)).ok)for(let n of r)this.events.delete(n.eventId),this.shouldPersist=!0}catch(n){this.logger.warn(n)}})),_e(this,"sendEvent",r=>l(this,null,function*(){let n=this.getAppDomain()?"":"&sp=desktop";return yield fetch(`${Qg}?projectId=${this.core.projectId}&st=events_sdk&sv=js-${Wn}${n}`,{method:"POST",body:JSON.stringify(r)})})),_e(this,"getAppDomain",()=>vn().url),this.logger=Se(t,this.context),this.telemetryEnabled=i,i?this.restore().then(()=>l(this,null,function*(){yield this.submit(),this.setEventListeners()})):this.persist()}get storageKey(){return this.storagePrefix+this.storageVersion+this.core.customStoragePrefix+"//"+this.context}},Dy=Object.defineProperty,el=Object.getOwnPropertySymbols,Ly=Object.prototype.hasOwnProperty,qy=Object.prototype.propertyIsEnumerable,Io=(s,e,t)=>e in s?Dy(s,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):s[e]=t,tl=(s,e)=>{for(var t in e||(e={}))Ly.call(e,t)&&Io(s,t,e[t]);if(el)for(var t of el(e))qy.call(e,t)&&Io(s,t,e[t]);return s},oe=(s,e,t)=>Io(s,typeof e!="symbol"?e+"":e,t),Co=class s extends ji{constructor(e){var t;super(e),oe(this,"protocol",il),oe(this,"version",rl),oe(this,"name",br),oe(this,"relayUrl"),oe(this,"projectId"),oe(this,"customStoragePrefix"),oe(this,"events",new Ft.EventEmitter),oe(this,"logger"),oe(this,"heartbeat"),oe(this,"relayer"),oe(this,"crypto"),oe(this,"storage"),oe(this,"history"),oe(this,"expirer"),oe(this,"pairing"),oe(this,"verify"),oe(this,"echoClient"),oe(this,"linkModeSupportedApps"),oe(this,"eventClient"),oe(this,"initialized",!1),oe(this,"logChunkController"),oe(this,"on",(a,c)=>this.events.on(a,c)),oe(this,"once",(a,c)=>this.events.once(a,c)),oe(this,"off",(a,c)=>this.events.off(a,c)),oe(this,"removeListener",(a,c)=>this.events.removeListener(a,c)),oe(this,"dispatchEnvelope",({topic:a,message:c,sessionExists:h})=>{if(!a||!c)return;let p={topic:a,message:c,publishedAt:Date.now(),transportType:ae.link_mode};this.relayer.onLinkMessageEvent(p,{sessionExists:h})});let i=this.getGlobalCore(e?.customStoragePrefix);if(i)try{return this.customStoragePrefix=i.customStoragePrefix,this.logger=i.logger,this.heartbeat=i.heartbeat,this.crypto=i.crypto,this.history=i.history,this.expirer=i.expirer,this.storage=i.storage,this.relayer=i.relayer,this.pairing=i.pairing,this.verify=i.verify,this.echoClient=i.echoClient,this.linkModeSupportedApps=i.linkModeSupportedApps,this.eventClient=i.eventClient,this.initialized=i.initialized,this.logChunkController=i.logChunkController,i}catch(a){console.warn("Failed to copy global core",a)}this.projectId=e?.projectId,this.relayUrl=e?.relayUrl||nl,this.customStoragePrefix=e!=null&&e.customStoragePrefix?`:${e.customStoragePrefix}`:"";let r=Qt({level:typeof e?.logger=="string"&&e.logger?e.logger:Eg.logger,name:br}),{logger:n,chunkLoggerController:o}=ua({opts:r,maxSizeInBytes:e?.maxLogBlobSizeInBytes,loggerOverride:e?.logger});this.logChunkController=o,(t=this.logChunkController)!=null&&t.downloadLogsBlobInBrowser&&(window.downloadLogsBlobInBrowser=()=>l(this,null,function*(){var a,c;(a=this.logChunkController)!=null&&a.downloadLogsBlobInBrowser&&((c=this.logChunkController)==null||c.downloadLogsBlobInBrowser({clientId:yield this.crypto.getClientId()}))})),this.logger=Se(n,this.name),this.heartbeat=new pa,this.crypto=new io(this,this.logger,e?.keychain),this.history=new mo(this,this.logger),this.expirer=new yo(this,this.logger),this.storage=e!=null&&e.storage?e.storage:new da(tl(tl({},Ig),e?.storageOptions)),this.relayer=new uo({core:this,logger:this.logger,relayUrl:this.relayUrl,projectId:this.projectId}),this.pairing=new fo(this,this.logger),this.verify=new wo(this,this.logger,this.storage),this.echoClient=new vo(this.projectId||"",this.logger),this.linkModeSupportedApps=[],this.eventClient=new Eo(this,this.logger,e?.telemetryEnabled),this.setGlobalCore(this)}static init(e){return l(this,null,function*(){let t=new s(e);yield t.initialize();let i=yield t.crypto.getClientId();return yield t.storage.setItem(Dg,i),t})}get context(){return Le(this.logger)}start(){return l(this,null,function*(){this.initialized||(yield this.initialize())})}getLogsBlob(){return l(this,null,function*(){var e;return(e=this.logChunkController)==null?void 0:e.logsToBlob({clientId:yield this.crypto.getClientId()})})}addLinkModeSupportedApp(e){return l(this,null,function*(){this.linkModeSupportedApps.includes(e)||(this.linkModeSupportedApps.push(e),yield this.storage.setItem(Uh,this.linkModeSupportedApps))})}initialize(){return l(this,null,function*(){this.logger.trace("Initialized");try{yield this.crypto.init(),yield this.history.init(),yield this.expirer.init(),yield this.relayer.init(),yield this.heartbeat.init(),yield this.pairing.init(),this.linkModeSupportedApps=(yield this.storage.getItem(Uh))||[],this.initialized=!0,this.logger.info("Core Initialization Success")}catch(e){throw this.logger.warn(`Core Initialization Failure at epoch ${Date.now()}`,e),this.logger.error(e.message),e}})}getGlobalCore(e=""){try{if(this.isGlobalCoreDisabled())return;let t=`_walletConnectCore_${e}`,i=`${t}_count`;return globalThis[i]=(globalThis[i]||0)+1,globalThis[i]>1&&console.warn(`WalletConnect Core is already initialized. This is probably a mistake and can lead to unexpected behavior. Init() was called ${globalThis[i]} times.`),globalThis[t]}catch(t){console.warn("Failed to get global WalletConnect core",t);return}}setGlobalCore(e){var t;try{if(this.isGlobalCoreDisabled())return;let i=`_walletConnectCore_${((t=e.opts)==null?void 0:t.customStoragePrefix)||""}`;globalThis[i]=e}catch(i){console.warn("Failed to set global WalletConnect core",i)}}isGlobalCoreDisabled(){try{return typeof process<"u"&&process.env.DISABLE_GLOBAL_CORE==="true"}catch{return!0}}},yl=Co;var K=dt(Lr());var _r=dt(Ui());var Il="wc",Cl=2,_l="client",qo=`${Il}@${Cl}:${_l}:`,Po={name:_l,logger:"error",controller:!1,relayUrl:"wss://relay.walletconnect.org"};var wl="WALLETCONNECT_DEEPLINK_CHOICE";var Fy="proposal";var vl="Proposal expired",jy="session",$s=K.SEVEN_DAYS,$y="engine",Pe={wc_sessionPropose:{req:{ttl:K.FIVE_MINUTES,prompt:!0,tag:1100},res:{ttl:K.FIVE_MINUTES,prompt:!1,tag:1101},reject:{ttl:K.FIVE_MINUTES,prompt:!1,tag:1120},autoReject:{ttl:K.FIVE_MINUTES,prompt:!1,tag:1121}},wc_sessionSettle:{req:{ttl:K.FIVE_MINUTES,prompt:!1,tag:1102},res:{ttl:K.FIVE_MINUTES,prompt:!1,tag:1103}},wc_sessionUpdate:{req:{ttl:K.ONE_DAY,prompt:!1,tag:1104},res:{ttl:K.ONE_DAY,prompt:!1,tag:1105}},wc_sessionExtend:{req:{ttl:K.ONE_DAY,prompt:!1,tag:1106},res:{ttl:K.ONE_DAY,prompt:!1,tag:1107}},wc_sessionRequest:{req:{ttl:K.FIVE_MINUTES,prompt:!0,tag:1108},res:{ttl:K.FIVE_MINUTES,prompt:!1,tag:1109}},wc_sessionEvent:{req:{ttl:K.FIVE_MINUTES,prompt:!0,tag:1110},res:{ttl:K.FIVE_MINUTES,prompt:!1,tag:1111}},wc_sessionDelete:{req:{ttl:K.ONE_DAY,prompt:!1,tag:1112},res:{ttl:K.ONE_DAY,prompt:!1,tag:1113}},wc_sessionPing:{req:{ttl:K.ONE_DAY,prompt:!1,tag:1114},res:{ttl:K.ONE_DAY,prompt:!1,tag:1115}},wc_sessionAuthenticate:{req:{ttl:K.ONE_HOUR,prompt:!0,tag:1116},res:{ttl:K.ONE_HOUR,prompt:!1,tag:1117},reject:{ttl:K.FIVE_MINUTES,prompt:!1,tag:1118},autoReject:{ttl:K.FIVE_MINUTES,prompt:!1,tag:1119}}},So={min:K.FIVE_MINUTES,max:K.SEVEN_DAYS},Ct={idle:"IDLE",active:"ACTIVE"},bl={eth_sendTransaction:{key:""},eth_sendRawTransaction:{key:""},wallet_sendCalls:{key:""},solana_signTransaction:{key:"signature"},solana_signAllTransactions:{key:"transactions"},solana_signAndSendTransaction:{key:"signature"}},By="request",My=["wc_sessionPropose","wc_sessionRequest","wc_authRequest","wc_sessionAuthenticate"],Vy="wc";var Hy="auth",zy="authKeys",Ky="pairingTopics",Wy="requests",Pr=`${Vy}@${1.5}:${Hy}:`,Ir=`${Pr}:PUB_KEY`,Gy=Object.defineProperty,Yy=Object.defineProperties,Jy=Object.getOwnPropertyDescriptors,El=Object.getOwnPropertySymbols,Xy=Object.prototype.hasOwnProperty,Zy=Object.prototype.propertyIsEnumerable,No=(s,e,t)=>e in s?Gy(s,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):s[e]=t,ie=(s,e)=>{for(var t in e||(e={}))Xy.call(e,t)&&No(s,t,e[t]);if(El)for(var t of El(e))Zy.call(e,t)&&No(s,t,e[t]);return s},qe=(s,e)=>Yy(s,Jy(e)),I=(s,e,t)=>No(s,typeof e!="symbol"?e+"":e,t),To=class extends Xi{constructor(e){super(e),I(this,"name",$y),I(this,"events",new _r.default),I(this,"initialized",!1),I(this,"requestQueue",{state:Ct.idle,queue:[]}),I(this,"sessionRequestQueue",{state:Ct.idle,queue:[]}),I(this,"requestQueueDelay",K.ONE_SECOND),I(this,"expectedPairingMethodMap",new Map),I(this,"recentlyDeletedMap",new Map),I(this,"recentlyDeletedLimit",200),I(this,"relayMessageCache",[]),I(this,"pendingSessions",new Map),I(this,"init",()=>l(this,null,function*(){this.initialized||(yield this.cleanup(),this.registerRelayerEvents(),this.registerExpirerEvents(),this.registerPairingEvents(),yield this.registerLinkModeListeners(),this.client.core.pairing.register({methods:Object.keys(Pe)}),this.initialized=!0,setTimeout(()=>l(this,null,function*(){yield this.processPendingMessageEvents(),this.sessionRequestQueue.queue=this.getPendingSessionRequests(),this.processSessionRequestQueue()}),(0,K.toMiliseconds)(this.requestQueueDelay)))})),I(this,"connect",t=>l(this,null,function*(){this.isInitialized(),yield this.confirmOnlineStateOrThrow();let i=qe(ie({},t),{requiredNamespaces:t.requiredNamespaces||{},optionalNamespaces:t.optionalNamespaces||{}});yield this.isValidConnect(i);let{pairingTopic:r,requiredNamespaces:n,optionalNamespaces:o,sessionProperties:a,scopedProperties:c,relays:h}=i,p=r,d,u=!1;try{if(p){let P=this.client.core.pairing.pairings.get(p);this.client.logger.warn("connect() with existing pairing topic is deprecated and will be removed in the next major release."),u=P.active}}catch(P){throw this.client.logger.error(`connect() -> pairing.get(${p}) failed`),P}if(!p||!u){let{topic:P,uri:A}=yield this.client.core.pairing.create();p=P,d=A}if(!p){let{message:P}=x("NO_MATCHING_KEY",`connect() pairing topic: ${p}`);throw new Error(P)}let y=yield this.client.core.crypto.generateKeyPair(),f=Pe.wc_sessionPropose.req.ttl||K.FIVE_MINUTES,m=de(f),g=qe(ie(ie({requiredNamespaces:n,optionalNamespaces:o,relays:h??[{protocol:_o}],proposer:{publicKey:y,metadata:this.client.metadata},expiryTimestamp:m,pairingTopic:p},a&&{sessionProperties:a}),c&&{scopedProperties:c}),{id:St()}),v=X("session_connect",g.id),{reject:w,resolve:b,done:_}=Dt(f,vl),R=({id:P})=>{P===g.id&&(this.client.events.off("proposal_expire",R),this.pendingSessions.delete(g.id),this.events.emit(v,{error:{message:vl,code:0}}))};return this.client.events.on("proposal_expire",R),this.events.once(v,({error:P,session:A})=>{this.client.events.off("proposal_expire",R),P?w(P):A&&b(A)}),yield this.sendRequest({topic:p,method:"wc_sessionPropose",params:g,throwOnFailedPublish:!0,clientRpcId:g.id}),yield this.setProposal(g.id,g),{uri:d,approval:_}})),I(this,"pair",t=>l(this,null,function*(){this.isInitialized(),yield this.confirmOnlineStateOrThrow();try{return yield this.client.core.pairing.pair(t)}catch(i){throw this.client.logger.error("pair() failed"),i}})),I(this,"approve",t=>l(this,null,function*(){var i,r,n;let o=this.client.core.eventClient.createEvent({properties:{topic:(i=t?.id)==null?void 0:i.toString(),trace:[tt.session_approve_started]}});try{this.isInitialized(),yield this.confirmOnlineStateOrThrow()}catch(E){throw o.setError(Yt.no_internet_connection),E}try{yield this.isValidProposalId(t?.id)}catch(E){throw this.client.logger.error(`approve() -> proposal.get(${t?.id}) failed`),o.setError(Yt.proposal_not_found),E}try{yield this.isValidApprove(t)}catch(E){throw this.client.logger.error("approve() -> isValidApprove() failed"),o.setError(Yt.session_approve_namespace_validation_failure),E}let{id:a,relayProtocol:c,namespaces:h,sessionProperties:p,scopedProperties:d,sessionConfig:u}=t,y=this.client.proposal.get(a);this.client.core.eventClient.deleteEvent({eventId:o.eventId});let{pairingTopic:f,proposer:m,requiredNamespaces:g,optionalNamespaces:v}=y,w=(r=this.client.core.eventClient)==null?void 0:r.getEvent({topic:f});w||(w=(n=this.client.core.eventClient)==null?void 0:n.createEvent({type:tt.session_approve_started,properties:{topic:f,trace:[tt.session_approve_started,tt.session_namespaces_validation_success]}}));let b=yield this.client.core.crypto.generateKeyPair(),_=m.publicKey,R=yield this.client.core.crypto.generateSharedKey(b,_),P=ie(ie(ie({relay:{protocol:c??"irn"},namespaces:h,controller:{publicKey:b,metadata:this.client.metadata},expiry:de($s)},p&&{sessionProperties:p}),d&&{scopedProperties:d}),u&&{sessionConfig:u}),A=ae.relay;w.addTrace(tt.subscribing_session_topic);try{yield this.client.core.relayer.subscribe(R,{transportType:A})}catch(E){throw w.setError(Yt.subscribe_session_topic_failure),E}w.addTrace(tt.subscribe_session_topic_success);let k=qe(ie({},P),{topic:R,requiredNamespaces:g,optionalNamespaces:v,pairingTopic:f,acknowledged:!1,self:P.controller,peer:{publicKey:m.publicKey,metadata:m.metadata},controller:b,transportType:ae.relay});yield this.client.session.set(R,k),w.addTrace(tt.store_session);try{w.addTrace(tt.publishing_session_settle),yield this.sendRequest({topic:R,method:"wc_sessionSettle",params:P,throwOnFailedPublish:!0}).catch(E=>{throw w?.setError(Yt.session_settle_publish_failure),E}),w.addTrace(tt.session_settle_publish_success),w.addTrace(tt.publishing_session_approve),yield this.sendResult({id:a,topic:f,result:{relay:{protocol:c??"irn"},responderPublicKey:b},throwOnFailedPublish:!0}).catch(E=>{throw w?.setError(Yt.session_approve_publish_failure),E}),w.addTrace(tt.session_approve_publish_success)}catch(E){throw this.client.logger.error(E),this.client.session.delete(R,ee("USER_DISCONNECTED")),yield this.client.core.relayer.unsubscribe(R),E}return this.client.core.eventClient.deleteEvent({eventId:w.eventId}),yield this.client.core.pairing.updateMetadata({topic:f,metadata:m.metadata}),yield this.client.proposal.delete(a,ee("USER_DISCONNECTED")),yield this.client.core.pairing.activate({topic:f}),yield this.setExpiry(R,de($s)),{topic:R,acknowledged:()=>Promise.resolve(this.client.session.get(R))}})),I(this,"reject",t=>l(this,null,function*(){this.isInitialized(),yield this.confirmOnlineStateOrThrow();try{yield this.isValidReject(t)}catch(o){throw this.client.logger.error("reject() -> isValidReject() failed"),o}let{id:i,reason:r}=t,n;try{n=this.client.proposal.get(i).pairingTopic}catch(o){throw this.client.logger.error(`reject() -> proposal.get(${i}) failed`),o}n&&(yield this.sendError({id:i,topic:n,error:r,rpcOpts:Pe.wc_sessionPropose.reject}),yield this.client.proposal.delete(i,ee("USER_DISCONNECTED")))})),I(this,"update",t=>l(this,null,function*(){this.isInitialized(),yield this.confirmOnlineStateOrThrow();try{yield this.isValidUpdate(t)}catch(d){throw this.client.logger.error("update() -> isValidUpdate() failed"),d}let{topic:i,namespaces:r}=t,{done:n,resolve:o,reject:a}=Dt(),c=St(),h=$t().toString(),p=this.client.session.get(i).namespaces;return this.events.once(X("session_update",c),({error:d})=>{d?a(d):o()}),yield this.client.session.update(i,{namespaces:r}),yield this.sendRequest({topic:i,method:"wc_sessionUpdate",params:{namespaces:r},throwOnFailedPublish:!0,clientRpcId:c,relayRpcId:h}).catch(d=>{this.client.logger.error(d),this.client.session.update(i,{namespaces:p}),a(d)}),{acknowledged:n}})),I(this,"extend",t=>l(this,null,function*(){this.isInitialized(),yield this.confirmOnlineStateOrThrow();try{yield this.isValidExtend(t)}catch(c){throw this.client.logger.error("extend() -> isValidExtend() failed"),c}let{topic:i}=t,r=St(),{done:n,resolve:o,reject:a}=Dt();return this.events.once(X("session_extend",r),({error:c})=>{c?a(c):o()}),yield this.setExpiry(i,de($s)),this.sendRequest({topic:i,method:"wc_sessionExtend",params:{},clientRpcId:r,throwOnFailedPublish:!0}).catch(c=>{a(c)}),{acknowledged:n}})),I(this,"request",t=>l(this,null,function*(){this.isInitialized();try{yield this.isValidRequest(t)}catch(v){throw this.client.logger.error("request() -> isValidRequest() failed"),v}let{chainId:i,request:r,topic:n,expiry:o=Pe.wc_sessionRequest.req.ttl}=t,a=this.client.session.get(n);a?.transportType===ae.relay&&(yield this.confirmOnlineStateOrThrow());let c=St(),h=$t().toString(),{done:p,resolve:d,reject:u}=Dt(o,"Request expired. Please try again.");this.events.once(X("session_request",c),({error:v,result:w})=>{v?u(v):d(w)});let y="wc_sessionRequest",f=this.getAppLinkIfEnabled(a.peer.metadata,a.transportType);if(f)return yield this.sendRequest({clientRpcId:c,relayRpcId:h,topic:n,method:y,params:{request:qe(ie({},r),{expiryTimestamp:de(o)}),chainId:i},expiry:o,throwOnFailedPublish:!0,appLink:f}).catch(v=>u(v)),this.client.events.emit("session_request_sent",{topic:n,request:r,chainId:i,id:c}),yield p();let m={request:qe(ie({},r),{expiryTimestamp:de(o)}),chainId:i},g=this.shouldSetTVF(y,m);return yield Promise.all([new Promise(v=>l(this,null,function*(){yield this.sendRequest(ie({clientRpcId:c,relayRpcId:h,topic:n,method:y,params:m,expiry:o,throwOnFailedPublish:!0},g&&{tvf:this.getTVFParams(c,m)})).catch(w=>u(w)),this.client.events.emit("session_request_sent",{topic:n,request:r,chainId:i,id:c}),v()})),new Promise(v=>l(this,null,function*(){var w;if(!((w=a.sessionConfig)!=null&&w.disableDeepLink)){let b=yield Ac(this.client.core.storage,wl);yield Sc({id:c,topic:n,wcDeepLink:b})}v()})),p()]).then(v=>v[2])})),I(this,"respond",t=>l(this,null,function*(){this.isInitialized(),yield this.isValidRespond(t);let{topic:i,response:r}=t,{id:n}=r,o=this.client.session.get(i);o.transportType===ae.relay&&(yield this.confirmOnlineStateOrThrow());let a=this.getAppLinkIfEnabled(o.peer.metadata,o.transportType);rt(r)?yield this.sendResult({id:n,topic:i,result:r.result,throwOnFailedPublish:!0,appLink:a}):Ze(r)&&(yield this.sendError({id:n,topic:i,error:r.error,appLink:a})),this.cleanupAfterResponse(t)})),I(this,"ping",t=>l(this,null,function*(){this.isInitialized(),yield this.confirmOnlineStateOrThrow();try{yield this.isValidPing(t)}catch(r){throw this.client.logger.error("ping() -> isValidPing() failed"),r}let{topic:i}=t;if(this.client.session.keys.includes(i)){let r=St(),n=$t().toString(),{done:o,resolve:a,reject:c}=Dt();this.events.once(X("session_ping",r),({error:h})=>{h?c(h):a()}),yield Promise.all([this.sendRequest({topic:i,method:"wc_sessionPing",params:{},throwOnFailedPublish:!0,clientRpcId:r,relayRpcId:n}),o()])}else this.client.core.pairing.pairings.keys.includes(i)&&(this.client.logger.warn("ping() on pairing topic is deprecated and will be removed in the next major release."),yield this.client.core.pairing.ping({topic:i}))})),I(this,"emit",t=>l(this,null,function*(){this.isInitialized(),yield this.confirmOnlineStateOrThrow(),yield this.isValidEmit(t);let{topic:i,event:r,chainId:n}=t,o=$t().toString(),a=St();yield this.sendRequest({topic:i,method:"wc_sessionEvent",params:{event:r,chainId:n},throwOnFailedPublish:!0,relayRpcId:o,clientRpcId:a})})),I(this,"disconnect",t=>l(this,null,function*(){this.isInitialized(),yield this.confirmOnlineStateOrThrow(),yield this.isValidDisconnect(t);let{topic:i}=t;if(this.client.session.keys.includes(i))yield this.sendRequest({topic:i,method:"wc_sessionDelete",params:ee("USER_DISCONNECTED"),throwOnFailedPublish:!0}),yield this.deleteSession({topic:i,emitEvent:!1});else if(this.client.core.pairing.pairings.keys.includes(i))yield this.client.core.pairing.disconnect({topic:i});else{let{message:r}=x("MISMATCHED_TOPIC",`Session or pairing topic not found: ${i}`);throw new Error(r)}})),I(this,"find",t=>(this.isInitialized(),this.client.session.getAll().filter(i=>fh(i,t)))),I(this,"getPendingSessionRequests",()=>this.client.pendingRequest.getAll()),I(this,"authenticate",(t,i)=>l(this,null,function*(){var r;this.isInitialized(),this.isValidAuthenticate(t);let n=i&&this.client.core.linkModeSupportedApps.includes(i)&&((r=this.client.metadata.redirect)==null?void 0:r.linkMode),o=n?ae.link_mode:ae.relay;o===ae.relay&&(yield this.confirmOnlineStateOrThrow());let{chains:a,statement:c="",uri:h,domain:p,nonce:d,type:u,exp:y,nbf:f,methods:m=[],expiry:g}=t,v=[...t.resources||[]],{topic:w,uri:b}=yield this.client.core.pairing.create({methods:["wc_sessionAuthenticate"],transportType:o});this.client.logger.info({message:"Generated new pairing",pairing:{topic:w,uri:b}});let _=yield this.client.core.crypto.generateKeyPair(),R=xs(_);if(yield Promise.all([this.client.auth.authKeys.set(Ir,{responseTopic:R,publicKey:_}),this.client.auth.pairingTopics.set(R,{topic:R,pairingTopic:w})]),yield this.client.core.relayer.subscribe(R,{transportType:o}),this.client.logger.info(`sending request to new pairing topic: ${w}`),m.length>0){let{namespace:S}=Wt(a[0]),M=Fc(S,"request",m);bi(v)&&(M=jc(M,v.pop())),v.push(M)}let P=g&&g>Pe.wc_sessionAuthenticate.req.ttl?g:Pe.wc_sessionAuthenticate.req.ttl,A={authPayload:{type:u??"caip122",chains:a,statement:c,aud:h,domain:p,version:"1",nonce:d,iat:new Date().toISOString(),exp:y,nbf:f,resources:v},requester:{publicKey:_,metadata:this.client.metadata},expiryTimestamp:de(P)},k={eip155:{chains:a,methods:[...new Set(["personal_sign",...m])],events:["chainChanged","accountsChanged"]}},E={requiredNamespaces:{},optionalNamespaces:k,relays:[{protocol:"irn"}],pairingTopic:w,proposer:{publicKey:_,metadata:this.client.metadata},expiryTimestamp:de(Pe.wc_sessionPropose.req.ttl),id:St()},{done:$,resolve:D,reject:q}=Dt(P,"Request expired"),V=St(),C=X("session_connect",E.id),T=X("session_request",V),N=H=>l(this,[H],function*({error:S,session:M}){this.events.off(T,U),S?q(S):M&&D({session:M})}),U=S=>l(this,null,function*(){var M,H,z;if(yield this.deletePendingAuthRequest(V,{message:"fulfilled",code:0}),S.error){let me=ee("WC_METHOD_UNSUPPORTED","wc_sessionAuthenticate");return S.error.code===me.code?void 0:(this.events.off(C,N),q(S.error.message))}yield this.deleteProposal(E.id),this.events.off(C,N);let{cacaos:re,responder:te}=S.result,ue=[],be=[];for(let me of re){(yield Pn({cacao:me,projectId:this.client.core.projectId}))||(this.client.logger.error(me,"Signature verification failed"),q(ee("SESSION_SETTLEMENT_FAILED","Signature verification failed")));let{p:Xt}=me,_t=bi(Xt.resources),pt=[hr(Xt.iss)],Pt=vi(Xt.iss);if(_t){let ds=An(_t),ki=Nn(_t);ue.push(...ds),pt.push(...ki)}for(let ds of pt)be.push(`${ds}:${Pt}`)}let Re=yield this.client.core.crypto.generateSharedKey(_,te.publicKey),fe;ue.length>0&&(fe={topic:Re,acknowledged:!0,self:{publicKey:_,metadata:this.client.metadata},peer:te,controller:te.publicKey,expiry:de($s),requiredNamespaces:{},optionalNamespaces:{},relay:{protocol:"irn"},pairingTopic:w,namespaces:qn([...new Set(ue)],[...new Set(be)]),transportType:o},yield this.client.core.relayer.subscribe(Re,{transportType:o}),yield this.client.session.set(Re,fe),w&&(yield this.client.core.pairing.updateMetadata({topic:w,metadata:te.metadata})),fe=this.client.session.get(Re)),(M=this.client.metadata.redirect)!=null&&M.linkMode&&(H=te.metadata.redirect)!=null&&H.linkMode&&(z=te.metadata.redirect)!=null&&z.universal&&i&&(this.client.core.addLinkModeSupportedApp(te.metadata.redirect.universal),this.client.session.update(Re,{transportType:ae.link_mode})),D({auths:re,session:fe})});this.events.once(C,N),this.events.once(T,U);let L;try{if(n){let S=ut("wc_sessionAuthenticate",A,V);this.client.core.history.set(w,S);let M=yield this.client.core.crypto.encode("",S,{type:Rs,encoding:qt});L=Pi(i,w,M)}else yield Promise.all([this.sendRequest({topic:w,method:"wc_sessionAuthenticate",params:A,expiry:t.expiry,throwOnFailedPublish:!0,clientRpcId:V}),this.sendRequest({topic:w,method:"wc_sessionPropose",params:E,expiry:Pe.wc_sessionPropose.req.ttl,throwOnFailedPublish:!0,clientRpcId:E.id})])}catch(S){throw this.events.off(C,N),this.events.off(T,U),S}return yield this.setProposal(E.id,E),yield this.setAuthRequest(V,{request:qe(ie({},A),{verifyContext:{}}),pairingTopic:w,transportType:o}),{uri:L??b,response:$}})),I(this,"approveSessionAuthenticate",t=>l(this,null,function*(){let{id:i,auths:r}=t,n=this.client.core.eventClient.createEvent({properties:{topic:i.toString(),trace:[Jt.authenticated_session_approve_started]}});try{this.isInitialized()}catch(g){throw n.setError(js.no_internet_connection),g}let o=this.getPendingAuthRequest(i);if(!o)throw n.setError(js.authenticated_session_pending_request_not_found),new Error(`Could not find pending auth request with id ${i}`);let a=o.transportType||ae.relay;a===ae.relay&&(yield this.confirmOnlineStateOrThrow());let c=o.requester.publicKey,h=yield this.client.core.crypto.generateKeyPair(),p=xs(c),d={type:at,receiverPublicKey:c,senderPublicKey:h},u=[],y=[];for(let g of r){if(!(yield Pn({cacao:g,projectId:this.client.core.projectId}))){n.setError(js.invalid_cacao);let R=ee("SESSION_SETTLEMENT_FAILED","Signature verification failed");throw yield this.sendError({id:i,topic:p,error:R,encodeOpts:d}),new Error(R.message)}n.addTrace(Jt.cacaos_verified);let{p:v}=g,w=bi(v.resources),b=[hr(v.iss)],_=vi(v.iss);if(w){let R=An(w),P=Nn(w);u.push(...R),b.push(...P)}for(let R of b)y.push(`${R}:${_}`)}let f=yield this.client.core.crypto.generateSharedKey(h,c);n.addTrace(Jt.create_authenticated_session_topic);let m;if(u?.length>0){m={topic:f,acknowledged:!0,self:{publicKey:h,metadata:this.client.metadata},peer:{publicKey:c,metadata:o.requester.metadata},controller:c,expiry:de($s),authentication:r,requiredNamespaces:{},optionalNamespaces:{},relay:{protocol:"irn"},pairingTopic:o.pairingTopic,namespaces:qn([...new Set(u)],[...new Set(y)]),transportType:a},n.addTrace(Jt.subscribing_authenticated_session_topic);try{yield this.client.core.relayer.subscribe(f,{transportType:a})}catch(g){throw n.setError(js.subscribe_authenticated_session_topic_failure),g}n.addTrace(Jt.subscribe_authenticated_session_topic_success),yield this.client.session.set(f,m),n.addTrace(Jt.store_authenticated_session),yield this.client.core.pairing.updateMetadata({topic:o.pairingTopic,metadata:o.requester.metadata})}n.addTrace(Jt.publishing_authenticated_session_approve);try{yield this.sendResult({topic:p,id:i,result:{cacaos:r,responder:{publicKey:h,metadata:this.client.metadata}},encodeOpts:d,throwOnFailedPublish:!0,appLink:this.getAppLinkIfEnabled(o.requester.metadata,a)})}catch(g){throw n.setError(js.authenticated_session_approve_publish_failure),g}return yield this.client.auth.requests.delete(i,{message:"fulfilled",code:0}),yield this.client.core.pairing.activate({topic:o.pairingTopic}),this.client.core.eventClient.deleteEvent({eventId:n.eventId}),{session:m}})),I(this,"rejectSessionAuthenticate",t=>l(this,null,function*(){this.isInitialized();let{id:i,reason:r}=t,n=this.getPendingAuthRequest(i);if(!n)throw new Error(`Could not find pending auth request with id ${i}`);n.transportType===ae.relay&&(yield this.confirmOnlineStateOrThrow());let o=n.requester.publicKey,a=yield this.client.core.crypto.generateKeyPair(),c=xs(o),h={type:at,receiverPublicKey:o,senderPublicKey:a};yield this.sendError({id:i,topic:c,error:r,encodeOpts:h,rpcOpts:Pe.wc_sessionAuthenticate.reject,appLink:this.getAppLinkIfEnabled(n.requester.metadata,n.transportType)}),yield this.client.auth.requests.delete(i,{message:"rejected",code:0}),yield this.client.proposal.delete(i,ee("USER_DISCONNECTED"))})),I(this,"formatAuthMessage",t=>{this.isInitialized();let{request:i,iss:r}=t;return Sn(i,r)}),I(this,"processRelayMessageCache",()=>{setTimeout(()=>l(this,null,function*(){if(this.relayMessageCache.length!==0)for(;this.relayMessageCache.length>0;)try{let t=this.relayMessageCache.shift();t&&(yield this.onRelayMessage(t))}catch(t){this.client.logger.error(t)}}),50)}),I(this,"cleanupDuplicatePairings",t=>l(this,null,function*(){if(t.pairingTopic)try{let i=this.client.core.pairing.pairings.get(t.pairingTopic),r=this.client.core.pairing.pairings.getAll().filter(n=>{var o,a;return((o=n.peerMetadata)==null?void 0:o.url)&&((a=n.peerMetadata)==null?void 0:a.url)===t.peer.metadata.url&&n.topic&&n.topic!==i.topic});if(r.length===0)return;this.client.logger.info(`Cleaning up ${r.length} duplicate pairing(s)`),yield Promise.all(r.map(n=>this.client.core.pairing.disconnect({topic:n.topic}))),this.client.logger.info("Duplicate pairings clean up finished")}catch(i){this.client.logger.error(i)}})),I(this,"deleteSession",t=>l(this,null,function*(){var i;let{topic:r,expirerHasDeleted:n=!1,emitEvent:o=!0,id:a=0}=t,{self:c}=this.client.session.get(r);yield this.client.core.relayer.unsubscribe(r),yield this.client.session.delete(r,ee("USER_DISCONNECTED")),this.addToRecentlyDeleted(r,"session"),this.client.core.crypto.keychain.has(c.publicKey)&&(yield this.client.core.crypto.deleteKeyPair(c.publicKey)),this.client.core.crypto.keychain.has(r)&&(yield this.client.core.crypto.deleteSymKey(r)),n||this.client.core.expirer.del(r),this.client.core.storage.removeItem(wl).catch(h=>this.client.logger.warn(h)),this.getPendingSessionRequests().forEach(h=>{h.topic===r&&this.deletePendingSessionRequest(h.id,ee("USER_DISCONNECTED"))}),r===((i=this.sessionRequestQueue.queue[0])==null?void 0:i.topic)&&(this.sessionRequestQueue.state=Ct.idle),o&&this.client.events.emit("session_delete",{id:a,topic:r})})),I(this,"deleteProposal",(t,i)=>l(this,null,function*(){if(i)try{let r=this.client.proposal.get(t);this.client.core.eventClient.getEvent({topic:r.pairingTopic})?.setError(Yt.proposal_expired)}catch{}yield Promise.all([this.client.proposal.delete(t,ee("USER_DISCONNECTED")),i?Promise.resolve():this.client.core.expirer.del(t)]),this.addToRecentlyDeleted(t,"proposal")})),I(this,"deletePendingSessionRequest",(t,i,r=!1)=>l(this,null,function*(){yield Promise.all([this.client.pendingRequest.delete(t,i),r?Promise.resolve():this.client.core.expirer.del(t)]),this.addToRecentlyDeleted(t,"request"),this.sessionRequestQueue.queue=this.sessionRequestQueue.queue.filter(n=>n.id!==t),r&&(this.sessionRequestQueue.state=Ct.idle,this.client.events.emit("session_request_expire",{id:t}))})),I(this,"deletePendingAuthRequest",(t,i,r=!1)=>l(this,null,function*(){yield Promise.all([this.client.auth.requests.delete(t,i),r?Promise.resolve():this.client.core.expirer.del(t)])})),I(this,"setExpiry",(t,i)=>l(this,null,function*(){this.client.session.keys.includes(t)&&(this.client.core.expirer.set(t,i),yield this.client.session.update(t,{expiry:i}))})),I(this,"setProposal",(t,i)=>l(this,null,function*(){this.client.core.expirer.set(t,de(Pe.wc_sessionPropose.req.ttl)),yield this.client.proposal.set(t,i)})),I(this,"setAuthRequest",(t,i)=>l(this,null,function*(){let{request:r,pairingTopic:n,transportType:o=ae.relay}=i;this.client.core.expirer.set(t,r.expiryTimestamp),yield this.client.auth.requests.set(t,{authPayload:r.authPayload,requester:r.requester,expiryTimestamp:r.expiryTimestamp,id:t,pairingTopic:n,verifyContext:r.verifyContext,transportType:o})})),I(this,"setPendingSessionRequest",t=>l(this,null,function*(){let{id:i,topic:r,params:n,verifyContext:o}=t,a=n.request.expiryTimestamp||de(Pe.wc_sessionRequest.req.ttl);this.client.core.expirer.set(i,a),yield this.client.pendingRequest.set(i,{id:i,topic:r,params:n,verifyContext:o})})),I(this,"sendRequest",t=>l(this,null,function*(){let{topic:i,method:r,params:n,expiry:o,relayRpcId:a,clientRpcId:c,throwOnFailedPublish:h,appLink:p,tvf:d}=t,u=ut(r,n,c),y,f=!!p;try{let v=f?qt:We;y=yield this.client.core.crypto.encode(i,u,{encoding:v})}catch(v){throw yield this.cleanup(),this.client.logger.error(`sendRequest() -> core.crypto.encode() for topic ${i} failed`),v}let m;if(My.includes(r)){let v=Qe(JSON.stringify(u)),w=Qe(y);m=yield this.client.core.verify.register({id:w,decryptedId:v})}let g=Pe[r].req;if(g.attestation=m,o&&(g.ttl=o),a&&(g.id=a),this.client.core.history.set(i,u),f){let v=Pi(p,i,y);yield global.Linking.openURL(v,this.client.name)}else{let v=Pe[r].req;o&&(v.ttl=o),a&&(v.id=a),v.tvf=qe(ie({},d),{correlationId:u.id}),h?(v.internal=qe(ie({},v.internal),{throwOnFailedPublish:!0}),yield this.client.core.relayer.publish(i,y,v)):this.client.core.relayer.publish(i,y,v).catch(w=>this.client.logger.error(w))}return u.id})),I(this,"sendResult",t=>l(this,null,function*(){let{id:i,topic:r,result:n,throwOnFailedPublish:o,encodeOpts:a,appLink:c}=t,h=es(i,n),p,d=c&&typeof(global==null?void 0:global.Linking)<"u";try{let f=d?qt:We;p=yield this.client.core.crypto.encode(r,h,qe(ie({},a||{}),{encoding:f}))}catch(f){throw yield this.cleanup(),this.client.logger.error(`sendResult() -> core.crypto.encode() for topic ${r} failed`),f}let u,y;try{u=yield this.client.core.history.get(r,i);let f=u.request;try{this.shouldSetTVF(f.method,f.params)&&(y=this.getTVFParams(i,f.params,n))}catch(m){this.client.logger.warn("sendResult() -> getTVFParams() failed",m)}}catch(f){throw this.client.logger.error(`sendResult() -> history.get(${r}, ${i}) failed`),f}if(d){let f=Pi(c,r,p);yield global.Linking.openURL(f,this.client.name)}else{let f=u.request.method,m=Pe[f].res;m.tvf=qe(ie({},y),{correlationId:i}),o?(m.internal=qe(ie({},m.internal),{throwOnFailedPublish:!0}),yield this.client.core.relayer.publish(r,p,m)):this.client.core.relayer.publish(r,p,m).catch(g=>this.client.logger.error(g))}yield this.client.core.history.resolve(h)})),I(this,"sendError",t=>l(this,null,function*(){let{id:i,topic:r,error:n,encodeOpts:o,rpcOpts:a,appLink:c}=t,h=Di(i,n),p,d=c&&typeof(global==null?void 0:global.Linking)<"u";try{let y=d?qt:We;p=yield this.client.core.crypto.encode(r,h,qe(ie({},o||{}),{encoding:y}))}catch(y){throw yield this.cleanup(),this.client.logger.error(`sendError() -> core.crypto.encode() for topic ${r} failed`),y}let u;try{u=yield this.client.core.history.get(r,i)}catch(y){throw this.client.logger.error(`sendError() -> history.get(${r}, ${i}) failed`),y}if(d){let y=Pi(c,r,p);yield global.Linking.openURL(y,this.client.name)}else{let y=u.request.method,f=a||Pe[y].res;this.client.core.relayer.publish(r,p,f)}yield this.client.core.history.resolve(h)})),I(this,"cleanup",()=>l(this,null,function*(){let t=[],i=[];this.client.session.getAll().forEach(r=>{let n=!1;yt(r.expiry)&&(n=!0),this.client.core.crypto.keychain.has(r.topic)||(n=!0),n&&t.push(r.topic)}),this.client.proposal.getAll().forEach(r=>{yt(r.expiryTimestamp)&&i.push(r.id)}),yield Promise.all([...t.map(r=>this.deleteSession({topic:r})),...i.map(r=>this.deleteProposal(r))])})),I(this,"onProviderMessageEvent",t=>l(this,null,function*(){!this.initialized||this.relayMessageCache.length>0?this.relayMessageCache.push(t):yield this.onRelayMessage(t)})),I(this,"onRelayEventRequest",t=>l(this,null,function*(){this.requestQueue.queue.push(t),yield this.processRequestsQueue()})),I(this,"processRequestsQueue",()=>l(this,null,function*(){if(this.requestQueue.state===Ct.active){this.client.logger.info("Request queue already active, skipping...");return}for(this.client.logger.info(`Request queue starting with ${this.requestQueue.queue.length} requests`);this.requestQueue.queue.length>0;){this.requestQueue.state=Ct.active;let t=this.requestQueue.queue.shift();if(t)try{yield this.processRequest(t)}catch(i){this.client.logger.warn(i)}}this.requestQueue.state=Ct.idle})),I(this,"processRequest",t=>l(this,null,function*(){let{topic:i,payload:r,attestation:n,transportType:o,encryptedId:a}=t,c=r.method;if(!this.shouldIgnorePairingRequest({topic:i,requestMethod:c}))switch(c){case"wc_sessionPropose":return yield this.onSessionProposeRequest({topic:i,payload:r,attestation:n,encryptedId:a});case"wc_sessionSettle":return yield this.onSessionSettleRequest(i,r);case"wc_sessionUpdate":return yield this.onSessionUpdateRequest(i,r);case"wc_sessionExtend":return yield this.onSessionExtendRequest(i,r);case"wc_sessionPing":return yield this.onSessionPingRequest(i,r);case"wc_sessionDelete":return yield this.onSessionDeleteRequest(i,r);case"wc_sessionRequest":return yield this.onSessionRequest({topic:i,payload:r,attestation:n,encryptedId:a,transportType:o});case"wc_sessionEvent":return yield this.onSessionEventRequest(i,r);case"wc_sessionAuthenticate":return yield this.onSessionAuthenticateRequest({topic:i,payload:r,attestation:n,encryptedId:a,transportType:o});default:return this.client.logger.info(`Unsupported request method ${c}`)}})),I(this,"onRelayEventResponse",t=>l(this,null,function*(){let{topic:i,payload:r,transportType:n}=t,o=(yield this.client.core.history.get(i,r.id)).request.method;switch(o){case"wc_sessionPropose":return this.onSessionProposeResponse(i,r,n);case"wc_sessionSettle":return this.onSessionSettleResponse(i,r);case"wc_sessionUpdate":return this.onSessionUpdateResponse(i,r);case"wc_sessionExtend":return this.onSessionExtendResponse(i,r);case"wc_sessionPing":return this.onSessionPingResponse(i,r);case"wc_sessionRequest":return this.onSessionRequestResponse(i,r);case"wc_sessionAuthenticate":return this.onSessionAuthenticateResponse(i,r);default:return this.client.logger.info(`Unsupported response method ${o}`)}})),I(this,"onRelayEventUnknownPayload",t=>{let{topic:i}=t,{message:r}=x("MISSING_OR_INVALID",`Decoded payload on topic ${i} is not identifiable as a JSON-RPC request or a response.`);throw new Error(r)}),I(this,"shouldIgnorePairingRequest",t=>{let{topic:i,requestMethod:r}=t,n=this.expectedPairingMethodMap.get(i);return!n||n.includes(r)?!1:!!(n.includes("wc_sessionAuthenticate")&&this.client.events.listenerCount("session_authenticate")>0)}),I(this,"onSessionProposeRequest",t=>l(this,null,function*(){let{topic:i,payload:r,attestation:n,encryptedId:o}=t,{params:a,id:c}=r;try{let h=this.client.core.eventClient.getEvent({topic:i});this.client.events.listenerCount("session_proposal")===0&&(console.warn("No listener for session_proposal event"),h?.setError(bt.proposal_listener_not_found)),this.isValidConnect(ie({},r.params));let p=a.expiryTimestamp||de(Pe.wc_sessionPropose.req.ttl),d=ie({id:c,pairingTopic:i,expiryTimestamp:p},a);yield this.setProposal(c,d);let u=yield this.getVerifyContext({attestationId:n,hash:Qe(JSON.stringify(r)),encryptedId:o,metadata:d.proposer.metadata});h?.addTrace(lt.emit_session_proposal),this.client.events.emit("session_proposal",{id:c,params:d,verifyContext:u})}catch(h){yield this.sendError({id:c,topic:i,error:h,rpcOpts:Pe.wc_sessionPropose.autoReject}),this.client.logger.error(h)}})),I(this,"onSessionProposeResponse",(t,i,r)=>l(this,null,function*(){let{id:n}=i;if(rt(i)){let{result:o}=i;this.client.logger.trace({type:"method",method:"onSessionProposeResponse",result:o});let a=this.client.proposal.get(n);this.client.logger.trace({type:"method",method:"onSessionProposeResponse",proposal:a});let c=a.proposer.publicKey;this.client.logger.trace({type:"method",method:"onSessionProposeResponse",selfPublicKey:c});let h=o.responderPublicKey;this.client.logger.trace({type:"method",method:"onSessionProposeResponse",peerPublicKey:h});let p=yield this.client.core.crypto.generateSharedKey(c,h);this.pendingSessions.set(n,{sessionTopic:p,pairingTopic:t,proposalId:n,publicKey:c});let d=yield this.client.core.relayer.subscribe(p,{transportType:r});this.client.logger.trace({type:"method",method:"onSessionProposeResponse",subscriptionId:d}),yield this.client.core.pairing.activate({topic:t})}else if(Ze(i)){yield this.client.proposal.delete(n,ee("USER_DISCONNECTED"));let o=X("session_connect",n);if(this.events.listenerCount(o)===0)throw new Error(`emitting ${o} without any listeners, 954`);this.events.emit(o,{error:i.error})}})),I(this,"onSessionSettleRequest",(t,i)=>l(this,null,function*(){let{id:r,params:n}=i;try{this.isValidSessionSettleRequest(n);let{relay:o,controller:a,expiry:c,namespaces:h,sessionProperties:p,scopedProperties:d,sessionConfig:u}=i.params,y=[...this.pendingSessions.values()].find(g=>g.sessionTopic===t);if(!y)return this.client.logger.error(`Pending session not found for topic ${t}`);let f=this.client.proposal.get(y.proposalId),m=qe(ie(ie(ie({topic:t,relay:o,expiry:c,namespaces:h,acknowledged:!0,pairingTopic:y.pairingTopic,requiredNamespaces:f.requiredNamespaces,optionalNamespaces:f.optionalNamespaces,controller:a.publicKey,self:{publicKey:y.publicKey,metadata:this.client.metadata},peer:{publicKey:a.publicKey,metadata:a.metadata}},p&&{sessionProperties:p}),d&&{scopedProperties:d}),u&&{sessionConfig:u}),{transportType:ae.relay});yield this.client.session.set(m.topic,m),yield this.setExpiry(m.topic,m.expiry),yield this.client.core.pairing.updateMetadata({topic:y.pairingTopic,metadata:m.peer.metadata}),this.client.events.emit("session_connect",{session:m}),this.events.emit(X("session_connect",y.proposalId),{session:m}),this.pendingSessions.delete(y.proposalId),this.deleteProposal(y.proposalId,!1),this.cleanupDuplicatePairings(m),yield this.sendResult({id:i.id,topic:t,result:!0,throwOnFailedPublish:!0})}catch(o){yield this.sendError({id:r,topic:t,error:o}),this.client.logger.error(o)}})),I(this,"onSessionSettleResponse",(t,i)=>l(this,null,function*(){let{id:r}=i;rt(i)?(yield this.client.session.update(t,{acknowledged:!0}),this.events.emit(X("session_approve",r),{})):Ze(i)&&(yield this.client.session.delete(t,ee("USER_DISCONNECTED")),this.events.emit(X("session_approve",r),{error:i.error}))})),I(this,"onSessionUpdateRequest",(t,i)=>l(this,null,function*(){let{params:r,id:n}=i;try{let o=`${t}_session_update`,a=Kt.get(o);if(a&&this.isRequestOutOfSync(a,n)){this.client.logger.warn(`Discarding out of sync request - ${n}`),this.sendError({id:n,topic:t,error:ee("INVALID_UPDATE_REQUEST")});return}this.isValidUpdate(ie({topic:t},r));try{Kt.set(o,n),yield this.client.session.update(t,{namespaces:r.namespaces}),yield this.sendResult({id:n,topic:t,result:!0,throwOnFailedPublish:!0})}catch(c){throw Kt.delete(o),c}this.client.events.emit("session_update",{id:n,topic:t,params:r})}catch(o){yield this.sendError({id:n,topic:t,error:o}),this.client.logger.error(o)}})),I(this,"isRequestOutOfSync",(t,i)=>i.toString().slice(0,-3)<t.toString().slice(0,-3)),I(this,"onSessionUpdateResponse",(t,i)=>{let{id:r}=i,n=X("session_update",r);if(this.events.listenerCount(n)===0)throw new Error(`emitting ${n} without any listeners`);rt(i)?this.events.emit(X("session_update",r),{}):Ze(i)&&this.events.emit(X("session_update",r),{error:i.error})}),I(this,"onSessionExtendRequest",(t,i)=>l(this,null,function*(){let{id:r}=i;try{this.isValidExtend({topic:t}),yield this.setExpiry(t,de($s)),yield this.sendResult({id:r,topic:t,result:!0,throwOnFailedPublish:!0}),this.client.events.emit("session_extend",{id:r,topic:t})}catch(n){yield this.sendError({id:r,topic:t,error:n}),this.client.logger.error(n)}})),I(this,"onSessionExtendResponse",(t,i)=>{let{id:r}=i,n=X("session_extend",r);if(this.events.listenerCount(n)===0)throw new Error(`emitting ${n} without any listeners`);rt(i)?this.events.emit(X("session_extend",r),{}):Ze(i)&&this.events.emit(X("session_extend",r),{error:i.error})}),I(this,"onSessionPingRequest",(t,i)=>l(this,null,function*(){let{id:r}=i;try{this.isValidPing({topic:t}),yield this.sendResult({id:r,topic:t,result:!0,throwOnFailedPublish:!0}),this.client.events.emit("session_ping",{id:r,topic:t})}catch(n){yield this.sendError({id:r,topic:t,error:n}),this.client.logger.error(n)}})),I(this,"onSessionPingResponse",(t,i)=>{let{id:r}=i,n=X("session_ping",r);setTimeout(()=>{if(this.events.listenerCount(n)===0)throw new Error(`emitting ${n} without any listeners 2176`);rt(i)?this.events.emit(X("session_ping",r),{}):Ze(i)&&this.events.emit(X("session_ping",r),{error:i.error})},500)}),I(this,"onSessionDeleteRequest",(t,i)=>l(this,null,function*(){let{id:r}=i;try{this.isValidDisconnect({topic:t,reason:i.params}),Promise.all([new Promise(n=>{this.client.core.relayer.once(ve.publish,()=>l(this,null,function*(){n(yield this.deleteSession({topic:t,id:r}))}))}),this.sendResult({id:r,topic:t,result:!0,throwOnFailedPublish:!0}),this.cleanupPendingSentRequestsForTopic({topic:t,error:ee("USER_DISCONNECTED")})]).catch(n=>this.client.logger.error(n))}catch(n){this.client.logger.error(n)}})),I(this,"onSessionRequest",t=>l(this,null,function*(){var i,r,n;let{topic:o,payload:a,attestation:c,encryptedId:h,transportType:p}=t,{id:d,params:u}=a;try{yield this.isValidRequest(ie({topic:o},u));let y=this.client.session.get(o),f=yield this.getVerifyContext({attestationId:c,hash:Qe(JSON.stringify(ut("wc_sessionRequest",u,d))),encryptedId:h,metadata:y.peer.metadata,transportType:p}),m={id:d,topic:o,params:u,verifyContext:f};yield this.setPendingSessionRequest(m),p===ae.link_mode&&(i=y.peer.metadata.redirect)!=null&&i.universal&&this.client.core.addLinkModeSupportedApp((r=y.peer.metadata.redirect)==null?void 0:r.universal),(n=this.client.signConfig)!=null&&n.disableRequestQueue?this.emitSessionRequest(m):(this.addSessionRequestToSessionRequestQueue(m),this.processSessionRequestQueue())}catch(y){yield this.sendError({id:d,topic:o,error:y}),this.client.logger.error(y)}})),I(this,"onSessionRequestResponse",(t,i)=>{let{id:r}=i,n=X("session_request",r);if(this.events.listenerCount(n)===0)throw new Error(`emitting ${n} without any listeners`);rt(i)?this.events.emit(X("session_request",r),{result:i.result}):Ze(i)&&this.events.emit(X("session_request",r),{error:i.error})}),I(this,"onSessionEventRequest",(t,i)=>l(this,null,function*(){let{id:r,params:n}=i;try{let o=`${t}_session_event_${n.event.name}`,a=Kt.get(o);if(a&&this.isRequestOutOfSync(a,r)){this.client.logger.info(`Discarding out of sync request - ${r}`);return}this.isValidEmit(ie({topic:t},n)),this.client.events.emit("session_event",{id:r,topic:t,params:n}),Kt.set(o,r)}catch(o){yield this.sendError({id:r,topic:t,error:o}),this.client.logger.error(o)}})),I(this,"onSessionAuthenticateResponse",(t,i)=>{let{id:r}=i;this.client.logger.trace({type:"method",method:"onSessionAuthenticateResponse",topic:t,payload:i}),rt(i)?this.events.emit(X("session_request",r),{result:i.result}):Ze(i)&&this.events.emit(X("session_request",r),{error:i.error})}),I(this,"onSessionAuthenticateRequest",t=>l(this,null,function*(){var i;let{topic:r,payload:n,attestation:o,encryptedId:a,transportType:c}=t;try{let{requester:h,authPayload:p,expiryTimestamp:d}=n.params,u=yield this.getVerifyContext({attestationId:o,hash:Qe(JSON.stringify(n)),encryptedId:a,metadata:h.metadata,transportType:c}),y={requester:h,pairingTopic:r,id:n.id,authPayload:p,verifyContext:u,expiryTimestamp:d};yield this.setAuthRequest(n.id,{request:y,pairingTopic:r,transportType:c}),c===ae.link_mode&&(i=h.metadata.redirect)!=null&&i.universal&&this.client.core.addLinkModeSupportedApp(h.metadata.redirect.universal),this.client.events.emit("session_authenticate",{topic:r,params:n.params,id:n.id,verifyContext:u})}catch(h){this.client.logger.error(h);let p=n.params.requester.publicKey,d=yield this.client.core.crypto.generateKeyPair(),u=this.getAppLinkIfEnabled(n.params.requester.metadata,c),y={type:at,receiverPublicKey:p,senderPublicKey:d};yield this.sendError({id:n.id,topic:r,error:h,encodeOpts:y,rpcOpts:Pe.wc_sessionAuthenticate.autoReject,appLink:u})}})),I(this,"addSessionRequestToSessionRequestQueue",t=>{this.sessionRequestQueue.queue.push(t)}),I(this,"cleanupAfterResponse",t=>{this.deletePendingSessionRequest(t.response.id,{message:"fulfilled",code:0}),setTimeout(()=>{this.sessionRequestQueue.state=Ct.idle,this.processSessionRequestQueue()},(0,K.toMiliseconds)(this.requestQueueDelay))}),I(this,"cleanupPendingSentRequestsForTopic",({topic:t,error:i})=>{let r=this.client.core.history.pending;r.length>0&&r.filter(n=>n.topic===t&&n.request.method==="wc_sessionRequest").forEach(n=>{let o=n.request.id,a=X("session_request",o);if(this.events.listenerCount(a)===0)throw new Error(`emitting ${a} without any listeners`);this.events.emit(X("session_request",n.request.id),{error:i})})}),I(this,"processSessionRequestQueue",()=>{if(this.sessionRequestQueue.state===Ct.active){this.client.logger.info("session request queue is already active.");return}let t=this.sessionRequestQueue.queue[0];if(!t){this.client.logger.info("session request queue is empty.");return}try{this.sessionRequestQueue.state=Ct.active,this.emitSessionRequest(t)}catch(i){this.client.logger.error(i)}}),I(this,"emitSessionRequest",t=>{this.client.events.emit("session_request",t)}),I(this,"onPairingCreated",t=>{if(t.methods&&this.expectedPairingMethodMap.set(t.topic,t.methods),t.active)return;let i=this.client.proposal.getAll().find(r=>r.pairingTopic===t.topic);i&&this.onSessionProposeRequest({topic:t.topic,payload:ut("wc_sessionPropose",qe(ie({},i),{requiredNamespaces:i.requiredNamespaces,optionalNamespaces:i.optionalNamespaces,relays:i.relays,proposer:i.proposer,sessionProperties:i.sessionProperties,scopedProperties:i.scopedProperties}),i.id)})}),I(this,"isValidConnect",t=>l(this,null,function*(){if(!Ue(t)){let{message:h}=x("MISSING_OR_INVALID",`connect() params: ${JSON.stringify(t)}`);throw new Error(h)}let{pairingTopic:i,requiredNamespaces:r,optionalNamespaces:n,sessionProperties:o,scopedProperties:a,relays:c}=t;if(we(i)||(yield this.isValidPairingTopic(i)),!Ih(c,!0)){let{message:h}=x("MISSING_OR_INVALID",`connect() relays: ${c}`);throw new Error(h)}if(!we(r)&&hs(r)!==0&&this.validateNamespaces(r,"requiredNamespaces"),!we(n)&&hs(n)!==0&&this.validateNamespaces(n,"optionalNamespaces"),we(o)||this.validateSessionProps(o,"sessionProperties"),!we(a)){this.validateSessionProps(a,"scopedProperties");let h=Object.keys(r||{}).concat(Object.keys(n||{}));if(!Object.keys(a).every(p=>h.includes(p)))throw new Error(`Scoped properties must be a subset of required/optional namespaces, received: ${JSON.stringify(a)}, required/optional namespaces: ${JSON.stringify(h)}`)}})),I(this,"validateNamespaces",(t,i)=>{let r=Eh(t,"connect()",i);if(r)throw new Error(r.message)}),I(this,"isValidApprove",t=>l(this,null,function*(){if(!Ue(t))throw new Error(x("MISSING_OR_INVALID",`approve() params: ${t}`).message);let{id:i,namespaces:r,relayProtocol:n,sessionProperties:o,scopedProperties:a}=t;this.checkRecentlyDeleted(i),yield this.isValidProposalId(i);let c=this.client.proposal.get(i),h=yr(r,"approve()");if(h)throw new Error(h.message);let p=Bn(c.requiredNamespaces,r,"approve()");if(p)throw new Error(p.message);if(!le(n,!0)){let{message:d}=x("MISSING_OR_INVALID",`approve() relayProtocol: ${n}`);throw new Error(d)}if(we(o)||this.validateSessionProps(o,"sessionProperties"),!we(a)){this.validateSessionProps(a,"scopedProperties");let d=new Set(Object.keys(r));if(!Object.keys(a).every(u=>d.has(u)))throw new Error(`Scoped properties must be a subset of approved namespaces, received: ${JSON.stringify(a)}, approved namespaces: ${Array.from(d).join(", ")}`)}})),I(this,"isValidReject",t=>l(this,null,function*(){if(!Ue(t)){let{message:n}=x("MISSING_OR_INVALID",`reject() params: ${t}`);throw new Error(n)}let{id:i,reason:r}=t;if(this.checkRecentlyDeleted(i),yield this.isValidProposalId(i),!_h(r)){let{message:n}=x("MISSING_OR_INVALID",`reject() reason: ${JSON.stringify(r)}`);throw new Error(n)}})),I(this,"isValidSessionSettleRequest",t=>{if(!Ue(t)){let{message:h}=x("MISSING_OR_INVALID",`onSessionSettleRequest() params: ${t}`);throw new Error(h)}let{relay:i,controller:r,namespaces:n,expiry:o}=t;if(!jn(i)){let{message:h}=x("MISSING_OR_INVALID","onSessionSettleRequest() relay protocol should be a string");throw new Error(h)}let a=vh(r,"onSessionSettleRequest()");if(a)throw new Error(a.message);let c=yr(n,"onSessionSettleRequest()");if(c)throw new Error(c.message);if(yt(o)){let{message:h}=x("EXPIRED","onSessionSettleRequest()");throw new Error(h)}}),I(this,"isValidUpdate",t=>l(this,null,function*(){if(!Ue(t)){let{message:c}=x("MISSING_OR_INVALID",`update() params: ${t}`);throw new Error(c)}let{topic:i,namespaces:r}=t;this.checkRecentlyDeleted(i),yield this.isValidSessionTopic(i);let n=this.client.session.get(i),o=yr(r,"update()");if(o)throw new Error(o.message);let a=Bn(n.requiredNamespaces,r,"update()");if(a)throw new Error(a.message)})),I(this,"isValidExtend",t=>l(this,null,function*(){if(!Ue(t)){let{message:r}=x("MISSING_OR_INVALID",`extend() params: ${t}`);throw new Error(r)}let{topic:i}=t;this.checkRecentlyDeleted(i),yield this.isValidSessionTopic(i)})),I(this,"isValidRequest",t=>l(this,null,function*(){if(!Ue(t)){let{message:c}=x("MISSING_OR_INVALID",`request() params: ${t}`);throw new Error(c)}let{topic:i,request:r,chainId:n,expiry:o}=t;this.checkRecentlyDeleted(i),yield this.isValidSessionTopic(i);let{namespaces:a}=this.client.session.get(i);if(!$n(a,n)){let{message:c}=x("MISSING_OR_INVALID",`request() chainId: ${n}`);throw new Error(c)}if(!Ph(r)){let{message:c}=x("MISSING_OR_INVALID",`request() ${JSON.stringify(r)}`);throw new Error(c)}if(!Nh(a,n,r.method)){let{message:c}=x("MISSING_OR_INVALID",`request() method: ${r.method}`);throw new Error(c)}if(o&&!Oh(o,So)){let{message:c}=x("MISSING_OR_INVALID",`request() expiry: ${o}. Expiry must be a number (in seconds) between ${So.min} and ${So.max}`);throw new Error(c)}})),I(this,"isValidRespond",t=>l(this,null,function*(){var i;if(!Ue(t)){let{message:o}=x("MISSING_OR_INVALID",`respond() params: ${t}`);throw new Error(o)}let{topic:r,response:n}=t;try{yield this.isValidSessionTopic(r)}catch(o){throw(i=t?.response)!=null&&i.id&&this.cleanupAfterResponse(t),o}if(!Sh(n)){let{message:o}=x("MISSING_OR_INVALID",`respond() response: ${JSON.stringify(n)}`);throw new Error(o)}})),I(this,"isValidPing",t=>l(this,null,function*(){if(!Ue(t)){let{message:r}=x("MISSING_OR_INVALID",`ping() params: ${t}`);throw new Error(r)}let{topic:i}=t;yield this.isValidSessionOrPairingTopic(i)})),I(this,"isValidEmit",t=>l(this,null,function*(){if(!Ue(t)){let{message:a}=x("MISSING_OR_INVALID",`emit() params: ${t}`);throw new Error(a)}let{topic:i,event:r,chainId:n}=t;yield this.isValidSessionTopic(i);let{namespaces:o}=this.client.session.get(i);if(!$n(o,n)){let{message:a}=x("MISSING_OR_INVALID",`emit() chainId: ${n}`);throw new Error(a)}if(!Ah(r)){let{message:a}=x("MISSING_OR_INVALID",`emit() event: ${JSON.stringify(r)}`);throw new Error(a)}if(!Th(o,n,r.name)){let{message:a}=x("MISSING_OR_INVALID",`emit() event: ${JSON.stringify(r)}`);throw new Error(a)}})),I(this,"isValidDisconnect",t=>l(this,null,function*(){if(!Ue(t)){let{message:r}=x("MISSING_OR_INVALID",`disconnect() params: ${t}`);throw new Error(r)}let{topic:i}=t;yield this.isValidSessionOrPairingTopic(i)})),I(this,"isValidAuthenticate",t=>{let{chains:i,uri:r,domain:n,nonce:o}=t;if(!Array.isArray(i)||i.length===0)throw new Error("chains is required and must be a non-empty array");if(!le(r,!1))throw new Error("uri is required parameter");if(!le(n,!1))throw new Error("domain is required parameter");if(!le(o,!1))throw new Error("nonce is required parameter");if([...new Set(i.map(c=>Wt(c).namespace))].length>1)throw new Error("Multi-namespace requests are not supported. Please request single namespace only.");let{namespace:a}=Wt(i[0]);if(a!=="eip155")throw new Error("Only eip155 namespace is supported for authenticated sessions. Please use .connect() for non-eip155 chains.")}),I(this,"getVerifyContext",t=>l(this,null,function*(){let{attestationId:i,hash:r,encryptedId:n,metadata:o,transportType:a}=t,c={verified:{verifyUrl:o.verifyUrl||Fs,validation:"UNKNOWN",origin:o.url||""}};try{if(a===ae.link_mode){let p=this.getAppLinkIfEnabled(o,a);return c.verified.validation=p&&new URL(p).origin===new URL(o.url).origin?"VALID":"INVALID",c}let h=yield this.client.core.verify.resolve({attestationId:i,hash:r,encryptedId:n,verifyUrl:o.verifyUrl});h&&(c.verified.origin=h.origin,c.verified.isScam=h.isScam,c.verified.validation=h.origin===new URL(o.url).origin?"VALID":"INVALID")}catch(h){this.client.logger.warn(h)}return this.client.logger.debug(`Verify context: ${JSON.stringify(c)}`),c})),I(this,"validateSessionProps",(t,i)=>{Object.values(t).forEach((r,n)=>{if(r==null){let{message:o}=x("MISSING_OR_INVALID",`${i} must contain an existing value for each key. Received: ${r} for key ${Object.keys(t)[n]}`);throw new Error(o)}})}),I(this,"getPendingAuthRequest",t=>{let i=this.client.auth.requests.get(t);return typeof i=="object"?i:void 0}),I(this,"addToRecentlyDeleted",(t,i)=>{if(this.recentlyDeletedMap.set(t,i),this.recentlyDeletedMap.size>=this.recentlyDeletedLimit){let r=0,n=this.recentlyDeletedLimit/2;for(let o of this.recentlyDeletedMap.keys()){if(r++>=n)break;this.recentlyDeletedMap.delete(o)}}}),I(this,"checkRecentlyDeleted",t=>{let i=this.recentlyDeletedMap.get(t);if(i){let{message:r}=x("MISSING_OR_INVALID",`Record was recently deleted - ${i}: ${t}`);throw new Error(r)}}),I(this,"isLinkModeEnabled",(t,i)=>{var r,n,o,a,c,h,p,d,u;return!t||i!==ae.link_mode?!1:((n=(r=this.client.metadata)==null?void 0:r.redirect)==null?void 0:n.linkMode)===!0&&((a=(o=this.client.metadata)==null?void 0:o.redirect)==null?void 0:a.universal)!==void 0&&((h=(c=this.client.metadata)==null?void 0:c.redirect)==null?void 0:h.universal)!==""&&((p=t?.redirect)==null?void 0:p.universal)!==void 0&&((d=t?.redirect)==null?void 0:d.universal)!==""&&((u=t?.redirect)==null?void 0:u.linkMode)===!0&&this.client.core.linkModeSupportedApps.includes(t.redirect.universal)&&typeof(global==null?void 0:global.Linking)<"u"}),I(this,"getAppLinkIfEnabled",(t,i)=>{var r;return this.isLinkModeEnabled(t,i)?(r=t?.redirect)==null?void 0:r.universal:void 0}),I(this,"handleLinkModeMessage",({url:t})=>{if(!t||!t.includes("wc_ev")||!t.includes("topic"))return;let i=En(t,"topic")||"",r=decodeURIComponent(En(t,"wc_ev")||""),n=this.client.session.keys.includes(i);n&&this.client.session.update(i,{transportType:ae.link_mode}),this.client.core.dispatchEnvelope({topic:i,message:r,sessionExists:n})}),I(this,"registerLinkModeListeners",()=>l(this,null,function*(){var t;if(yi()||Ut()&&(t=this.client.metadata.redirect)!=null&&t.linkMode){let i=global==null?void 0:global.Linking;if(typeof i<"u"){i.addEventListener("url",this.handleLinkModeMessage,this.client.name);let r=yield i.getInitialURL();r&&setTimeout(()=>{this.handleLinkModeMessage({url:r})},50)}}})),I(this,"shouldSetTVF",(t,i)=>{if(!i||t!=="wc_sessionRequest")return!1;let{request:r}=i;return Object.keys(bl).includes(r.method)}),I(this,"getTVFParams",(t,i,r)=>{var n,o;try{let a=i.request.method,c=this.extractTxHashesFromResult(a,r);return qe(ie({correlationId:t,rpcMethods:[a],chainId:i.chainId},this.isValidContractData(i.request.params)&&{contractAddresses:[(o=(n=i.request.params)==null?void 0:n[0])==null?void 0:o.to]}),{txHashes:c})}catch(a){this.client.logger.warn("Error getting TVF params",a)}return{}}),I(this,"isValidContractData",t=>{var i;if(!t)return!1;try{let r=t?.data||((i=t?.[0])==null?void 0:i.data);if(!r.startsWith("0x"))return!1;let n=r.slice(2);return/^[0-9a-fA-F]*$/.test(n)?n.length%2===0:!1}catch{}return!1}),I(this,"extractTxHashesFromResult",(t,i)=>{try{let r=bl[t];if(typeof i=="string")return[i];let n=i[r.key];if(wt(n))return t==="solana_signAllTransactions"?n.map(o=>Lc(o)):n;if(typeof n=="string")return[n]}catch(r){this.client.logger.warn("Error extracting tx hashes from result",r)}return[]})}processPendingMessageEvents(){return l(this,null,function*(){try{let e=this.client.session.keys,t=this.client.core.relayer.messages.getWithoutAck(e);for(let[i,r]of Object.entries(t))for(let n of r)try{yield this.onProviderMessageEvent({topic:i,message:n,publishedAt:Date.now()})}catch{this.client.logger.warn(`Error processing pending message event for topic: ${i}, message: ${n}`)}}catch(e){this.client.logger.warn("processPendingMessageEvents failed",e)}})}isInitialized(){if(!this.initialized){let{message:e}=x("NOT_INITIALIZED",this.name);throw new Error(e)}}confirmOnlineStateOrThrow(){return l(this,null,function*(){yield this.client.core.relayer.confirmOnlineStateOrThrow()})}registerRelayerEvents(){this.client.core.relayer.on(ve.message,e=>{this.onProviderMessageEvent(e)})}onRelayMessage(e){return l(this,null,function*(){let{topic:t,message:i,attestation:r,transportType:n}=e,{publicKey:o}=this.client.auth.authKeys.keys.includes(Ir)?this.client.auth.authKeys.get(Ir):{responseTopic:void 0,publicKey:void 0};try{let a=yield this.client.core.crypto.decode(t,i,{receiverPublicKey:o,encoding:n===ae.link_mode?qt:We});si(a)?(this.client.core.history.set(t,a),yield this.onRelayEventRequest({topic:t,payload:a,attestation:r,transportType:n,encryptedId:Qe(i)})):ii(a)?(yield this.client.core.history.resolve(a),yield this.onRelayEventResponse({topic:t,payload:a,transportType:n}),this.client.core.history.delete(t,a.id)):yield this.onRelayEventUnknownPayload({topic:t,payload:a,transportType:n}),yield this.client.core.relayer.messages.ack(t,i)}catch(a){this.client.logger.error(a)}})}registerExpirerEvents(){this.client.core.expirer.on(Je.expired,e=>l(this,null,function*(){let{topic:t,id:i}=cr(e.target);if(i&&this.client.pendingRequest.keys.includes(i))return yield this.deletePendingSessionRequest(i,x("EXPIRED"),!0);if(i&&this.client.auth.requests.keys.includes(i))return yield this.deletePendingAuthRequest(i,x("EXPIRED"),!0);t?this.client.session.keys.includes(t)&&(yield this.deleteSession({topic:t,expirerHasDeleted:!0}),this.client.events.emit("session_expire",{topic:t})):i&&(yield this.deleteProposal(i,!0),this.client.events.emit("proposal_expire",{id:i}))}))}registerPairingEvents(){this.client.core.pairing.events.on(Gt.create,e=>this.onPairingCreated(e)),this.client.core.pairing.events.on(Gt.delete,e=>{this.addToRecentlyDeleted(e.topic,"pairing")})}isValidPairingTopic(e){if(!le(e,!1)){let{message:t}=x("MISSING_OR_INVALID",`pairing topic should be a string: ${e}`);throw new Error(t)}if(!this.client.core.pairing.pairings.keys.includes(e)){let{message:t}=x("NO_MATCHING_KEY",`pairing topic doesn't exist: ${e}`);throw new Error(t)}if(yt(this.client.core.pairing.pairings.get(e).expiry)){let{message:t}=x("EXPIRED",`pairing topic: ${e}`);throw new Error(t)}}isValidSessionTopic(e){return l(this,null,function*(){if(!le(e,!1)){let{message:t}=x("MISSING_OR_INVALID",`session topic should be a string: ${e}`);throw new Error(t)}if(this.checkRecentlyDeleted(e),!this.client.session.keys.includes(e)){let{message:t}=x("NO_MATCHING_KEY",`session topic doesn't exist: ${e}`);throw new Error(t)}if(yt(this.client.session.get(e).expiry)){yield this.deleteSession({topic:e});let{message:t}=x("EXPIRED",`session topic: ${e}`);throw new Error(t)}if(!this.client.core.crypto.keychain.has(e)){let{message:t}=x("MISSING_OR_INVALID",`session topic does not exist in keychain: ${e}`);throw yield this.deleteSession({topic:e}),new Error(t)}})}isValidSessionOrPairingTopic(e){return l(this,null,function*(){if(this.checkRecentlyDeleted(e),this.client.session.keys.includes(e))yield this.isValidSessionTopic(e);else if(this.client.core.pairing.pairings.keys.includes(e))this.isValidPairingTopic(e);else if(le(e,!1)){let{message:t}=x("NO_MATCHING_KEY",`session or pairing topic doesn't exist: ${e}`);throw new Error(t)}else{let{message:t}=x("MISSING_OR_INVALID",`session or pairing topic should be a string: ${e}`);throw new Error(t)}})}isValidProposalId(e){return l(this,null,function*(){if(!Ch(e)){let{message:t}=x("MISSING_OR_INVALID",`proposal id should be a number: ${e}`);throw new Error(t)}if(!this.client.proposal.keys.includes(e)){let{message:t}=x("NO_MATCHING_KEY",`proposal id doesn't exist: ${e}`);throw new Error(t)}if(yt(this.client.proposal.get(e).expiryTimestamp)){yield this.deleteProposal(e);let{message:t}=x("EXPIRED",`proposal id: ${e}`);throw new Error(t)}})}},Oo=class extends It{constructor(e,t){super(e,t,Fy,qo),this.core=e,this.logger=t}},Ro=class extends It{constructor(e,t){super(e,t,jy,qo),this.core=e,this.logger=t}},xo=class extends It{constructor(e,t){super(e,t,By,qo,i=>i.id),this.core=e,this.logger=t}},ko=class extends It{constructor(e,t){super(e,t,zy,Pr,()=>Ir),this.core=e,this.logger=t}},Uo=class extends It{constructor(e,t){super(e,t,Ky,Pr),this.core=e,this.logger=t}},Do=class extends It{constructor(e,t){super(e,t,Wy,Pr,i=>i.id),this.core=e,this.logger=t}},Qy=Object.defineProperty,ew=(s,e,t)=>e in s?Qy(s,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):s[e]=t,Ao=(s,e,t)=>ew(s,typeof e!="symbol"?e+"":e,t),Lo=class{constructor(e,t){this.core=e,this.logger=t,Ao(this,"authKeys"),Ao(this,"pairingTopics"),Ao(this,"requests"),this.authKeys=new ko(this.core,this.logger),this.pairingTopics=new Uo(this.core,this.logger),this.requests=new Do(this.core,this.logger)}init(){return l(this,null,function*(){yield this.authKeys.init(),yield this.pairingTopics.init(),yield this.requests.init()})}},tw=Object.defineProperty,sw=(s,e,t)=>e in s?tw(s,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):s[e]=t,G=(s,e,t)=>sw(s,typeof e!="symbol"?e+"":e,t),Cr=class s extends Ji{constructor(e){super(e),G(this,"protocol",Il),G(this,"version",Cl),G(this,"name",Po.name),G(this,"metadata"),G(this,"core"),G(this,"logger"),G(this,"events",new _r.EventEmitter),G(this,"engine"),G(this,"session"),G(this,"proposal"),G(this,"pendingRequest"),G(this,"auth"),G(this,"signConfig"),G(this,"on",(i,r)=>this.events.on(i,r)),G(this,"once",(i,r)=>this.events.once(i,r)),G(this,"off",(i,r)=>this.events.off(i,r)),G(this,"removeListener",(i,r)=>this.events.removeListener(i,r)),G(this,"removeAllListeners",i=>this.events.removeAllListeners(i)),G(this,"connect",i=>l(this,null,function*(){try{return yield this.engine.connect(i)}catch(r){throw this.logger.error(r.message),r}})),G(this,"pair",i=>l(this,null,function*(){try{return yield this.engine.pair(i)}catch(r){throw this.logger.error(r.message),r}})),G(this,"approve",i=>l(this,null,function*(){try{return yield this.engine.approve(i)}catch(r){throw this.logger.error(r.message),r}})),G(this,"reject",i=>l(this,null,function*(){try{return yield this.engine.reject(i)}catch(r){throw this.logger.error(r.message),r}})),G(this,"update",i=>l(this,null,function*(){try{return yield this.engine.update(i)}catch(r){throw this.logger.error(r.message),r}})),G(this,"extend",i=>l(this,null,function*(){try{return yield this.engine.extend(i)}catch(r){throw this.logger.error(r.message),r}})),G(this,"request",i=>l(this,null,function*(){try{return yield this.engine.request(i)}catch(r){throw this.logger.error(r.message),r}})),G(this,"respond",i=>l(this,null,function*(){try{return yield this.engine.respond(i)}catch(r){throw this.logger.error(r.message),r}})),G(this,"ping",i=>l(this,null,function*(){try{return yield this.engine.ping(i)}catch(r){throw this.logger.error(r.message),r}})),G(this,"emit",i=>l(this,null,function*(){try{return yield this.engine.emit(i)}catch(r){throw this.logger.error(r.message),r}})),G(this,"disconnect",i=>l(this,null,function*(){try{return yield this.engine.disconnect(i)}catch(r){throw this.logger.error(r.message),r}})),G(this,"find",i=>{try{return this.engine.find(i)}catch(r){throw this.logger.error(r.message),r}}),G(this,"getPendingSessionRequests",()=>{try{return this.engine.getPendingSessionRequests()}catch(i){throw this.logger.error(i.message),i}}),G(this,"authenticate",(i,r)=>l(this,null,function*(){try{return yield this.engine.authenticate(i,r)}catch(n){throw this.logger.error(n.message),n}})),G(this,"formatAuthMessage",i=>{try{return this.engine.formatAuthMessage(i)}catch(r){throw this.logger.error(r.message),r}}),G(this,"approveSessionAuthenticate",i=>l(this,null,function*(){try{return yield this.engine.approveSessionAuthenticate(i)}catch(r){throw this.logger.error(r.message),r}})),G(this,"rejectSessionAuthenticate",i=>l(this,null,function*(){try{return yield this.engine.rejectSessionAuthenticate(i)}catch(r){throw this.logger.error(r.message),r}})),this.name=e?.name||Po.name,this.metadata=Ec(e?.metadata),this.signConfig=e?.signConfig;let t=typeof e?.logger<"u"&&typeof e?.logger!="string"?e.logger:(0,fs.default)(Qt({level:e?.logger||Po.logger}));this.core=e?.core||new yl(e),this.logger=Se(t,this.name),this.session=new Ro(this.core,this.logger),this.proposal=new Oo(this.core,this.logger),this.pendingRequest=new xo(this.core,this.logger),this.engine=new To(this),this.auth=new Lo(this.core,this.logger)}static init(e){return l(this,null,function*(){let t=new s(e);return yield t.initialize(),t})}get context(){return Le(this.logger)}get pairing(){return this.core.pairing.pairings}initialize(){return l(this,null,function*(){this.logger.trace("Initialized");try{yield this.core.start(),yield this.session.init(),yield this.proposal.init(),yield this.pendingRequest.init(),yield this.auth.init(),yield this.engine.init(),this.logger.info("SignClient Initialization Success"),setTimeout(()=>{this.engine.processRelayMessageCache()},(0,K.toMiliseconds)(K.ONE_SECOND))}catch(e){throw this.logger.info("SignClient Initialization Failure"),this.logger.error(e.message),e}})}};var Fl=dt(Ui());var Pl="error",iw="wss://relay.walletconnect.org",rw="wc",nw="universal_provider",Sr=`${rw}@2:${nw}:`,jl="https://rpc.walletconnect.org/v1/",Zs="generic",ow=`${jl}bundler`,it={DEFAULT_CHAIN_CHANGED:"default_chain_changed"};function aw(){}function sa(s){return s==null||typeof s!="object"&&typeof s!="function"}function ia(s){return ArrayBuffer.isView(s)&&!(s instanceof DataView)}function cw(s){if(sa(s))return s;if(Array.isArray(s)||ia(s)||s instanceof ArrayBuffer||typeof SharedArrayBuffer<"u"&&s instanceof SharedArrayBuffer)return s.slice(0);let e=Object.getPrototypeOf(s),t=e.constructor;if(s instanceof Date||s instanceof Map||s instanceof Set)return new t(s);if(s instanceof RegExp){let i=new t(s);return i.lastIndex=s.lastIndex,i}if(s instanceof DataView)return new t(s.buffer.slice(0));if(s instanceof Error){let i=new t(s.message);return i.stack=s.stack,i.name=s.name,i.cause=s.cause,i}if(typeof File<"u"&&s instanceof File)return new t([s],s.name,{type:s.type,lastModified:s.lastModified});if(typeof s=="object"){let i=Object.create(e);return Object.assign(i,s)}return s}function Sl(s){return typeof s=="object"&&s!==null}function $l(s){return Object.getOwnPropertySymbols(s).filter(e=>Object.prototype.propertyIsEnumerable.call(s,e))}function Bl(s){return s==null?s===void 0?"[object Undefined]":"[object Null]":Object.prototype.toString.call(s)}var hw="[object RegExp]",Ml="[object String]",Vl="[object Number]",Hl="[object Boolean]",zl="[object Arguments]",lw="[object Symbol]",pw="[object Date]",dw="[object Map]",uw="[object Set]",gw="[object Array]",fw="[object ArrayBuffer]",mw="[object Object]",yw="[object DataView]",ww="[object Uint8Array]",vw="[object Uint8ClampedArray]",bw="[object Uint16Array]",Ew="[object Uint32Array]",Iw="[object Int8Array]",Cw="[object Int16Array]",_w="[object Int32Array]",Pw="[object Float32Array]",Sw="[object Float64Array]";function Aw(s,e){return Qs(s,void 0,s,new Map,e)}function Qs(s,e,t,i=new Map,r=void 0){let n=r?.(s,e,t,i);if(n!=null)return n;if(sa(s))return s;if(i.has(s))return i.get(s);if(Array.isArray(s)){let o=new Array(s.length);i.set(s,o);for(let a=0;a<s.length;a++)o[a]=Qs(s[a],a,t,i,r);return Object.hasOwn(s,"index")&&(o.index=s.index),Object.hasOwn(s,"input")&&(o.input=s.input),o}if(s instanceof Date)return new Date(s.getTime());if(s instanceof RegExp){let o=new RegExp(s.source,s.flags);return o.lastIndex=s.lastIndex,o}if(s instanceof Map){let o=new Map;i.set(s,o);for(let[a,c]of s)o.set(a,Qs(c,a,t,i,r));return o}if(s instanceof Set){let o=new Set;i.set(s,o);for(let a of s)o.add(Qs(a,void 0,t,i,r));return o}if(typeof Buffer<"u"&&Buffer.isBuffer(s))return s.subarray();if(ia(s)){let o=new(Object.getPrototypeOf(s)).constructor(s.length);i.set(s,o);for(let a=0;a<s.length;a++)o[a]=Qs(s[a],a,t,i,r);return o}if(s instanceof ArrayBuffer||typeof SharedArrayBuffer<"u"&&s instanceof SharedArrayBuffer)return s.slice(0);if(s instanceof DataView){let o=new DataView(s.buffer.slice(0),s.byteOffset,s.byteLength);return i.set(s,o),ls(o,s,t,i,r),o}if(typeof File<"u"&&s instanceof File){let o=new File([s],s.name,{type:s.type});return i.set(s,o),ls(o,s,t,i,r),o}if(s instanceof Blob){let o=new Blob([s],{type:s.type});return i.set(s,o),ls(o,s,t,i,r),o}if(s instanceof Error){let o=new s.constructor;return i.set(s,o),o.message=s.message,o.name=s.name,o.stack=s.stack,o.cause=s.cause,ls(o,s,t,i,r),o}if(typeof s=="object"&&Nw(s)){let o=Object.create(Object.getPrototypeOf(s));return i.set(s,o),ls(o,s,t,i,r),o}return s}function ls(s,e,t=s,i,r){let n=[...Object.keys(e),...$l(e)];for(let o=0;o<n.length;o++){let a=n[o],c=Object.getOwnPropertyDescriptor(s,a);(c==null||c.writable)&&(s[a]=Qs(e[a],a,t,i,r))}}function Nw(s){switch(Bl(s)){case zl:case gw:case fw:case yw:case Hl:case pw:case Pw:case Sw:case Iw:case Cw:case _w:case dw:case Vl:case mw:case hw:case uw:case Ml:case lw:case ww:case vw:case bw:case Ew:return!0;default:return!1}}function Tw(s,e){return Aw(s,(t,i,r,n)=>{let o=e?.(t,i,r,n);if(o!=null)return o;if(typeof s=="object")switch(Object.prototype.toString.call(s)){case Vl:case Ml:case Hl:{let a=new s.constructor(s?.valueOf());return ls(a,s),a}case zl:{let a={};return ls(a,s),a.length=s.length,a[Symbol.iterator]=s[Symbol.iterator],a}default:return}})}function Al(s){return Tw(s)}function Nl(s){return s!==null&&typeof s=="object"&&Bl(s)==="[object Arguments]"}function Ow(s){return ia(s)}function Rw(s){if(typeof s!="object"||s==null)return!1;if(Object.getPrototypeOf(s)===null)return!0;if(Object.prototype.toString.call(s)!=="[object Object]"){let t=s[Symbol.toStringTag];return t==null||!Object.getOwnPropertyDescriptor(s,Symbol.toStringTag)?.writable?!1:s.toString()===`[object ${t}]`}let e=s;for(;Object.getPrototypeOf(e)!==null;)e=Object.getPrototypeOf(e);return Object.getPrototypeOf(s)===e}function xw(s,...e){let t=e.slice(0,-1),i=e[e.length-1],r=s;for(let n=0;n<t.length;n++){let o=t[n];r=Mo(r,o,i,new Map)}return r}function Mo(s,e,t,i){if(sa(s)&&(s=Object(s)),e==null||typeof e!="object")return s;if(i.has(e))return cw(i.get(e));if(i.set(e,s),Array.isArray(e)){e=e.slice();for(let n=0;n<e.length;n++)e[n]=e[n]??void 0}let r=[...Object.keys(e),...$l(e)];for(let n=0;n<r.length;n++){let o=r[n],a=e[o],c=s[o];if(Nl(a)&&(a=F({},a)),Nl(c)&&(c=F({},c)),typeof Buffer<"u"&&Buffer.isBuffer(a)&&(a=Al(a)),Array.isArray(a))if(typeof c=="object"&&c!=null){let p=[],d=Reflect.ownKeys(c);for(let u=0;u<d.length;u++){let y=d[u];p[y]=c[y]}c=p}else c=[];let h=t(c,a,o,s,e,i);h!=null?s[o]=h:Array.isArray(a)||Sl(c)&&Sl(a)?s[o]=Mo(c,a,t,i):c==null&&Rw(a)?s[o]=Mo({},a,t,i):c==null&&Ow(a)?s[o]=Al(a):(c===void 0||a!==void 0)&&(s[o]=a)}return s}function kw(s,...e){return xw(s,...e,aw)}var Uw=Object.defineProperty,Dw=Object.defineProperties,Lw=Object.getOwnPropertyDescriptors,Tl=Object.getOwnPropertySymbols,qw=Object.prototype.hasOwnProperty,Fw=Object.prototype.propertyIsEnumerable,Ol=(s,e,t)=>e in s?Uw(s,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):s[e]=t,Ar=(s,e)=>{for(var t in e||(e={}))qw.call(e,t)&&Ol(s,t,e[t]);if(Tl)for(var t of Tl(e))Fw.call(e,t)&&Ol(s,t,e[t]);return s},jw=(s,e)=>Dw(s,Lw(e));function Xe(s,e,t){var i;let r=Wt(s);return((i=e.rpcMap)==null?void 0:i[r.reference])||`${jl}?chainId=${r.namespace}:${r.reference}&projectId=${t}`}function ps(s){return s.includes(":")?s.split(":")[1]:s}function Kl(s){return s.map(e=>`${e.split(":")[0]}:${e.split(":")[1]}`)}function $w(s,e){let t=Object.keys(e.namespaces).filter(r=>r.includes(s));if(!t.length)return[];let i=[];return t.forEach(r=>{let n=e.namespaces[r].accounts;i.push(...n)}),i}function Fo(s={},e={}){let t=Rl(s),i=Rl(e);return kw(t,i)}function Rl(s){var e,t,i,r;let n={};if(!hs(s))return n;for(let[o,a]of Object.entries(s)){let c=mr(o)?[o]:a.chains,h=a.methods||[],p=a.events||[],d=a.rpcMap||{},u=Ls(o);n[u]=jw(Ar(Ar({},n[u]),a),{chains:mi(c,(e=n[u])==null?void 0:e.chains),methods:mi(h,(t=n[u])==null?void 0:t.methods),events:mi(p,(i=n[u])==null?void 0:i.events),rpcMap:Ar(Ar({},d),(r=n[u])==null?void 0:r.rpcMap)})}return n}function xl(s){return s.includes(":")?s.split(":")[2]:s}function kl(s){let e={};for(let[t,i]of Object.entries(s)){let r=i.methods||[],n=i.events||[],o=i.accounts||[],a=mr(t)?[t]:i.chains?i.chains:Kl(i.accounts);e[t]={chains:a,methods:r,events:n,accounts:o}}return e}function jo(s){return typeof s=="number"?s:s.includes("0x")?parseInt(s,16):(s=s.includes(":")?s.split(":")[1]:s,isNaN(Number(s))?s:Number(s))}var Wl={},Q=s=>Wl[s],$o=(s,e)=>{Wl[s]=e},Bw=Object.defineProperty,Mw=(s,e,t)=>e in s?Bw(s,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):s[e]=t,Bs=(s,e,t)=>Mw(s,typeof e!="symbol"?e+"":e,t),Vo=class{constructor(e){Bs(this,"name","polkadot"),Bs(this,"client"),Bs(this,"httpProviders"),Bs(this,"events"),Bs(this,"namespace"),Bs(this,"chainId"),this.namespace=e.namespace,this.events=Q("events"),this.client=Q("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(e){this.namespace=Object.assign(this.namespace,e)}requestAccounts(){return this.getAccounts()}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;let e=this.namespace.chains[0];if(!e)throw new Error("ChainId not found");return e.split(":")[1]}request(e){return this.namespace.methods.includes(e.request.method)?this.client.request(e):this.getHttpProvider().request(e.request)}setDefaultChain(e,t){this.httpProviders[e]||this.setHttpProvider(e,t),this.chainId=e,this.events.emit(it.DEFAULT_CHAIN_CHANGED,`${this.name}:${e}`)}getAccounts(){let e=this.namespace.accounts;return e?e.filter(t=>t.split(":")[1]===this.chainId.toString()).map(t=>t.split(":")[2])||[]:[]}createHttpProviders(){let e={};return this.namespace.chains.forEach(t=>{var i;let r=ps(t);e[r]=this.createHttpProvider(r,(i=this.namespace.rpcMap)==null?void 0:i[t])}),e}getHttpProvider(){let e=`${this.name}:${this.chainId}`,t=this.httpProviders[e];if(typeof t>"u")throw new Error(`JSON-RPC provider for ${e} not found`);return t}setHttpProvider(e,t){let i=this.createHttpProvider(e,t);i&&(this.httpProviders[e]=i)}createHttpProvider(e,t){let i=t||Xe(e,this.namespace,this.client.core.projectId);if(!i)throw new Error(`No RPC url provided for chainId: ${e}`);return new Fe(new Ve(i,Q("disableProviderPing")))}},Vw=Object.defineProperty,Hw=Object.defineProperties,zw=Object.getOwnPropertyDescriptors,Ul=Object.getOwnPropertySymbols,Kw=Object.prototype.hasOwnProperty,Ww=Object.prototype.propertyIsEnumerable,Ho=(s,e,t)=>e in s?Vw(s,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):s[e]=t,Dl=(s,e)=>{for(var t in e||(e={}))Kw.call(e,t)&&Ho(s,t,e[t]);if(Ul)for(var t of Ul(e))Ww.call(e,t)&&Ho(s,t,e[t]);return s},Ll=(s,e)=>Hw(s,zw(e)),Ms=(s,e,t)=>Ho(s,typeof e!="symbol"?e+"":e,t),zo=class{constructor(e){Ms(this,"name","eip155"),Ms(this,"client"),Ms(this,"chainId"),Ms(this,"namespace"),Ms(this,"httpProviders"),Ms(this,"events"),this.namespace=e.namespace,this.events=Q("events"),this.client=Q("client"),this.httpProviders=this.createHttpProviders(),this.chainId=parseInt(this.getDefaultChain())}request(e){return l(this,null,function*(){switch(e.request.method){case"eth_requestAccounts":return this.getAccounts();case"eth_accounts":return this.getAccounts();case"wallet_switchEthereumChain":return yield this.handleSwitchChain(e);case"eth_chainId":return parseInt(this.getDefaultChain());case"wallet_getCapabilities":return yield this.getCapabilities(e);case"wallet_getCallsStatus":return yield this.getCallStatus(e)}return this.namespace.methods.includes(e.request.method)?yield this.client.request(e):this.getHttpProvider().request(e.request)})}updateNamespace(e){this.namespace=Object.assign(this.namespace,e)}setDefaultChain(e,t){this.httpProviders[e]||this.setHttpProvider(parseInt(e),t),this.chainId=parseInt(e),this.events.emit(it.DEFAULT_CHAIN_CHANGED,`${this.name}:${e}`)}requestAccounts(){return this.getAccounts()}getDefaultChain(){if(this.chainId)return this.chainId.toString();if(this.namespace.defaultChain)return this.namespace.defaultChain;let e=this.namespace.chains[0];if(!e)throw new Error("ChainId not found");return e.split(":")[1]}createHttpProvider(e,t){let i=t||Xe(`${this.name}:${e}`,this.namespace,this.client.core.projectId);if(!i)throw new Error(`No RPC url provided for chainId: ${e}`);return new Fe(new Ve(i,Q("disableProviderPing")))}setHttpProvider(e,t){let i=this.createHttpProvider(e,t);i&&(this.httpProviders[e]=i)}createHttpProviders(){let e={};return this.namespace.chains.forEach(t=>{var i;let r=parseInt(ps(t));e[r]=this.createHttpProvider(r,(i=this.namespace.rpcMap)==null?void 0:i[t])}),e}getAccounts(){let e=this.namespace.accounts;return e?[...new Set(e.filter(t=>t.split(":")[1]===this.chainId.toString()).map(t=>t.split(":")[2]))]:[]}getHttpProvider(){let e=this.chainId,t=this.httpProviders[e];if(typeof t>"u")throw new Error(`JSON-RPC provider for ${e} not found`);return t}handleSwitchChain(e){return l(this,null,function*(){var t,i;let r=e.request.params?(t=e.request.params[0])==null?void 0:t.chainId:"0x0";r=r.startsWith("0x")?r:`0x${r}`;let n=parseInt(r,16);if(this.isChainApproved(n))this.setDefaultChain(`${n}`);else if(this.namespace.methods.includes("wallet_switchEthereumChain"))yield this.client.request({topic:e.topic,request:{method:e.request.method,params:[{chainId:r}]},chainId:(i=this.namespace.chains)==null?void 0:i[0]}),this.setDefaultChain(`${n}`);else throw new Error(`Failed to switch to chain 'eip155:${n}'. The chain is not approved or the wallet does not support 'wallet_switchEthereumChain' method.`);return null})}isChainApproved(e){return this.namespace.chains.includes(`${this.name}:${e}`)}getCapabilities(e){return l(this,null,function*(){var t,i,r;let n=(i=(t=e.request)==null?void 0:t.params)==null?void 0:i[0];if(!n)throw new Error("Missing address parameter in `wallet_getCapabilities` request");let o=this.client.session.get(e.topic),a=((r=o?.sessionProperties)==null?void 0:r.capabilities)||{};if(a!=null&&a[n])return a?.[n];let c=yield this.client.request(e);try{yield this.client.session.update(e.topic,{sessionProperties:Ll(Dl({},o.sessionProperties||{}),{capabilities:Ll(Dl({},a||{}),{[n]:c})})})}catch(h){console.warn("Failed to update session with capabilities",h)}return c})}getCallStatus(e){return l(this,null,function*(){var t,i;let r=this.client.session.get(e.topic),n=(t=r.sessionProperties)==null?void 0:t.bundler_name;if(n){let a=this.getBundlerUrl(e.chainId,n);try{return yield this.getUserOperationReceipt(a,e)}catch(c){console.warn("Failed to fetch call status from bundler",c,a)}}let o=(i=r.sessionProperties)==null?void 0:i.bundler_url;if(o)try{return yield this.getUserOperationReceipt(o,e)}catch(a){console.warn("Failed to fetch call status from custom bundler",a,o)}if(this.namespace.methods.includes(e.request.method))return yield this.client.request(e);throw new Error("Fetching call status not approved by the wallet.")})}getUserOperationReceipt(e,t){return l(this,null,function*(){var i;let r=new URL(e),n=yield fetch(r,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(ut("eth_getUserOperationReceipt",[(i=t.request.params)==null?void 0:i[0]]))});if(!n.ok)throw new Error(`Failed to fetch user operation receipt - ${n.status}`);return yield n.json()})}getBundlerUrl(e,t){return`${ow}?projectId=${this.client.core.projectId}&chainId=${e}&bundler=${t}`}},Gw=Object.defineProperty,Yw=(s,e,t)=>e in s?Gw(s,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):s[e]=t,Vs=(s,e,t)=>Yw(s,typeof e!="symbol"?e+"":e,t),Ko=class{constructor(e){Vs(this,"name","solana"),Vs(this,"client"),Vs(this,"httpProviders"),Vs(this,"events"),Vs(this,"namespace"),Vs(this,"chainId"),this.namespace=e.namespace,this.events=Q("events"),this.client=Q("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(e){this.namespace=Object.assign(this.namespace,e)}requestAccounts(){return this.getAccounts()}request(e){return this.namespace.methods.includes(e.request.method)?this.client.request(e):this.getHttpProvider().request(e.request)}setDefaultChain(e,t){this.httpProviders[e]||this.setHttpProvider(e,t),this.chainId=e,this.events.emit(it.DEFAULT_CHAIN_CHANGED,`${this.name}:${e}`)}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;let e=this.namespace.chains[0];if(!e)throw new Error("ChainId not found");return e.split(":")[1]}getAccounts(){let e=this.namespace.accounts;return e?[...new Set(e.filter(t=>t.split(":")[1]===this.chainId.toString()).map(t=>t.split(":")[2]))]:[]}createHttpProviders(){let e={};return this.namespace.chains.forEach(t=>{var i;let r=ps(t);e[r]=this.createHttpProvider(r,(i=this.namespace.rpcMap)==null?void 0:i[t])}),e}getHttpProvider(){let e=`${this.name}:${this.chainId}`,t=this.httpProviders[e];if(typeof t>"u")throw new Error(`JSON-RPC provider for ${e} not found`);return t}setHttpProvider(e,t){let i=this.createHttpProvider(e,t);i&&(this.httpProviders[e]=i)}createHttpProvider(e,t){let i=t||Xe(e,this.namespace,this.client.core.projectId);if(!i)throw new Error(`No RPC url provided for chainId: ${e}`);return new Fe(new Ve(i,Q("disableProviderPing")))}},Jw=Object.defineProperty,Xw=(s,e,t)=>e in s?Jw(s,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):s[e]=t,Hs=(s,e,t)=>Xw(s,typeof e!="symbol"?e+"":e,t),Wo=class{constructor(e){Hs(this,"name","cosmos"),Hs(this,"client"),Hs(this,"httpProviders"),Hs(this,"events"),Hs(this,"namespace"),Hs(this,"chainId"),this.namespace=e.namespace,this.events=Q("events"),this.client=Q("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(e){this.namespace=Object.assign(this.namespace,e)}requestAccounts(){return this.getAccounts()}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;let e=this.namespace.chains[0];if(!e)throw new Error("ChainId not found");return e.split(":")[1]}request(e){return this.namespace.methods.includes(e.request.method)?this.client.request(e):this.getHttpProvider().request(e.request)}setDefaultChain(e,t){this.httpProviders[e]||this.setHttpProvider(e,t),this.chainId=e,this.events.emit(it.DEFAULT_CHAIN_CHANGED,`${this.name}:${this.chainId}`)}getAccounts(){let e=this.namespace.accounts;return e?[...new Set(e.filter(t=>t.split(":")[1]===this.chainId.toString()).map(t=>t.split(":")[2]))]:[]}createHttpProviders(){let e={};return this.namespace.chains.forEach(t=>{var i;let r=ps(t);e[r]=this.createHttpProvider(r,(i=this.namespace.rpcMap)==null?void 0:i[t])}),e}getHttpProvider(){let e=`${this.name}:${this.chainId}`,t=this.httpProviders[e];if(typeof t>"u")throw new Error(`JSON-RPC provider for ${e} not found`);return t}setHttpProvider(e,t){let i=this.createHttpProvider(e,t);i&&(this.httpProviders[e]=i)}createHttpProvider(e,t){let i=t||Xe(e,this.namespace,this.client.core.projectId);if(!i)throw new Error(`No RPC url provided for chainId: ${e}`);return new Fe(new Ve(i,Q("disableProviderPing")))}},Zw=Object.defineProperty,Qw=(s,e,t)=>e in s?Zw(s,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):s[e]=t,zs=(s,e,t)=>Qw(s,typeof e!="symbol"?e+"":e,t),Go=class{constructor(e){zs(this,"name","algorand"),zs(this,"client"),zs(this,"httpProviders"),zs(this,"events"),zs(this,"namespace"),zs(this,"chainId"),this.namespace=e.namespace,this.events=Q("events"),this.client=Q("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(e){this.namespace=Object.assign(this.namespace,e)}requestAccounts(){return this.getAccounts()}request(e){return this.namespace.methods.includes(e.request.method)?this.client.request(e):this.getHttpProvider().request(e.request)}setDefaultChain(e,t){if(!this.httpProviders[e]){let i=t||Xe(`${this.name}:${e}`,this.namespace,this.client.core.projectId);if(!i)throw new Error(`No RPC url provided for chainId: ${e}`);this.setHttpProvider(e,i)}this.chainId=e,this.events.emit(it.DEFAULT_CHAIN_CHANGED,`${this.name}:${this.chainId}`)}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;let e=this.namespace.chains[0];if(!e)throw new Error("ChainId not found");return e.split(":")[1]}getAccounts(){let e=this.namespace.accounts;return e?[...new Set(e.filter(t=>t.split(":")[1]===this.chainId.toString()).map(t=>t.split(":")[2]))]:[]}createHttpProviders(){let e={};return this.namespace.chains.forEach(t=>{var i;e[t]=this.createHttpProvider(t,(i=this.namespace.rpcMap)==null?void 0:i[t])}),e}getHttpProvider(){let e=`${this.name}:${this.chainId}`,t=this.httpProviders[e];if(typeof t>"u")throw new Error(`JSON-RPC provider for ${e} not found`);return t}setHttpProvider(e,t){let i=this.createHttpProvider(e,t);i&&(this.httpProviders[e]=i)}createHttpProvider(e,t){let i=t||Xe(e,this.namespace,this.client.core.projectId);return typeof i>"u"?void 0:new Fe(new Ve(i,Q("disableProviderPing")))}},ev=Object.defineProperty,tv=(s,e,t)=>e in s?ev(s,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):s[e]=t,Ks=(s,e,t)=>tv(s,typeof e!="symbol"?e+"":e,t),Yo=class{constructor(e){Ks(this,"name","cip34"),Ks(this,"client"),Ks(this,"httpProviders"),Ks(this,"events"),Ks(this,"namespace"),Ks(this,"chainId"),this.namespace=e.namespace,this.events=Q("events"),this.client=Q("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(e){this.namespace=Object.assign(this.namespace,e)}requestAccounts(){return this.getAccounts()}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;let e=this.namespace.chains[0];if(!e)throw new Error("ChainId not found");return e.split(":")[1]}request(e){return this.namespace.methods.includes(e.request.method)?this.client.request(e):this.getHttpProvider().request(e.request)}setDefaultChain(e,t){this.httpProviders[e]||this.setHttpProvider(e,t),this.chainId=e,this.events.emit(it.DEFAULT_CHAIN_CHANGED,`${this.name}:${this.chainId}`)}getAccounts(){let e=this.namespace.accounts;return e?[...new Set(e.filter(t=>t.split(":")[1]===this.chainId.toString()).map(t=>t.split(":")[2]))]:[]}createHttpProviders(){let e={};return this.namespace.chains.forEach(t=>{let i=this.getCardanoRPCUrl(t),r=ps(t);e[r]=this.createHttpProvider(r,i)}),e}getHttpProvider(){let e=`${this.name}:${this.chainId}`,t=this.httpProviders[e];if(typeof t>"u")throw new Error(`JSON-RPC provider for ${e} not found`);return t}getCardanoRPCUrl(e){let t=this.namespace.rpcMap;if(t)return t[e]}setHttpProvider(e,t){let i=this.createHttpProvider(e,t);i&&(this.httpProviders[e]=i)}createHttpProvider(e,t){let i=t||this.getCardanoRPCUrl(e);if(!i)throw new Error(`No RPC url provided for chainId: ${e}`);return new Fe(new Ve(i,Q("disableProviderPing")))}},sv=Object.defineProperty,iv=(s,e,t)=>e in s?sv(s,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):s[e]=t,Ws=(s,e,t)=>iv(s,typeof e!="symbol"?e+"":e,t),Jo=class{constructor(e){Ws(this,"name","elrond"),Ws(this,"client"),Ws(this,"httpProviders"),Ws(this,"events"),Ws(this,"namespace"),Ws(this,"chainId"),this.namespace=e.namespace,this.events=Q("events"),this.client=Q("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(e){this.namespace=Object.assign(this.namespace,e)}requestAccounts(){return this.getAccounts()}request(e){return this.namespace.methods.includes(e.request.method)?this.client.request(e):this.getHttpProvider().request(e.request)}setDefaultChain(e,t){this.httpProviders[e]||this.setHttpProvider(e,t),this.chainId=e,this.events.emit(it.DEFAULT_CHAIN_CHANGED,`${this.name}:${e}`)}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;let e=this.namespace.chains[0];if(!e)throw new Error("ChainId not found");return e.split(":")[1]}getAccounts(){let e=this.namespace.accounts;return e?[...new Set(e.filter(t=>t.split(":")[1]===this.chainId.toString()).map(t=>t.split(":")[2]))]:[]}createHttpProviders(){let e={};return this.namespace.chains.forEach(t=>{var i;let r=ps(t);e[r]=this.createHttpProvider(r,(i=this.namespace.rpcMap)==null?void 0:i[t])}),e}getHttpProvider(){let e=`${this.name}:${this.chainId}`,t=this.httpProviders[e];if(typeof t>"u")throw new Error(`JSON-RPC provider for ${e} not found`);return t}setHttpProvider(e,t){let i=this.createHttpProvider(e,t);i&&(this.httpProviders[e]=i)}createHttpProvider(e,t){let i=t||Xe(e,this.namespace,this.client.core.projectId);if(!i)throw new Error(`No RPC url provided for chainId: ${e}`);return new Fe(new Ve(i,Q("disableProviderPing")))}},rv=Object.defineProperty,nv=(s,e,t)=>e in s?rv(s,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):s[e]=t,Gs=(s,e,t)=>nv(s,typeof e!="symbol"?e+"":e,t),Xo=class{constructor(e){Gs(this,"name","multiversx"),Gs(this,"client"),Gs(this,"httpProviders"),Gs(this,"events"),Gs(this,"namespace"),Gs(this,"chainId"),this.namespace=e.namespace,this.events=Q("events"),this.client=Q("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(e){this.namespace=Object.assign(this.namespace,e)}requestAccounts(){return this.getAccounts()}request(e){return this.namespace.methods.includes(e.request.method)?this.client.request(e):this.getHttpProvider().request(e.request)}setDefaultChain(e,t){this.httpProviders[e]||this.setHttpProvider(e,t),this.chainId=e,this.events.emit(it.DEFAULT_CHAIN_CHANGED,`${this.name}:${e}`)}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;let e=this.namespace.chains[0];if(!e)throw new Error("ChainId not found");return e.split(":")[1]}getAccounts(){let e=this.namespace.accounts;return e?[...new Set(e.filter(t=>t.split(":")[1]===this.chainId.toString()).map(t=>t.split(":")[2]))]:[]}createHttpProviders(){let e={};return this.namespace.chains.forEach(t=>{var i;let r=ps(t);e[r]=this.createHttpProvider(r,(i=this.namespace.rpcMap)==null?void 0:i[t])}),e}getHttpProvider(){let e=`${this.name}:${this.chainId}`,t=this.httpProviders[e];if(typeof t>"u")throw new Error(`JSON-RPC provider for ${e} not found`);return t}setHttpProvider(e,t){let i=this.createHttpProvider(e,t);i&&(this.httpProviders[e]=i)}createHttpProvider(e,t){let i=t||Xe(e,this.namespace,this.client.core.projectId);if(!i)throw new Error(`No RPC url provided for chainId: ${e}`);return new Fe(new Ve(i,Q("disableProviderPing")))}},ov=Object.defineProperty,av=(s,e,t)=>e in s?ov(s,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):s[e]=t,Ys=(s,e,t)=>av(s,typeof e!="symbol"?e+"":e,t),Zo=class{constructor(e){Ys(this,"name","near"),Ys(this,"client"),Ys(this,"httpProviders"),Ys(this,"events"),Ys(this,"namespace"),Ys(this,"chainId"),this.namespace=e.namespace,this.events=Q("events"),this.client=Q("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(e){this.namespace=Object.assign(this.namespace,e)}requestAccounts(){return this.getAccounts()}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;let e=this.namespace.chains[0];if(!e)throw new Error("ChainId not found");return e.split(":")[1]}request(e){return this.namespace.methods.includes(e.request.method)?this.client.request(e):this.getHttpProvider().request(e.request)}setDefaultChain(e,t){if(this.chainId=e,!this.httpProviders[e]){let i=t||Xe(`${this.name}:${e}`,this.namespace);if(!i)throw new Error(`No RPC url provided for chainId: ${e}`);this.setHttpProvider(e,i)}this.events.emit(it.DEFAULT_CHAIN_CHANGED,`${this.name}:${this.chainId}`)}getAccounts(){let e=this.namespace.accounts;return e?e.filter(t=>t.split(":")[1]===this.chainId.toString()).map(t=>t.split(":")[2])||[]:[]}createHttpProviders(){let e={};return this.namespace.chains.forEach(t=>{var i;e[t]=this.createHttpProvider(t,(i=this.namespace.rpcMap)==null?void 0:i[t])}),e}getHttpProvider(){let e=`${this.name}:${this.chainId}`,t=this.httpProviders[e];if(typeof t>"u")throw new Error(`JSON-RPC provider for ${e} not found`);return t}setHttpProvider(e,t){let i=this.createHttpProvider(e,t);i&&(this.httpProviders[e]=i)}createHttpProvider(e,t){let i=t||Xe(e,this.namespace);return typeof i>"u"?void 0:new Fe(new Ve(i,Q("disableProviderPing")))}},cv=Object.defineProperty,hv=(s,e,t)=>e in s?cv(s,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):s[e]=t,Js=(s,e,t)=>hv(s,typeof e!="symbol"?e+"":e,t),Qo=class{constructor(e){Js(this,"name","tezos"),Js(this,"client"),Js(this,"httpProviders"),Js(this,"events"),Js(this,"namespace"),Js(this,"chainId"),this.namespace=e.namespace,this.events=Q("events"),this.client=Q("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(e){this.namespace=Object.assign(this.namespace,e)}requestAccounts(){return this.getAccounts()}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;let e=this.namespace.chains[0];if(!e)throw new Error("ChainId not found");return e.split(":")[1]}request(e){return this.namespace.methods.includes(e.request.method)?this.client.request(e):this.getHttpProvider().request(e.request)}setDefaultChain(e,t){if(this.chainId=e,!this.httpProviders[e]){let i=t||Xe(`${this.name}:${e}`,this.namespace);if(!i)throw new Error(`No RPC url provided for chainId: ${e}`);this.setHttpProvider(e,i)}this.events.emit(it.DEFAULT_CHAIN_CHANGED,`${this.name}:${this.chainId}`)}getAccounts(){let e=this.namespace.accounts;return e?e.filter(t=>t.split(":")[1]===this.chainId.toString()).map(t=>t.split(":")[2])||[]:[]}createHttpProviders(){let e={};return this.namespace.chains.forEach(t=>{e[t]=this.createHttpProvider(t)}),e}getHttpProvider(){let e=`${this.name}:${this.chainId}`,t=this.httpProviders[e];if(typeof t>"u")throw new Error(`JSON-RPC provider for ${e} not found`);return t}setHttpProvider(e,t){let i=this.createHttpProvider(e,t);i&&(this.httpProviders[e]=i)}createHttpProvider(e,t){let i=t||Xe(e,this.namespace);return typeof i>"u"?void 0:new Fe(new Ve(i))}},lv=Object.defineProperty,pv=(s,e,t)=>e in s?lv(s,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):s[e]=t,Xs=(s,e,t)=>pv(s,typeof e!="symbol"?e+"":e,t),ea=class{constructor(e){Xs(this,"name",Zs),Xs(this,"client"),Xs(this,"httpProviders"),Xs(this,"events"),Xs(this,"namespace"),Xs(this,"chainId"),this.namespace=e.namespace,this.events=Q("events"),this.client=Q("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(e){this.namespace.chains=[...new Set((this.namespace.chains||[]).concat(e.chains||[]))],this.namespace.accounts=[...new Set((this.namespace.accounts||[]).concat(e.accounts||[]))],this.namespace.methods=[...new Set((this.namespace.methods||[]).concat(e.methods||[]))],this.namespace.events=[...new Set((this.namespace.events||[]).concat(e.events||[]))],this.httpProviders=this.createHttpProviders()}requestAccounts(){return this.getAccounts()}request(e){return this.namespace.methods.includes(e.request.method)?this.client.request(e):this.getHttpProvider(e.chainId).request(e.request)}setDefaultChain(e,t){this.httpProviders[e]||this.setHttpProvider(e,t),this.chainId=e,this.events.emit(it.DEFAULT_CHAIN_CHANGED,`${this.name}:${e}`)}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;let e=this.namespace.chains[0];if(!e)throw new Error("ChainId not found");return e.split(":")[1]}getAccounts(){let e=this.namespace.accounts;return e?[...new Set(e.filter(t=>t.split(":")[1]===this.chainId.toString()).map(t=>t.split(":")[2]))]:[]}createHttpProviders(){var e,t;let i={};return(t=(e=this.namespace)==null?void 0:e.accounts)==null||t.forEach(r=>{let n=Wt(r);i[`${n.namespace}:${n.reference}`]=this.createHttpProvider(r)}),i}getHttpProvider(e){let t=this.httpProviders[e];if(typeof t>"u")throw new Error(`JSON-RPC provider for ${e} not found`);return t}setHttpProvider(e,t){let i=this.createHttpProvider(e,t);i&&(this.httpProviders[e]=i)}createHttpProvider(e,t){let i=t||Xe(e,this.namespace,this.client.core.projectId);if(!i)throw new Error(`No RPC url provided for chainId: ${e}`);return new Fe(new Ve(i,Q("disableProviderPing")))}},dv=Object.defineProperty,uv=Object.defineProperties,gv=Object.getOwnPropertyDescriptors,ql=Object.getOwnPropertySymbols,fv=Object.prototype.hasOwnProperty,mv=Object.prototype.propertyIsEnumerable,ta=(s,e,t)=>e in s?dv(s,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):s[e]=t,Nr=(s,e)=>{for(var t in e||(e={}))fv.call(e,t)&&ta(s,t,e[t]);if(ql)for(var t of ql(e))mv.call(e,t)&&ta(s,t,e[t]);return s},Bo=(s,e)=>uv(s,gv(e)),st=(s,e,t)=>ta(s,typeof e!="symbol"?e+"":e,t),Tr=class s{constructor(e){st(this,"client"),st(this,"namespaces"),st(this,"optionalNamespaces"),st(this,"sessionProperties"),st(this,"scopedProperties"),st(this,"events",new Fl.default),st(this,"rpcProviders",{}),st(this,"session"),st(this,"providerOpts"),st(this,"logger"),st(this,"uri"),st(this,"disableProviderPing",!1),this.providerOpts=e,this.logger=typeof e?.logger<"u"&&typeof e?.logger!="string"?e.logger:(0,fs.default)(Qt({level:e?.logger||Pl})),this.disableProviderPing=e?.disableProviderPing||!1}static init(e){return l(this,null,function*(){let t=new s(e);return yield t.initialize(),t})}request(e,t,i){return l(this,null,function*(){let[r,n]=this.validateChain(t);if(!this.session)throw new Error("Please call connect() before request()");return yield this.getProvider(r).request({request:Nr({},e),chainId:`${r}:${n}`,topic:this.session.topic,expiry:i})})}sendAsync(e,t,i,r){let n=new Date().getTime();this.request(e,i,r).then(o=>t(null,es(n,o))).catch(o=>t(o,void 0))}enable(){return l(this,null,function*(){if(!this.client)throw new Error("Sign Client not initialized");return this.session||(yield this.connect({namespaces:this.namespaces,optionalNamespaces:this.optionalNamespaces,sessionProperties:this.sessionProperties,scopedProperties:this.scopedProperties})),yield this.requestAccounts()})}disconnect(){return l(this,null,function*(){var e;if(!this.session)throw new Error("Please call connect() before enable()");yield this.client.disconnect({topic:(e=this.session)==null?void 0:e.topic,reason:ee("USER_DISCONNECTED")}),yield this.cleanup()})}connect(e){return l(this,null,function*(){if(!this.client)throw new Error("Sign Client not initialized");if(this.setNamespaces(e),yield this.cleanupPendingPairings(),!e.skipPairing)return yield this.pair(e.pairingTopic)})}authenticate(e,t){return l(this,null,function*(){if(!this.client)throw new Error("Sign Client not initialized");this.setNamespaces(e),yield this.cleanupPendingPairings();let{uri:i,response:r}=yield this.client.authenticate(e,t);i&&(this.uri=i,this.events.emit("display_uri",i));let n=yield r();if(this.session=n.session,this.session){let o=kl(this.session.namespaces);this.namespaces=Fo(this.namespaces,o),yield this.persist("namespaces",this.namespaces),this.onConnect()}return n})}on(e,t){this.events.on(e,t)}once(e,t){this.events.once(e,t)}removeListener(e,t){this.events.removeListener(e,t)}off(e,t){this.events.off(e,t)}get isWalletConnect(){return!0}pair(e){return l(this,null,function*(){let{uri:t,approval:i}=yield this.client.connect({pairingTopic:e,requiredNamespaces:this.namespaces,optionalNamespaces:this.optionalNamespaces,sessionProperties:this.sessionProperties,scopedProperties:this.scopedProperties});t&&(this.uri=t,this.events.emit("display_uri",t));let r=yield i();this.session=r;let n=kl(r.namespaces);return this.namespaces=Fo(this.namespaces,n),yield this.persist("namespaces",this.namespaces),yield this.persist("optionalNamespaces",this.optionalNamespaces),this.onConnect(),this.session})}setDefaultChain(e,t){try{if(!this.session)return;let[i,r]=this.validateChain(e),n=this.getProvider(i);n.name===Zs?n.setDefaultChain(`${i}:${r}`,t):n.setDefaultChain(r,t)}catch(i){if(!/Please call connect/.test(i.message))throw i}}cleanupPendingPairings(){return l(this,arguments,function*(e={}){this.logger.info("Cleaning up inactive pairings...");let t=this.client.pairing.getAll();if(wt(t)){for(let i of t)e.deletePairings?this.client.core.expirer.set(i.topic,0):yield this.client.core.relayer.subscriber.unsubscribe(i.topic);this.logger.info(`Inactive pairings cleared: ${t.length}`)}})}abortPairingAttempt(){this.logger.warn("abortPairingAttempt is deprecated. This is now a no-op.")}checkStorage(){return l(this,null,function*(){this.namespaces=(yield this.getFromStore("namespaces"))||{},this.optionalNamespaces=(yield this.getFromStore("optionalNamespaces"))||{},this.session&&this.createProviders()})}initialize(){return l(this,null,function*(){this.logger.trace("Initialized"),yield this.createClient(),yield this.checkStorage(),this.registerEventListeners()})}createClient(){return l(this,null,function*(){var e,t;if(this.client=this.providerOpts.client||(yield Cr.init({core:this.providerOpts.core,logger:this.providerOpts.logger||Pl,relayUrl:this.providerOpts.relayUrl||iw,projectId:this.providerOpts.projectId,metadata:this.providerOpts.metadata,storageOptions:this.providerOpts.storageOptions,storage:this.providerOpts.storage,name:this.providerOpts.name,customStoragePrefix:this.providerOpts.customStoragePrefix,telemetryEnabled:this.providerOpts.telemetryEnabled})),this.providerOpts.session)try{this.session=this.client.session.get(this.providerOpts.session.topic)}catch(i){throw this.logger.error("Failed to get session",i),new Error(`The provided session: ${(t=(e=this.providerOpts)==null?void 0:e.session)==null?void 0:t.topic} doesn't exist in the Sign client`)}else{let i=this.client.session.getAll();this.session=i[0]}this.logger.trace("SignClient Initialized")})}createProviders(){if(!this.client)throw new Error("Sign Client not initialized");if(!this.session)throw new Error("Session not initialized. Please call connect() before enable()");let e=[...new Set(Object.keys(this.session.namespaces).map(t=>Ls(t)))];$o("client",this.client),$o("events",this.events),$o("disableProviderPing",this.disableProviderPing),e.forEach(t=>{if(!this.session)return;let i=$w(t,this.session),r=Kl(i),n=Fo(this.namespaces,this.optionalNamespaces),o=Bo(Nr({},n[t]),{accounts:i,chains:r});switch(t){case"eip155":this.rpcProviders[t]=new zo({namespace:o});break;case"algorand":this.rpcProviders[t]=new Go({namespace:o});break;case"solana":this.rpcProviders[t]=new Ko({namespace:o});break;case"cosmos":this.rpcProviders[t]=new Wo({namespace:o});break;case"polkadot":this.rpcProviders[t]=new Vo({namespace:o});break;case"cip34":this.rpcProviders[t]=new Yo({namespace:o});break;case"elrond":this.rpcProviders[t]=new Jo({namespace:o});break;case"multiversx":this.rpcProviders[t]=new Xo({namespace:o});break;case"near":this.rpcProviders[t]=new Zo({namespace:o});break;case"tezos":this.rpcProviders[t]=new Qo({namespace:o});break;default:this.rpcProviders[Zs]?this.rpcProviders[Zs].updateNamespace(o):this.rpcProviders[Zs]=new ea({namespace:o})}})}registerEventListeners(){if(typeof this.client>"u")throw new Error("Sign Client is not initialized");this.client.on("session_ping",e=>{var t;let{topic:i}=e;i===((t=this.session)==null?void 0:t.topic)&&this.events.emit("session_ping",e)}),this.client.on("session_event",e=>{var t;let{params:i,topic:r}=e;if(r!==((t=this.session)==null?void 0:t.topic))return;let{event:n}=i;if(n.name==="accountsChanged"){let o=n.data;o&&wt(o)&&this.events.emit("accountsChanged",o.map(xl))}else if(n.name==="chainChanged"){let o=i.chainId,a=i.event.data,c=Ls(o),h=jo(o)!==jo(a)?`${c}:${jo(a)}`:o;this.onChainChanged(h)}else this.events.emit(n.name,n.data);this.events.emit("session_event",e)}),this.client.on("session_update",({topic:e,params:t})=>{var i,r;if(e!==((i=this.session)==null?void 0:i.topic))return;let{namespaces:n}=t,o=(r=this.client)==null?void 0:r.session.get(e);this.session=Bo(Nr({},o),{namespaces:n}),this.onSessionUpdate(),this.events.emit("session_update",{topic:e,params:t})}),this.client.on("session_delete",e=>l(this,null,function*(){var t;e.topic===((t=this.session)==null?void 0:t.topic)&&(yield this.cleanup(),this.events.emit("session_delete",e),this.events.emit("disconnect",Bo(Nr({},ee("USER_DISCONNECTED")),{data:e.topic})))})),this.on(it.DEFAULT_CHAIN_CHANGED,e=>{this.onChainChanged(e,!0)})}getProvider(e){return this.rpcProviders[e]||this.rpcProviders[Zs]}onSessionUpdate(){Object.keys(this.rpcProviders).forEach(e=>{var t;this.getProvider(e).updateNamespace((t=this.session)==null?void 0:t.namespaces[e])})}setNamespaces(e){let{namespaces:t,optionalNamespaces:i,sessionProperties:r,scopedProperties:n}=e;t&&Object.keys(t).length&&(this.namespaces=t),i&&Object.keys(i).length&&(this.optionalNamespaces=i),this.sessionProperties=r,this.scopedProperties=n}validateChain(e){let[t,i]=e?.split(":")||["",""];if(!this.namespaces||!Object.keys(this.namespaces).length)return[t,i];if(t&&!Object.keys(this.namespaces||{}).map(o=>Ls(o)).includes(t))throw new Error(`Namespace '${t}' is not configured. Please call connect() first with namespace config.`);if(t&&i)return[t,i];let r=Ls(Object.keys(this.namespaces)[0]),n=this.rpcProviders[r].getDefaultChain();return[r,n]}requestAccounts(){return l(this,null,function*(){let[e]=this.validateChain();return yield this.getProvider(e).requestAccounts()})}onChainChanged(e,t=!1){return l(this,null,function*(){if(!this.namespaces)return;let[i,r]=this.validateChain(e);if(!r)return;this.updateNamespaceChain(i,r),this.events.emit("chainChanged",r);let n=this.getProvider(i).getDefaultChain();t||this.getProvider(i).setDefaultChain(r),this.emitAccountsChangedOnChainChange({namespace:i,previousChainId:n,newChainId:e}),yield this.persist("namespaces",this.namespaces)})}emitAccountsChangedOnChainChange({namespace:e,previousChainId:t,newChainId:i}){var r,n;try{if(t===i)return;let o=(n=(r=this.session)==null?void 0:r.namespaces[e])==null?void 0:n.accounts;if(!o)return;let a=o.filter(c=>c.includes(`${i}:`)).map(xl);if(!wt(a))return;this.events.emit("accountsChanged",a)}catch(o){this.logger.warn("Failed to emit accountsChanged on chain change",o)}}updateNamespaceChain(e,t){if(!this.namespaces)return;let i=this.namespaces[e]?e:`${e}:${t}`,r={chains:[],methods:[],events:[],defaultChain:t};this.namespaces[i]?this.namespaces[i]&&(this.namespaces[i].defaultChain=t):this.namespaces[i]=r}onConnect(){this.createProviders(),this.events.emit("connect",{session:this.session})}cleanup(){return l(this,null,function*(){this.namespaces=void 0,this.optionalNamespaces=void 0,this.sessionProperties=void 0,yield this.deleteFromStore("namespaces"),yield this.deleteFromStore("optionalNamespaces"),yield this.deleteFromStore("sessionProperties"),this.session=void 0,yield this.cleanupPendingPairings({deletePairings:!0}),yield this.cleanupStorage()})}persist(e,t){return l(this,null,function*(){var i;let r=((i=this.session)==null?void 0:i.topic)||"";yield this.client.core.storage.setItem(`${Sr}/${e}${r}`,t)})}getFromStore(e){return l(this,null,function*(){var t;let i=((t=this.session)==null?void 0:t.topic)||"";return yield this.client.core.storage.getItem(`${Sr}/${e}${i}`)})}deleteFromStore(e){return l(this,null,function*(){var t;let i=((t=this.session)==null?void 0:t.topic)||"";yield this.client.core.storage.removeItem(`${Sr}/${e}${i}`)})}cleanupStorage(){return l(this,null,function*(){var e;try{if(((e=this.client)==null?void 0:e.session.length)>0)return;let t=yield this.client.core.storage.getKeys();for(let i of t)i.startsWith(Sr)&&(yield this.client.core.storage.removeItem(i))}catch(t){this.logger.warn("Failed to cleanup storage",t)}})}};var xi={ERROR_CODE_UNRECOGNIZED_CHAIN_ID:4902,ERROR_CODE_DEFAULT:5e3,ERROR_INVALID_CHAIN_ID:32603};function jt(s){return F({formatters:void 0,fees:void 0,serializers:void 0},s)}var ra=jt({id:"5eykt4UsFv8P8NJdTREpY1vzqKqZKvdp",name:"Solana",network:"solana-mainnet",nativeCurrency:{name:"Solana",symbol:"SOL",decimals:9},rpcUrls:{default:{http:["https://rpc.walletconnect.org/v1"]}},blockExplorers:{default:{name:"Solscan",url:"https://solscan.io"}},testnet:!1,chainNamespace:"solana",caipNetworkId:"solana:5eykt4UsFv8P8NJdTREpY1vzqKqZKvdp",deprecatedCaipNetworkId:"solana:4sGjMW1sUnHzSxGspuhpqLDx6wiyjNtZ"});var na=jt({id:"EtWTRABZaYq6iMfeYKouRu166VU2xqa1",name:"Solana Devnet",network:"solana-devnet",nativeCurrency:{name:"Solana",symbol:"SOL",decimals:9},rpcUrls:{default:{http:["https://rpc.walletconnect.org/v1"]}},blockExplorers:{default:{name:"Solscan",url:"https://solscan.io"}},testnet:!0,chainNamespace:"solana",caipNetworkId:"solana:EtWTRABZaYq6iMfeYKouRu166VU2xqa1",deprecatedCaipNetworkId:"solana:8E9rvCKLFQia2Y35HXjjpWzj8weVo44K"});var Fb=jt({id:"4uhcVJyU9pJkvQyS88uRDiswHXSCkY3z",name:"Solana Testnet",network:"solana-testnet",nativeCurrency:{name:"Solana",symbol:"SOL",decimals:9},rpcUrls:{default:{http:["https://rpc.walletconnect.org/v1"]}},blockExplorers:{default:{name:"Solscan",url:"https://solscan.io"}},testnet:!0,chainNamespace:"solana",caipNetworkId:"solana:4uhcVJyU9pJkvQyS88uRDiswHXSCkY3z"});var zb=jt({id:"000000000019d6689c085ae165831e93",caipNetworkId:"bip122:000000000019d6689c085ae165831e93",chainNamespace:"bip122",name:"Bitcoin",nativeCurrency:{name:"Bitcoin",symbol:"BTC",decimals:8},rpcUrls:{default:{http:["https://rpc.walletconnect.org/v1"]}}}),Kb=jt({id:"000000000933ea01ad0ee984209779ba",caipNetworkId:"bip122:000000000933ea01ad0ee984209779ba",chainNamespace:"bip122",name:"Bitcoin Testnet",nativeCurrency:{name:"Bitcoin",symbol:"BTC",decimals:8},rpcUrls:{default:{http:["https://rpc.walletconnect.org/v1"]}},testnet:!0});var yv={solana:["solana_signMessage","solana_signTransaction","solana_requestAccounts","solana_getAccounts","solana_signAllTransactions","solana_signAndSendTransaction"],eip155:["eth_accounts","eth_requestAccounts","eth_sendRawTransaction","eth_sign","eth_signTransaction","eth_signTypedData","eth_signTypedData_v3","eth_signTypedData_v4","eth_sendTransaction","personal_sign","wallet_switchEthereumChain","wallet_addEthereumChain","wallet_getPermissions","wallet_requestPermissions","wallet_registerOnboarding","wallet_watchAsset","wallet_scanQRCode","wallet_getCallsStatus","wallet_showCallsStatus","wallet_sendCalls","wallet_getCapabilities","wallet_grantPermissions","wallet_revokePermissions","wallet_getAssets"],bip122:["sendTransfer","signMessage","signPsbt","getAccountAddresses"]},Or={getMethodsByChainNamespace(s){return yv[s]||[]},createDefaultNamespace(s){return{methods:this.getMethodsByChainNamespace(s),events:["accountsChanged","chainChanged"],chains:[],rpcMap:{}}},applyNamespaceOverrides(s,e){if(!e)return F({},s);let t=F({},s),i=new Set;if(e.methods&&Object.keys(e.methods).forEach(r=>i.add(r)),e.chains&&Object.keys(e.chains).forEach(r=>i.add(r)),e.events&&Object.keys(e.events).forEach(r=>i.add(r)),e.rpcMap&&Object.keys(e.rpcMap).forEach(r=>{let[n]=r.split(":");n&&i.add(n)}),i.forEach(r=>{t[r]||(t[r]=this.createDefaultNamespace(r))}),e.methods&&Object.entries(e.methods).forEach(([r,n])=>{t[r]&&(t[r].methods=n)}),e.chains&&Object.entries(e.chains).forEach(([r,n])=>{t[r]&&(t[r].chains=n)}),e.events&&Object.entries(e.events).forEach(([r,n])=>{t[r]&&(t[r].events=n)}),e.rpcMap){let r=new Set;Object.entries(e.rpcMap).forEach(([n,o])=>{let[a,c]=n.split(":");!a||!c||!t[a]||(t[a].rpcMap||(t[a].rpcMap={}),r.has(a)||(t[a].rpcMap={},r.add(a)),t[a].rpcMap[c]=o)})}return t},createNamespaces(s,e){let t=s.reduce((i,r)=>{let{id:n,chainNamespace:o,rpcUrls:a}=r,c=a.default.http[0];i[o]||(i[o]=this.createDefaultNamespace(o));let h=`${o}:${n}`,p=i[o];switch(p.chains.push(h),h){case ra.caipNetworkId:p.chains.push(ra.deprecatedCaipNetworkId);break;case na.caipNetworkId:p.chains.push(na.deprecatedCaipNetworkId);break;default:}return p?.rpcMap&&c&&(p.rpcMap[n]=c),i},{});return this.applyNamespaceOverrides(t,e)},resolveReownName:s=>l(void 0,null,function*(){let e=yield Fi.resolveName(s);return(Object.values(e?.addresses)||[])[0]?.address||!1}),getChainsFromNamespaces(s={}){return Object.values(s).flatMap(e=>{let t=e.chains||[],i=e.accounts.map(r=>{let[n,o]=r.split(":");return`${n}:${o}`});return Array.from(new Set([...t,...i]))})},isSessionEventData(s){return typeof s=="object"&&s!==null&&"id"in s&&"topic"in s&&"params"in s&&typeof s.params=="object"&&s.params!==null&&"chainId"in s.params&&"event"in s.params&&typeof s.params.event=="object"&&s.params.event!==null}};var ei=class{constructor({provider:e,namespace:t}){this.id=he.CONNECTOR_ID.WALLET_CONNECT,this.name=ni.ConnectorNamesMap[he.CONNECTOR_ID.WALLET_CONNECT],this.type="WALLET_CONNECT",this.imageId=ni.ConnectorImageIds[he.CONNECTOR_ID.WALLET_CONNECT],this.getCaipNetworks=O.getCaipNetworks.bind(O),this.caipNetworks=this.getCaipNetworks(),this.provider=e,this.chain=t}get chains(){return this.getCaipNetworks()}connectWalletConnect(){return l(this,null,function*(){if(!(yield this.authenticate())){let t=this.getCaipNetworks(),i=B.state.universalProviderConfigOverride,r=Or.createNamespaces(t,i);yield this.provider.connect({optionalNamespaces:r})}return{clientId:yield this.provider.client.core.crypto.getClientId(),session:this.provider.session}})}disconnect(){return l(this,null,function*(){yield this.provider.disconnect()})}authenticate(){return l(this,null,function*(){let e=this.chains.map(t=>t.caipNetworkId);return wa.universalProviderAuthenticate({universalProvider:this.provider,chains:e,methods:wv})})}},wv=["eth_accounts","eth_requestAccounts","eth_sendRawTransaction","eth_sign","eth_signTransaction","eth_signTypedData","eth_signTypedData_v3","eth_signTypedData_v4","eth_sendTransaction","personal_sign","wallet_switchEthereumChain","wallet_addEthereumChain","wallet_getPermissions","wallet_requestPermissions","wallet_registerOnboarding","wallet_watchAsset","wallet_scanQRCode","wallet_getCallsStatus","wallet_sendCalls","wallet_getCapabilities","wallet_grantPermissions","wallet_revokePermissions","wallet_getAssets"];var Rr=class{constructor(e){this.availableConnectors=[],this.eventListeners=new Map,this.getCaipNetworks=t=>O.getCaipNetworks(t),e&&this.construct(e)}construct(e){this.projectId=e.projectId,this.namespace=e.namespace,this.adapterType=e.adapterType}get connectors(){return this.availableConnectors}get networks(){return this.getCaipNetworks(this.namespace)}setAuthProvider(e){this.addConnector({id:he.CONNECTOR_ID.AUTH,type:"AUTH",name:he.CONNECTOR_NAMES.AUTH,provider:e,imageId:ni.ConnectorImageIds[he.CONNECTOR_ID.AUTH],chain:this.namespace,chains:[]})}addConnector(...e){let t=new Set;this.availableConnectors=[...e,...this.availableConnectors].filter(i=>t.has(i.id)?!1:(t.add(i.id),!0)),this.emit("connectors",this.availableConnectors)}setStatus(e,t){Y.setStatus(e,t)}on(e,t){this.eventListeners.has(e)||this.eventListeners.set(e,new Set),this.eventListeners.get(e)?.add(t)}off(e,t){let i=this.eventListeners.get(e);i&&i.delete(t)}removeAllEventListeners(){this.eventListeners.forEach(e=>{e.clear()})}emit(e,t){let i=this.eventListeners.get(e);i&&i.forEach(r=>r(t))}connectWalletConnect(e){return l(this,null,function*(){return{clientId:(yield this.getWalletConnectConnector().connectWalletConnect()).clientId}})}switchNetwork(e){return l(this,null,function*(){let{caipNetwork:t,providerType:i}=e;if(!e.provider)return;let r="provider"in e.provider?e.provider.provider:e.provider;if(i==="WALLET_CONNECT"){r.setDefaultChain(t.caipNetworkId);return}if(r&&i==="AUTH"){let n=r,o=Y.state.preferredAccountTypes?.[t.chainNamespace];yield n.switchNetwork(t.caipNetworkId);let a=yield n.getUser({chainId:t.caipNetworkId,preferredAccountType:o});this.emit("switchNetwork",a)}})}getWalletConnectConnector(){let e=this.connectors.find(t=>t instanceof ei);if(!e)throw new Error("WalletConnectConnector not found");return e}};var xr=class extends Rr{setUniversalProvider(e){this.addConnector(new ei({provider:e,caipNetworks:this.getCaipNetworks(),namespace:this.namespace}))}connect(e){return l(this,null,function*(){return Promise.resolve({id:"WALLET_CONNECT",type:"WALLET_CONNECT",chainId:Number(e.chainId),provider:this.provider,address:""})})}disconnect(){return l(this,null,function*(){try{yield this.getWalletConnectConnector().disconnect()}catch(e){console.warn("UniversalAdapter:disconnect - error",e)}})}getAccounts(t){return l(this,arguments,function*({namespace:e}){let r=this.provider?.session?.namespaces?.[e]?.accounts?.map(n=>{let[,,o]=n.split(":");return o}).filter((n,o,a)=>a.indexOf(n)===o)||[];return Promise.resolve({accounts:r.map(n=>gt.createAccount(e,n,e==="bip122"?"payment":"eoa"))})})}syncConnectors(){return l(this,null,function*(){return Promise.resolve()})}getBalance(e){return l(this,null,function*(){if(!(e.caipNetwork&&ma.BALANCE_SUPPORTED_CHAINS.includes(e.caipNetwork?.chainNamespace))||e.caipNetwork?.testnet)return{balance:"0.00",symbol:e.caipNetwork?.nativeCurrency.symbol||""};if(Y.state.balanceLoading&&e.chainId===O.state.activeCaipNetwork?.id)return{balance:Y.state.balance||"0.00",symbol:Y.state.balanceSymbol||""};let r=(yield Y.fetchTokenBalance()).find(n=>n.chainId===`${e.caipNetwork?.chainNamespace}:${e.chainId}`&&n.symbol===e.caipNetwork?.nativeCurrency.symbol);return{balance:r?.quantity.numeric||"0.00",symbol:r?.symbol||e.caipNetwork?.nativeCurrency.symbol||""}})}signMessage(e){return l(this,null,function*(){let{provider:t,message:i,address:r}=e;if(!t)throw new Error("UniversalAdapter:signMessage - provider is undefined");let n="";return O.state.activeCaipNetwork?.chainNamespace===he.CHAIN.SOLANA?n=(yield t.request({method:"solana_signMessage",params:{message:er.encode(new TextEncoder().encode(i)),pubkey:r}},O.state.activeCaipNetwork?.caipNetworkId)).signature:n=yield t.request({method:"personal_sign",params:[i,r]},O.state.activeCaipNetwork?.caipNetworkId),{signature:n}})}estimateGas(){return l(this,null,function*(){return Promise.resolve({gas:BigInt(0)})})}getProfile(){return l(this,null,function*(){return Promise.resolve({profileImage:"",profileName:""})})}sendTransaction(){return l(this,null,function*(){return Promise.resolve({hash:""})})}walletGetAssets(e){return Promise.resolve({})}writeContract(){return l(this,null,function*(){return Promise.resolve({hash:""})})}getEnsAddress(){return l(this,null,function*(){return Promise.resolve({address:!1})})}parseUnits(){return 0n}formatUnits(){return"0"}getCapabilities(){return l(this,null,function*(){return Promise.resolve({})})}grantPermissions(){return l(this,null,function*(){return Promise.resolve({})})}revokePermissions(){return l(this,null,function*(){return Promise.resolve("0x")})}syncConnection(){return l(this,null,function*(){return Promise.resolve({id:"WALLET_CONNECT",type:"WALLET_CONNECT",chainId:1,provider:this.provider,address:""})})}switchNetwork(e){return l(this,null,function*(){let{caipNetwork:t}=e,i=this.getWalletConnectConnector();if(t.chainNamespace===he.CHAIN.EVM)try{yield i.provider?.request({method:"wallet_switchEthereumChain",params:[{chainId:$r(t.id)}]})}catch(r){if(r.code===xi.ERROR_CODE_UNRECOGNIZED_CHAIN_ID||r.code===xi.ERROR_INVALID_CHAIN_ID||r.code===xi.ERROR_CODE_DEFAULT||r?.data?.originalError?.code===xi.ERROR_CODE_UNRECOGNIZED_CHAIN_ID)try{yield i.provider?.request({method:"wallet_addEthereumChain",params:[{chainId:$r(t.id),rpcUrls:[t?.rpcUrls.chainDefault?.http],chainName:t.name,nativeCurrency:t.nativeCurrency,blockExplorerUrls:[t.blockExplorers?.default.url]}]})}catch{throw new Error("Chain is not supported")}}i.provider.setDefaultChain(t.caipNetworkId)})}getWalletConnectProvider(){return this.connectors.find(i=>i.type==="WALLET_CONNECT")?.provider}};var kr=class{constructor(e){this.chainNamespaces=[],this.reportedAlertErrors={},this.getCaipNetwork=(t,i)=>{if(t){let r=O.getNetworkData(t)?.requestedCaipNetworks?.find(o=>o.id===i);if(r)return r;let n=O.getNetworkData(t)?.caipNetwork;return n||O.getRequestedCaipNetworks(t).filter(o=>o.chainNamespace===t)?.[0]}return O.state.activeCaipNetwork||this.defaultCaipNetwork},this.getCaipNetworkId=()=>{let t=this.getCaipNetwork();if(t)return t.id},this.getCaipNetworks=t=>O.getCaipNetworks(t),this.getActiveChainNamespace=()=>O.state.activeChain,this.setRequestedCaipNetworks=(t,i)=>{O.setRequestedCaipNetworks(t,i)},this.getApprovedCaipNetworkIds=()=>O.getAllApprovedCaipNetworkIds(),this.getCaipAddress=t=>O.state.activeChain===t||!t?O.state.activeCaipAddress:O.getAccountProp("caipAddress",t),this.setClientId=t=>{Br.setClientId(t)},this.getProvider=t=>ce.getProvider(t),this.getProviderType=t=>ce.getProviderId(t),this.getPreferredAccountType=t=>Y.state.preferredAccountTypes?.[t],this.setCaipAddress=(t,i)=>{Y.setCaipAddress(t,i)},this.setBalance=(t,i,r)=>{Y.setBalance(t,i,r)},this.setProfileName=(t,i)=>{Y.setProfileName(t,i)},this.setProfileImage=(t,i)=>{Y.setProfileImage(t,i)},this.setUser=(t,i)=>{Y.setUser(t,i),B.state.enableEmbedded&&ss.close()},this.resetAccount=t=>{Y.resetAccount(t)},this.setCaipNetwork=t=>{O.setActiveCaipNetwork(t)},this.setCaipNetworkOfNamespace=(t,i)=>{O.setChainNetworkData(i,{caipNetwork:t})},this.setAllAccounts=(t,i)=>{Y.setAllAccounts(t,i),B.setHasMultipleAddresses(t?.length>1)},this.setStatus=(t,i)=>{Y.setStatus(t,i),ye.isConnected()?He.setConnectionStatus("connected"):He.setConnectionStatus("disconnected")},this.getAddressByChainNamespace=t=>O.getAccountProp("address",t),this.setConnectors=t=>{let i=[...ye.state.allConnectors,...t];ye.setConnectors(i)},this.fetchIdentity=t=>Br.fetchIdentity(t),this.getReownName=t=>Fi.getNamesForAddress(t),this.getConnectors=()=>ye.getConnectors(),this.getConnectorImage=t=>ya.getConnectorImage(t),this.setConnectedWalletInfo=(t,i)=>{let r=ce.getProviderId(i),n=t?Ee(F({},t),{type:r}):void 0;Y.setConnectedWalletInfo(n,i)},this.getIsConnectedState=()=>!!O.state.activeCaipAddress,this.addAddressLabel=(t,i,r)=>{Y.addAddressLabel(t,i,r)},this.removeAddressLabel=(t,i)=>{Y.removeAddressLabel(t,i)},this.getAddress=t=>O.state.activeChain===t||!t?Y.state.address:O.getAccountProp("address",t),this.setApprovedCaipNetworksData=t=>O.setApprovedCaipNetworksData(t),this.resetNetwork=t=>{O.resetNetwork(t)},this.addConnector=t=>{ye.addConnector(t)},this.resetWcConnection=()=>{nt.resetWcConnection()},this.setAddressExplorerUrl=(t,i)=>{Y.setAddressExplorerUrl(t,i)},this.setSmartAccountDeployed=(t,i)=>{Y.setSmartAccountDeployed(t,i)},this.setSmartAccountEnabledNetworks=(t,i)=>{O.setSmartAccountEnabledNetworks(t,i)},this.setPreferredAccountType=(t,i)=>{Y.setPreferredAccountType(t,i)},this.setEIP6963Enabled=t=>{B.setEIP6963Enabled(t)},this.handleUnsafeRPCRequest=()=>{if(this.isOpen()){if(this.isTransactionStackEmpty())return;this.redirect("ApproveTransaction")}else this.open({view:"ApproveTransaction"})},this.options=e,this.version=e.sdkVersion,this.caipNetworks=this.extendCaipNetworks(e),this.chainNamespaces=this.getChainNamespacesSet(e.adapters,this.caipNetworks),this.defaultCaipNetwork=this.extendDefaultCaipNetwork(e),this.chainAdapters=this.createAdapters(e.adapters),this.initialize(e)}getChainNamespacesSet(e,t){let i=e?.map(n=>n.namespace).filter(n=>!!n);if(i?.length)return[...new Set(i)];let r=t?.map(n=>n.chainNamespace);return[...new Set(r)]}initialize(e){return l(this,null,function*(){this.initControllers(e),yield this.initChainAdapters(),yield this.injectModalUi(),this.sendInitializeEvent(e),qi.set({initialized:!0}),yield this.syncExistingConnection()})}sendInitializeEvent(e){let t=oa(e,[]);delete t.adapters,delete t.universalProvider,ri.sendEvent({type:"track",event:"INITIALIZE",properties:Ee(F({},t),{networks:e.networks.map(i=>i.id),siweConfig:{options:e.siweConfig?.options||{}}})})}initControllers(e){this.initializeOptionsController(e),this.initializeChainController(e),this.initializeThemeController(e),this.initializeConnectionController(e),this.initializeConnectorController()}initializeThemeController(e){e.themeMode&&ft.setThemeMode(e.themeMode),e.themeVariables&&ft.setThemeVariables(e.themeVariables)}initializeChainController(e){if(!this.connectionControllerClient||!this.networkControllerClient)throw new Error("ConnectionControllerClient and NetworkControllerClient must be set");O.initialize(e.adapters??[],this.caipNetworks,{connectionControllerClient:this.connectionControllerClient,networkControllerClient:this.networkControllerClient});let t=this.getDefaultNetwork();t&&O.setActiveCaipNetwork(t)}initializeConnectionController(e){nt.setWcBasic(e.basic??!1)}initializeConnectorController(){ye.initialize(this.chainNamespaces)}initializeOptionsController(e){B.setDebug(e.debug!==!1),B.setEnableWalletConnect(e.enableWalletConnect!==!1),B.setEnableWalletGuide(e.enableWalletGuide!==!1),B.setEnableWallets(e.enableWallets!==!1),B.setEIP6963Enabled(e.enableEIP6963!==!1),B.setEnableNetworkSwitch(e.enableNetworkSwitch!==!1),B.setEnableAuthLogger(e.enableAuthLogger!==!1),B.setCustomRpcUrls(e.customRpcUrls),B.setSdkVersion(e.sdkVersion),B.setProjectId(e.projectId),B.setEnableEmbedded(e.enableEmbedded),B.setAllWallets(e.allWallets),B.setIncludeWalletIds(e.includeWalletIds),B.setExcludeWalletIds(e.excludeWalletIds),B.setFeaturedWalletIds(e.featuredWalletIds),B.setTokens(e.tokens),B.setTermsConditionsUrl(e.termsConditionsUrl),B.setPrivacyPolicyUrl(e.privacyPolicyUrl),B.setCustomWallets(e.customWallets),B.setFeatures(e.features),B.setAllowUnsupportedChain(e.allowUnsupportedChain),B.setUniversalProviderConfigOverride(e.universalProviderConfigOverride),B.setDefaultAccountTypes(e.defaultAccountTypes);let t=He.getPreferredAccountTypes(),i=F(F({},B.state.defaultAccountTypes),t);Y.setPreferredAccountTypes(i);let r=this.getDefaultMetaData();if(!e.metadata&&r&&(e.metadata=r),B.setMetadata(e.metadata),B.setDisableAppend(e.disableAppend),B.setEnableEmbedded(e.enableEmbedded),B.setSIWX(e.siwx),!e.projectId){Li.open(oi.ALERT_ERRORS.PROJECT_ID_NOT_CONFIGURED,"error");return}if(e.adapters?.find(o=>o.namespace===he.CHAIN.EVM)&&e.siweConfig){if(e.siwx)throw new Error("Cannot set both `siweConfig` and `siwx` options");B.setSIWX(e.siweConfig.mapToSIWX())}}getDefaultMetaData(){return typeof window<"u"&&typeof document<"u"?{name:document.getElementsByTagName("title")?.[0]?.textContent||"",description:document.querySelector('meta[property="og:description"]')?.content||"",url:window.location.origin,icons:[document.querySelector('link[rel~="icon"]')?.href||""]}:null}setUnsupportedNetwork(e){let t=this.getActiveChainNamespace();if(t){let i=ms.getUnsupportedNetwork(`${t}:${e}`);O.setActiveCaipNetwork(i)}}getDefaultNetwork(){return ms.getCaipNetworkFromStorage(this.defaultCaipNetwork)}extendCaipNetwork(e,t){return ms.extendCaipNetwork(e,{customNetworkImageUrls:t.chainImages,projectId:t.projectId})}extendCaipNetworks(e){return ms.extendCaipNetworks(e.networks,{customNetworkImageUrls:e.chainImages,customRpcUrls:e.customRpcUrls,projectId:e.projectId})}extendDefaultCaipNetwork(e){let t=e.networks.find(r=>r.id===e.defaultNetwork?.id);return t?ms.extendCaipNetwork(t,{customNetworkImageUrls:e.chainImages,customRpcUrls:e.customRpcUrls,projectId:e.projectId}):void 0}createClients(){this.connectionControllerClient={connectWalletConnect:()=>l(this,null,function*(){let e=O.state.activeChain,t=this.getAdapter(e),i=this.getCaipNetwork(e)?.id;if(!t)throw new Error("Adapter not found");let r=yield t.connectWalletConnect(i);this.close(),this.setClientId(r?.clientId||null),He.setConnectedNamespaces([...O.state.chains.keys()]),this.chainNamespaces.forEach(n=>{ye.setConnectorId(Bt.CONNECTOR_TYPE_WALLET_CONNECT,n)}),yield this.syncWalletConnectAccount()}),connectExternal:a=>l(this,[a],function*({id:e,info:t,type:i,provider:r,chain:n,caipNetwork:o}){let c=O.state.activeChain,h=n||c,p=this.getAdapter(h);if(n&&n!==c&&!o){let f=this.getCaipNetworks().find(m=>m.chainNamespace===n);f&&this.setCaipNetwork(f)}if(!p)throw new Error("Adapter not found");let d=this.getCaipNetwork(h),u=yield p.connect({id:e,info:t,type:i,provider:r,chainId:o?.id||d?.id,rpcUrl:o?.rpcUrls?.default?.http?.[0]||d?.rpcUrls?.default?.http?.[0]});if(!u)return;He.addConnectedNamespace(h),this.syncProvider(Ee(F({},u),{chainNamespace:h}));let{accounts:y}=yield p.getAccounts({namespace:h,id:e});this.setAllAccounts(y,h),this.setStatus("connected",h)}),reconnectExternal:n=>l(this,[n],function*({id:e,info:t,type:i,provider:r}){let o=O.state.activeChain,a=this.getAdapter(o);a?.reconnect&&(yield a?.reconnect({id:e,info:t,type:i,provider:r,chainId:this.getCaipNetwork()?.id}),He.addConnectedNamespace(o))}),disconnect:e=>l(this,null,function*(){let t=e||O.state.activeChain,i=this.getAdapter(t),r=ce.getProvider(t),n=ce.getProviderId(t);yield i?.disconnect({provider:r,providerType:n}),He.removeConnectedNamespace(t),ce.resetChain(t),this.setUser(void 0,t),this.setStatus("disconnected",t)}),checkInstalled:e=>e?e.some(t=>!!window.ethereum?.[String(t)]):!!window.ethereum,signMessage:e=>l(this,null,function*(){return(yield this.getAdapter(O.state.activeChain)?.signMessage({message:e,address:Y.state.address,provider:ce.getProvider(O.state.activeChain)}))?.signature||""}),sendTransaction:e=>l(this,null,function*(){if(e.chainNamespace===he.CHAIN.EVM){let t=this.getAdapter(O.state.activeChain),i=ce.getProvider(O.state.activeChain);return(yield t?.sendTransaction(Ee(F({},e),{caipNetwork:this.getCaipNetwork(),provider:i})))?.hash||""}return""}),estimateGas:e=>l(this,null,function*(){if(e.chainNamespace===he.CHAIN.EVM){let t=this.getAdapter(O.state.activeChain),i=ce.getProvider(O.state.activeChain),r=this.getCaipNetwork();if(!r)throw new Error("CaipNetwork is undefined");return(yield t?.estimateGas(Ee(F({},e),{provider:i,caipNetwork:r})))?.gas||0n}return 0n}),getEnsAvatar:()=>l(this,null,function*(){return(yield this.getAdapter(O.state.activeChain)?.getProfile({address:Y.state.address,chainId:Number(this.getCaipNetwork()?.id)}))?.profileImage||!1}),getEnsAddress:e=>l(this,null,function*(){let t=this.getAdapter(O.state.activeChain),i=this.getCaipNetwork();return i&&(yield t?.getEnsAddress({name:e,caipNetwork:i}))?.address||!1}),writeContract:e=>l(this,null,function*(){let t=this.getAdapter(O.state.activeChain),i=this.getCaipNetwork(),r=this.getCaipAddress(),n=ce.getProvider(O.state.activeChain);if(!i||!r)throw new Error("CaipNetwork or CaipAddress is undefined");return(yield t?.writeContract(Ee(F({},e),{caipNetwork:i,provider:n,caipAddress:r})))?.hash}),parseUnits:(e,t)=>this.getAdapter(O.state.activeChain)?.parseUnits({value:e,decimals:t})??0n,formatUnits:(e,t)=>this.getAdapter(O.state.activeChain)?.formatUnits({value:e,decimals:t})??"0",getCapabilities:e=>l(this,null,function*(){return yield this.getAdapter(O.state.activeChain)?.getCapabilities(e)}),grantPermissions:e=>l(this,null,function*(){return yield this.getAdapter(O.state.activeChain)?.grantPermissions(e)}),revokePermissions:e=>l(this,null,function*(){let t=this.getAdapter(O.state.activeChain);return t?.revokePermissions?yield t.revokePermissions(e):"0x"}),walletGetAssets:e=>l(this,null,function*(){return(yield this.getAdapter(O.state.activeChain)?.walletGetAssets(e))??{}})},this.networkControllerClient={switchCaipNetwork:e=>l(this,null,function*(){return yield this.switchCaipNetwork(e)}),getApprovedCaipNetworksData:()=>l(this,null,function*(){return this.getApprovedCaipNetworksData()})},nt.setClient(this.connectionControllerClient)}getApprovedCaipNetworksData(){if(ce.getProviderId(O.state.activeChain)===Bt.CONNECTOR_TYPE_WALLET_CONNECT){let t=this.universalProvider?.session?.namespaces;return{supportsAllNetworks:this.universalProvider?.session?.peer?.metadata.name==="MetaMask Wallet",approvedCaipNetworkIds:this.getChainsFromNamespaces(t)}}return{supportsAllNetworks:!0,approvedCaipNetworkIds:[]}}switchCaipNetwork(e){return l(this,null,function*(){if(!e)return;let t=e.chainNamespace;if(this.getAddressByChainNamespace(e.chainNamespace)){let r=ce.getProvider(t),n=ce.getProviderId(t);if(e.chainNamespace===O.state.activeChain)yield this.getAdapter(t)?.switchNetwork({caipNetwork:e,provider:r,providerType:n});else if(this.setCaipNetwork(e),n===Bt.CONNECTOR_TYPE_WALLET_CONNECT)this.syncWalletConnectAccount();else{let o=this.getAddressByChainNamespace(t);o&&this.syncAccount({address:o,chainId:e.id,chainNamespace:t})}}else this.setCaipNetwork(e)})}getChainsFromNamespaces(e={}){return Object.values(e).flatMap(t=>{let i=t.chains||[],r=t.accounts.map(n=>{let{chainId:o,chainNamespace:a}=At.parseCaipAddress(n);return`${a}:${o}`});return Array.from(new Set([...i,...r]))})}createAdapters(e){return this.createClients(),this.chainNamespaces.reduce((t,i)=>{let r=e?.find(n=>n.namespace===i);return r?(r.construct({namespace:i,projectId:this.options?.projectId,networks:this.getCaipNetworks()}),t[i]=r):t[i]=new xr({namespace:i,networks:this.getCaipNetworks()}),t},{})}initChainAdapter(e){return l(this,null,function*(){this.onConnectors(e),this.listenAdapter(e),this.chainAdapters?.[e].syncConnectors(this.options,this),yield this.createUniversalProviderForAdapter(e)})}initChainAdapters(){return l(this,null,function*(){yield Promise.all(this.chainNamespaces.map(e=>l(this,null,function*(){yield this.initChainAdapter(e)})))})}onConnectors(e){this.getAdapter(e)?.on("connectors",this.setConnectors.bind(this))}listenAdapter(e){let t=this.getAdapter(e);if(!t)return;let i=He.getConnectionStatus();i==="connected"?this.setStatus("connecting",e):i==="disconnected"?(He.clearAddressCache(),this.setStatus(i,e)):this.setStatus(i,e),t.on("switchNetwork",({address:r,chainId:n})=>{let o=this.getCaipNetworks().find(h=>h.id===n||h.caipNetworkId===n),a=O.state.activeChain===e,c=O.getAccountProp("address",e);if(o){let h=a&&r?r:c;h&&this.syncAccount({address:h,chainId:o.id,chainNamespace:e})}else this.setUnsupportedNetwork(n)}),t.on("disconnect",this.disconnect.bind(this,e)),t.on("pendingTransactions",()=>{let r=Y.state.address,n=O.state.activeCaipNetwork;!r||!n?.id||this.updateNativeBalance(r,n.id,n.chainNamespace)}),t.on("accountChanged",({address:r,chainId:n})=>{let o=O.state.activeChain===e;o&&n?this.syncAccount({address:r,chainId:n,chainNamespace:e}):o&&O.state.activeCaipNetwork?.id?this.syncAccount({address:r,chainId:O.state.activeCaipNetwork?.id,chainNamespace:e}):this.syncAccountInfo(r,n,e)})}createUniversalProviderForAdapter(e){return l(this,null,function*(){yield this.getUniversalProvider(),this.universalProvider&&this.chainAdapters?.[e]?.setUniversalProvider?.(this.universalProvider)})}syncExistingConnection(){return l(this,null,function*(){yield Promise.allSettled(this.chainNamespaces.map(e=>this.syncNamespaceConnection(e)))})}syncNamespaceConnection(e){return l(this,null,function*(){try{let t=ye.getConnectorId(e);switch(this.setStatus("connecting",e),t){case he.CONNECTOR_ID.WALLET_CONNECT:yield this.syncWalletConnectAccount();break;case he.CONNECTOR_ID.AUTH:break;default:yield this.syncAdapterConnection(e)}}catch(t){console.warn("AppKit couldn't sync existing connection",t),this.setStatus("disconnected",e)}})}syncAdapterConnection(e){return l(this,null,function*(){let t=this.getAdapter(e),i=ye.getConnectorId(e),r=this.getCaipNetwork(e),n=ye.getConnectors(e).find(o=>o.id===i);try{if(!t||!n)throw new Error(`Adapter or connector not found for namespace ${e}`);if(!r?.id)throw new Error("CaipNetwork not found");let o=yield t?.syncConnection({namespace:e,id:n.id,chainId:r.id,rpcUrl:r?.rpcUrls?.default?.http?.[0]});if(o){let a=yield t?.getAccounts({namespace:e,id:n.id});a&&a.accounts.length>0?this.setAllAccounts(a.accounts,e):this.setAllAccounts([gt.createAccount(e,o.address,"eoa")],e),this.syncProvider(Ee(F({},o),{chainNamespace:e})),yield this.syncAccount(Ee(F({},o),{chainNamespace:e})),this.setStatus("connected",e)}else this.setStatus("disconnected",e)}catch{this.setStatus("disconnected",e)}})}syncWalletConnectAccount(){return l(this,null,function*(){let e=this.chainNamespaces.map(t=>l(this,null,function*(){let i=this.getAdapter(t),r=this.universalProvider?.session?.namespaces?.[t]?.accounts||[],n=O.state.activeCaipNetwork?.id,o=r.find(a=>{let{chainId:c}=At.parseCaipAddress(a);return c===n?.toString()})||r[0];if(o){let a=At.validateCaipAddress(o),{chainId:c,address:h}=At.parseCaipAddress(a);if(ce.setProviderId(t,Bt.CONNECTOR_TYPE_WALLET_CONNECT),this.caipNetworks&&O.state.activeCaipNetwork&&i?.namespace!==he.CHAIN.EVM){let p=i?.getWalletConnectProvider({caipNetworks:this.getCaipNetworks(),provider:this.universalProvider,activeCaipNetwork:O.state.activeCaipNetwork});ce.setProvider(t,p)}else ce.setProvider(t,this.universalProvider);ye.setConnectorId(he.CONNECTOR_ID.WALLET_CONNECT,t),He.addConnectedNamespace(t),this.syncWalletConnectAccounts(t),yield this.syncAccount({address:h,chainId:c,chainNamespace:t})}else this.setStatus("disconnected",t);yield O.setApprovedCaipNetworksData(t)}));yield Promise.all(e)})}syncWalletConnectAccounts(e){let t=this.universalProvider?.session?.namespaces?.[e]?.accounts?.map(i=>{let{address:r}=At.parseCaipAddress(i);return r}).filter((i,r,n)=>n.indexOf(i)===r);t&&this.setAllAccounts(t.map(i=>gt.createAccount(e,i,e==="bip122"?"payment":"eoa")),e)}syncProvider({type:e,provider:t,id:i,chainNamespace:r}){ce.setProviderId(r,e),ce.setProvider(r,t),ye.setConnectorId(i,r)}syncAccount(e){return l(this,null,function*(){let t=e.chainNamespace===O.state.activeChain,i=O.getCaipNetworkByNamespace(e.chainNamespace,e.chainId),{address:r,chainId:n,chainNamespace:o}=e,{chainId:a}=He.getActiveNetworkProps(),c=n||a,h=O.state.activeCaipNetwork?.name===he.UNSUPPORTED_NETWORK_NAME,p=O.getNetworkProp("supportsAllNetworks",o);if(this.setStatus("connected",o),!(h&&!p)&&c){let d=this.getCaipNetworks().find(f=>f.id.toString()===c.toString()),u=this.getCaipNetworks().find(f=>f.chainNamespace===o);if(!p&&!d&&!u){let f=this.getApprovedCaipNetworkIds()||[],m=f.find(v=>At.parseCaipNetworkId(v)?.chainId===c.toString()),g=f.find(v=>At.parseCaipNetworkId(v)?.chainNamespace===o);d=this.getCaipNetworks().find(v=>v.caipNetworkId===m),u=this.getCaipNetworks().find(v=>v.caipNetworkId===g||"deprecatedCaipNetworkId"in v&&v.deprecatedCaipNetworkId===g)}let y=d||u;y?.chainNamespace===O.state.activeChain?B.state.enableNetworkSwitch&&!B.state.allowUnsupportedChain&&O.state.activeCaipNetwork?.name===he.UNSUPPORTED_NETWORK_NAME?O.showUnsupportedChainUI():this.setCaipNetwork(y):t||i&&this.setCaipNetworkOfNamespace(i,o),this.syncConnectedWalletInfo(o),Ia.isLowerCaseMatch(r,Y.state.address)||this.syncAccountInfo(r,y?.id,o),t?yield this.syncBalance({address:r,chainId:y?.id,chainNamespace:o}):yield this.syncBalance({address:r,chainId:i?.id,chainNamespace:o})}})}syncAccountInfo(e,t,i){return l(this,null,function*(){let r=this.getCaipAddress(i),n=t||r?.split(":")[1];if(!n)return;let o=`${i}:${n}:${e}`;this.setCaipAddress(o,i),yield this.syncIdentity({address:e,chainId:n,chainNamespace:i})})}syncReownName(e,t){return l(this,null,function*(){try{let i=yield this.getReownName(e);if(i[0]){let r=i[0];this.setProfileName(r.name,t)}else this.setProfileName(null,t)}catch{this.setProfileName(null,t)}})}syncConnectedWalletInfo(e){let t=ye.getConnectorId(e),i=ce.getProviderId(e);if(i===Bt.CONNECTOR_TYPE_ANNOUNCED||i===Bt.CONNECTOR_TYPE_INJECTED){if(t){let r=this.getConnectors().find(n=>n.id===t);if(r){let{info:n,name:o,imageUrl:a}=r,c=a||this.getConnectorImage(r);this.setConnectedWalletInfo(F({name:o,icon:c},n),e)}}}else if(i===Bt.CONNECTOR_TYPE_WALLET_CONNECT){let r=ce.getProvider(e);r?.session&&this.setConnectedWalletInfo(Ee(F({},r.session.peer.metadata),{name:r.session.peer.metadata.name,icon:r.session.peer.metadata.icons?.[0]}),e)}else if(t)if(t===he.CONNECTOR_ID.COINBASE){let r=this.getConnectors().find(n=>n.id===he.CONNECTOR_ID.COINBASE);this.setConnectedWalletInfo({name:"Coinbase Wallet",icon:this.getConnectorImage(r)},e)}else this.setConnectedWalletInfo({name:t},e)}syncBalance(e){return l(this,null,function*(){!fa.getNetworksByNamespace(this.getCaipNetworks(),e.chainNamespace).find(i=>i.id.toString()===e.chainId?.toString())||!e.chainId||(yield this.updateNativeBalance(e.address,e.chainId,e.chainNamespace))})}updateNativeBalance(e,t,i){return l(this,null,function*(){let r=this.getAdapter(i),n=O.getCaipNetworkByNamespace(i,t);if(r){let o=yield r.getBalance({address:e,chainId:t,caipNetwork:n,tokens:this.options.tokens});this.setBalance(o.balance,o.symbol,i)}})}initializeUniversalAdapter(){return l(this,null,function*(){let e=Ca.createLogger((i,...r)=>{i&&this.handleAlertError(i),console.error(...r)}),t={projectId:this.options?.projectId,metadata:{name:this.options?.metadata?this.options?.metadata.name:"",description:this.options?.metadata?this.options?.metadata.description:"",url:this.options?.metadata?this.options?.metadata.url:"",icons:this.options?.metadata?this.options?.metadata.icons:[""]},logger:e};B.setManualWCControl(!!this.options?.manualWCControl),this.universalProvider=this.options.universalProvider??(yield Tr.init(t)),this.listenWalletConnect()})}listenWalletConnect(){this.universalProvider&&(this.universalProvider.on("display_uri",e=>{nt.setUri(e)}),this.universalProvider.on("connect",nt.finalizeWcConnection),this.universalProvider.on("disconnect",()=>{this.chainNamespaces.forEach(e=>{this.resetAccount(e)}),nt.resetWcConnection()}),this.universalProvider.on("chainChanged",e=>{let t=this.getCaipNetworks().find(r=>r.id==e),i=this.getCaipNetwork();if(!t){this.setUnsupportedNetwork(e);return}i?.id!==t?.id&&this.setCaipNetwork(t)}),this.universalProvider.on("session_event",e=>{if(Or.isSessionEventData(e)){let{name:t,data:i}=e.params.event;t==="accountsChanged"&&Array.isArray(i)&&gt.isCaipAddress(i[0])&&this.syncAccount(At.parseCaipAddress(i[0]))}}))}createUniversalProvider(){return!this.universalProviderInitPromise&&gt.isClient()&&this.options?.projectId&&(this.universalProviderInitPromise=this.initializeUniversalAdapter()),this.universalProviderInitPromise}getUniversalProvider(){return l(this,null,function*(){if(!this.universalProvider)try{yield this.createUniversalProvider()}catch(e){ri.sendEvent({type:"error",event:"INTERNAL_SDK_ERROR",properties:{errorType:"UniversalProviderInitError",errorMessage:e instanceof Error?e.message:"Unknown",uncaught:!1}}),console.error("AppKit:getUniversalProvider - Cannot create provider",e)}return this.universalProvider})}handleAlertError(e){let t=Object.entries(oi.UniversalProviderErrors).find(([,{message:a}])=>e.message.includes(a)),[i,r]=t??[],{message:n,alertErrorKey:o}=r??{};if(i&&n&&!this.reportedAlertErrors[i]){let a=oi.ALERT_ERRORS[o];a&&(Li.open(a,"error"),this.reportedAlertErrors[i]=!0)}}getAdapter(e){if(e)return this.chainAdapters?.[e]}createAdapter(e){if(!e)return;let t=e.namespace;if(!t)return;this.createClients();let i=e;i.namespace=t,i.construct({namespace:t,projectId:this.options?.projectId,networks:this.getCaipNetworks()}),this.chainNamespaces.includes(t)||this.chainNamespaces.push(t),this.chainAdapters&&(this.chainAdapters[t]=i)}open(e){return l(this,null,function*(){if(yield this.injectModalUi(),e?.uri&&nt.setUri(e.uri),e?.arguments)switch(e?.view){case"Swap":return ss.open(Ee(F({},e),{data:{swap:e.arguments}}));default:}return ss.open(e)})}close(){return l(this,null,function*(){yield this.injectModalUi(),ss.close()})}setLoading(e,t){ss.setLoading(e,t)}disconnect(e){return l(this,null,function*(){yield nt.disconnect(e)})}getError(){return""}getChainId(){return O.state.activeCaipNetwork?.id}switchNetwork(e){return l(this,null,function*(){let t=this.getCaipNetworks().find(i=>i.id===e.id);if(!t){Li.open(oi.ALERT_ERRORS.SWITCH_NETWORK_NOT_FOUND,"error");return}yield O.switchActiveNetwork(t)})}getWalletProvider(){return O.state.activeChain?ce.state.providers[O.state.activeChain]:null}getWalletProviderType(){return ce.getProviderId(O.state.activeChain)}subscribeProviders(e){return ce.subscribeProviders(e)}getThemeMode(){return ft.state.themeMode}getThemeVariables(){return ft.state.themeVariables}setThemeMode(e){ft.setThemeMode(e),Pa(ft.state.themeMode)}setTermsConditionsUrl(e){B.setTermsConditionsUrl(e)}setPrivacyPolicyUrl(e){B.setPrivacyPolicyUrl(e)}setThemeVariables(e){ft.setThemeVariables(e),Sa(ft.state.themeVariables)}subscribeTheme(e){return ft.subscribe(e)}getWalletInfo(){return Y.state.connectedWalletInfo}getAccount(e){let t=ye.getAuthConnector(e),i=O.getAccountData(e),r=O.state.activeChain;if(i)return{allAccounts:i.allAccounts,caipAddress:i.caipAddress,address:gt.getPlainAddress(i.caipAddress),isConnected:!!i.caipAddress,status:i.status,embeddedWalletInfo:t?{user:i.user?Ee(F({},i.user),{username:He.getConnectedSocialUsername()}):void 0,authProvider:i.socialProvider||"email",accountType:i.preferredAccountTypes?.[e||r],isSmartAccountDeployed:!!i.smartAccountDeployed}:void 0}}subscribeAccount(e,t){let i=()=>{let r=this.getAccount(t);r&&e(r)};t?O.subscribeChainProp("accountState",i,t):O.subscribe(i),ye.subscribe(i)}subscribeNetwork(e){return O.subscribe(({activeCaipNetwork:t})=>{e({caipNetwork:t,chainId:t?.id,caipNetworkId:t?.caipNetworkId})})}subscribeWalletInfo(e){return Y.subscribeKey("connectedWalletInfo",e)}subscribeShouldUpdateToAddress(e){Y.subscribeKey("shouldUpdateToAddress",e)}subscribeCaipNetworkChange(e){O.subscribeKey("activeCaipNetwork",e)}getState(){return qi.state}subscribeState(e){return qi.subscribe(e)}showErrorMessage(e){jr.showError(e)}showSuccessMessage(e){jr.showSuccess(e)}getEvent(){return F({},ri.state)}subscribeEvents(e){return ri.subscribe(e)}replace(e){ts.replace(e)}redirect(e){ts.push(e)}popTransactionStack(e){ts.popTransactionStack(e)}isOpen(){return ss.state.open}isTransactionStackEmpty(){return ts.state.transactionStack.length===0}isTransactionShouldReplaceView(){return ts.state.transactionStack[ts.state.transactionStack.length-1]?.replace}static getInstance(){return this.instance}updateFeatures(e){B.setFeatures(e)}updateOptions(e){let t=B.state||{},i=F(F({},t),e);B.setOptions(i)}setConnectMethodsOrder(e){B.setConnectMethodsOrder(e)}setWalletFeaturesOrder(e){B.setWalletFeaturesOrder(e)}setCollapseWallets(e){B.setCollapseWallets(e)}setSocialsOrder(e){B.setSocialsOrder(e)}getConnectMethodsOrder(){return _a.getConnectOrderMethod(B.state.features,ye.getConnectors())}addNetwork(e,t){if(this.chainAdapters&&!this.chainAdapters[e])throw new Error(`Adapter for namespace ${e} doesn't exist`);let i=this.extendCaipNetwork(t,this.options);this.getCaipNetworks().find(r=>r.id===i.id)||O.addNetwork(i)}removeNetwork(e,t){if(this.chainAdapters&&!this.chainAdapters[e])throw new Error(`Adapter for namespace ${e} doesn't exist`);this.getCaipNetworks().find(r=>r.id===t)&&O.removeNetwork(e,t)}};var Gl=!1,Ur=class s extends kr{open(e){return l(this,null,function*(){ye.isConnected()||(yield Dr(s.prototype,this,"open").call(this,e))})}close(){return l(this,null,function*(){yield Dr(s.prototype,this,"close").call(this),this.options.manualWCControl&&nt.finalizeWcConnection()})}syncIdentity(e){return l(this,null,function*(){return Promise.resolve()})}syncBalance(e){return l(this,null,function*(){return Promise.resolve()})}injectModalUi(){return l(this,null,function*(){if(!Gl&&gt.isClient()){if(yield import("./chunk-GW5UVIJZ.js"),yield import("./chunk-WSWDORGB.js"),!document.querySelector("w3m-modal")){let t=document.createElement("w3m-modal");!B.state.disableAppend&&!B.state.enableEmbedded&&document.body.insertAdjacentElement("beforeend",t)}Gl=!0}})}};var Yl="1.7.3";function JE(s){return new Ur(Ee(F({},s),{basic:!0,sdkVersion:`html-core-${Yl}`}))}export{Ur as AppKit,JE as createAppKit};
